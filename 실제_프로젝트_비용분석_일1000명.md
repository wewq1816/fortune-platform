# 🎯 운세 플랫폼 - 실제 프로젝트 기반 비용 분석 (일 1,000명)

## 📊 프로젝트 구조 분석

### 현재 아키텍처
```
운세 플랫폼
├── Frontend: 정적 HTML/JS (frontend/)
│   ├── 사주팔자 (saju-test.html)
│   ├── 로또 번호 (lotto.html)
│   ├── 토정비결 (tojeong-test.html)
│   ├── 꿈해몽 (dream.html)
│   ├── 타로 카드 (tarot.html)
│   ├── 별자리 운세 (horoscope.html)
│   └── 궁합 (compatibility.html)
│
├── Backend: Express.js (server.js)
│   ├── Node.js 서버
│   ├── MongoDB 연결
│   └── Claude API 통합
│
├── AI Engines: 운세 생성 엔진 (engines/core/)
│   ├── saju-engine.js (사주팔자)
│   ├── tojeong-engine.js (토정비결)
│   ├── dream-engine.js (꿈해몽)
│   ├── tarot-engine.js (타로)
│   ├── horoscope-engine.js (별자리)
│   └── compatibility-engine.js (궁합)
│
└── Deployment: 
    ├── Render.com (백엔드)
    ├── Vercel (프론트엔드)
    └── MongoDB Atlas (DB)
```

---

## 🔍 실제 API 호출 패턴 분석

### 각 기능별 Claude API 사용량

#### 1️⃣ 사주팔자 (21개 카테고리)
```javascript
// /api/saju API
입력 토큰: 600-800 tokens (사용자 정보 + 프롬프트)
출력 토큰: 2,000-2,500 tokens (상세한 사주 해석)

카테고리:
- 총운, 성격, 대운, 재물운, 애정운
- 부모운, 형제운, 자녀운, 배우자운
- 대인관계, 건강운, 직업운, 학업운
- 승진운, 적성, 직업추천, 사업운
- 이동운, 여행운, 택일, 신살
(총 21개)

예상 사용:
- 1회 사주 = 1 Claude API 호출
- 평균 사용자: 2-3개 카테고리 확인
```

#### 2️⃣ 타로 카드 (21개 카테고리)
```javascript
// /api/tarot API
입력 토큰: 800-1,000 tokens (5장 카드 + 카테고리별 의미)
출력 토큰: 1,200-1,500 tokens (종합 해석)

카테고리: 사주와 동일 21개

예상 사용:
- 1회 타로 = 1 Claude API 호출
- 평균 사용자: 1-2회 사용
```

#### 3️⃣ 꿈해몽
```javascript
// /api/dream/ai-interpret API
입력 토큰: 400-600 tokens (꿈 내용 + 프롬프트)
출력 토큰: 1,000-1,200 tokens (해몽 + 행운의 번호)

예상 사용:
- 1회 꿈해몽 = 1 Claude API 호출
- 평균 사용자: 1회 사용
```

#### 4️⃣ 오늘의 운세 (일일 운세)
```javascript
// /api/daily-fortune API
입력 토큰: 500-700 tokens
출력 토큰: 1,500-1,800 tokens

예상 사용:
- 1회 일일 운세 = 1 Claude API 호출
- 평균 사용자: 1회 사용
```

#### 5️⃣ 별자리 운세 (호로스코프)
```javascript
// /api/horoscope API
입력 토큰: 400-500 tokens
출력 토큰: 1,200-1,500 tokens

예상 사용:
- 1회 별자리 운세 = 1 Claude API 호출
- 평균 사용자: 1회 사용
```

#### 6️⃣ 토정비결
```javascript
// /api/tojeong API
입력 토큰: 500-600 tokens
출력 토큰: 1,500-1,800 tokens

예상 사용:
- 1회 토정비결 = 1 Claude API 호출
- 평균 사용자: 1회 사용
```

#### 7️⃣ 궁합
```javascript
// /api/compatibility API
입력 토큰: 700-900 tokens (2인 정보)
출력 토큰: 1,800-2,200 tokens (궁합 분석)

예상 사용:
- 1회 궁합 = 1 Claude API 호출
- 평균 사용자: 1회 사용
```

#### 8️⃣ 로또 번호
```javascript
// 로또는 Claude API 사용 안 함!
// 로컬 알고리즘으로 생성
예상 사용: 0 Claude API 호출
```

---

## 💰 실제 사용량 시나리오 분석

### 시나리오 A: 적극적 사용자 (20%)
```yaml
비율: 1,000명 중 200명
행동 패턴:
  - 사주팔자 2-3개 카테고리: 2.5회
  - 타로 카드 1-2회: 1.5회
  - 꿈해몽 1회: 1회
  - 오늘의 운세 1회: 1회
  - 로또 번호 3회: 0회 (API 미사용)
  
Claude API 호출: 6회/인
일별 총 호출: 200명 × 6회 = 1,200회

토큰 사용량:
  입력: 1,200회 × 650토큰 = 780,000 tokens
  출력: 1,200회 × 1,700토큰 = 2,040,000 tokens
```

### 시나리오 B: 보통 사용자 (50%)
```yaml
비율: 1,000명 중 500명
행동 패턴:
  - 사주팔자 1개 카테고리: 1회
  - 타로 카드 1회: 1회
  - 오늘의 운세 1회: 1회
  - 로또 번호 2회: 0회 (API 미사용)
  
Claude API 호출: 3회/인
일별 총 호출: 500명 × 3회 = 1,500회

토큰 사용량:
  입력: 1,500회 × 600토큰 = 900,000 tokens
  출력: 1,500회 × 1,600토큰 = 2,400,000 tokens
```

### 시나리오 C: 가벼운 사용자 (30%)
```yaml
비율: 1,000명 중 300명
행동 패턴:
  - 로또 번호만 2회: 0회 (API 미사용)
  - 또는 타로 1회만: 1회
  
Claude API 호출: 1회/인
일별 총 호출: 300명 × 1회 = 300회

토큰 사용량:
  입력: 300회 × 500토큰 = 150,000 tokens
  출력: 300회 × 1,400토큰 = 420,000 tokens
```

---

## 📈 일 1,000명 실제 사용량 합계

### 일별 Claude API 호출
```
적극적 사용자: 1,200회
보통 사용자: 1,500회
가벼운 사용자: 300회
━━━━━━━━━━━━━━━━━━━
총 API 호출: 3,000회/일
```

### 일별 토큰 사용량
```
입력 토큰: 1,830,000 tokens (1.83M)
출력 토큰: 4,860,000 tokens (4.86M)
```

### 월별 토큰 사용량 (30일)
```
입력 토큰: 54.9M tokens
출력 토큰: 145.8M tokens
```

---

## 💸 실제 비용 계산 (Claude 3 Haiku)

### Claude 3 Haiku 가격
```
입력: $0.25 / 1M tokens
출력: $1.25 / 1M tokens
```

### 월별 Claude API 비용
```
입력 비용: 54.9M × $0.25 = $13.73
출력 비용: 145.8M × $1.25 = $182.25
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
총 Claude 비용: $196/월
```

### 1회 운세당 비용
```
$196 ÷ 90,000회 = $0.0022 (약 0.2센트)
```

---

## 🎯 캐싱 시스템으로 비용 50% 절감

### 캐싱 가능한 항목
```javascript
// 1. 같은 생년월일 사주 (24시간 캐시)
{
  key: "saju_1990-01-01_남성_총운",
  ttl: 86400 // 24시간
}

// 2. 별자리 일일 운세 (24시간 캐시)
{
  key: "horoscope_물병자리_2025-01-21",
  ttl: 86400
}

// 3. 토정비결 (연 단위 캐시 - 1년)
{
  key: "tojeong_1990-01-01_2025",
  ttl: 31536000 // 1년
}
```

### 캐싱 효과 예상
```
사주팔자: 30% 중복 → 30% 절감
별자리: 50% 중복 (12개 별자리) → 50% 절감
토정비결: 거의 100% 중복 → 95% 절감
타로/꿈해몽: 캐싱 불가 (개인별 다름)

전체 절감률: 약 40-50%
```

### 캐싱 후 비용
```
원래 비용: $196/월
캐싱 후: $98-118/월 (평균 $108/월)
```

---

## 🗄️ MongoDB Atlas 사용량

### 저장 데이터 구조
```javascript
// 사용자 이용권 문서 (1KB)
{
  _id: ObjectId,
  deviceId: "device_xxx",
  tickets: 10,
  history: [...],  // 최근 10건
  createdAt: Date
}

// 운세 결과 캐시 (3KB)
{
  _id: ObjectId,
  type: "saju",
  key: "saju_1990-01-01_남성_총운",
  result: "...",  // 2KB
  createdAt: Date,
  expiresAt: Date
}

// 분석 로그 (0.5KB)
{
  _id: ObjectId,
  deviceId: "device_xxx",
  action: "saju",
  timestamp: Date
}
```

### 일별 저장량
```
사용자 이용권: 1,000명 × 1KB = 1MB
운세 캐시: 3,000회 × 3KB = 9MB (중복 40% = 5.4MB)
분석 로그: 3,000회 × 0.5KB = 1.5MB
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
일별 저장량: 7.9MB/일
```

### 월별 저장량
```
7.9MB × 30일 = 237MB/월

512MB 도달 시간: 512MB ÷ 237MB = 2.2개월
```

---

## 💰 최종 비용 시나리오 (일 1,000명)

### 📅 시나리오 1: 완전 무료 (처음 2개월)
```yaml
기간: 0-2개월
총 비용: $108/월

서비스별:
  - Render: $0 (무료 + UptimeRobot)
  - Vercel: $0 (무료, 45GB/월 사용)
  - MongoDB: $0 (무료, 512MB)
  - Claude API: $108 (캐싱 적용)

문제점:
  ❌ Render Cold Start (30-60초)
  ❌ MongoDB 2개월 후 용량 초과
  ⚠️ 피크 타임 느려짐

장점:
  ✅ 최소 비용
  ✅ 서비스 검증 가능
```

### 📅 시나리오 2: 최소 유료 (권장) ⭐
```yaml
기간: 2개월 후~
총 비용: $124/월 ($1,488/년)

서비스별:
  - Render Starter: $7/월
  - Vercel: $0 (무료)
  - MongoDB M10: $9/월
  - Claude API: $108/월

개선사항:
  ✅ Cold Start 제거 (즉시 응답)
  ✅ 안정적인 DB 성능 (10GB)
  ✅ 4년간 DB 걱정 없음
  ✅ 자동 백업

1회 운세당 비용: $0.00138
방문자당 비용: $0.124
```

### 📅 시나리오 3: 프로덕션 최적화
```yaml
기간: 일 2,000-3,000명 이상
총 비용: $160/월 ($1,920/년)

서비스별:
  - Render Standard: $25/월
  - Vercel Pro: $20/월 (150GB/월 대역폭)
  - MongoDB M10: $9/월
  - Claude API: $108/월 (캐싱)

성능:
  ✅ 동시 접속 500-1,000명
  ✅ 더 빠른 응답 속도
  ✅ 팀 협업 가능
```

---

## 📊 트래픽별 비용 테이블

| 일 방문자 | Claude API | Render | Vercel | MongoDB | 월 합계 |
|----------|------------|--------|--------|---------|---------|
| **500명** | $54 | $0 | $0 | $0 | **$54** |
| **1,000명** | $108 | $7 | $0 | $9 | **$124** ⭐ |
| **2,000명** | $216 | $7 | $0 | $9 | **$232** |
| **3,000명** | $324 | $25 | $20 | $9 | **$378** |
| **5,000명** | $540 | $25 | $20 | $27 | **$612** |
| **10,000명** | $1,080 | $25 | $20 | $27 | **$1,152** |

---

## 🎯 단계별 업그레이드 전략

### Phase 1: 무료 테스트 (0-2개월)
```bash
대상: 일 0-1,000명
비용: $108/월 (Claude만)
기간: 서비스 시작 ~ 2개월

즉시 할 일:
1. ✅ UptimeRobot 설정 (Cold Start 최소화)
2. ✅ 캐싱 시스템 구현 (40-50% 비용 절감)
3. ✅ MongoDB 사용량 모니터링
4. ✅ Rate Limiting 활성화 (이미 적용됨)
```

### Phase 2: 최소 유료 (2개월 후)
```bash
시작 시점: MongoDB 400MB 도달 OR 사용자 불만 증가
비용: $124/월

업그레이드 순서:
1. MongoDB M10 업그레이드 ($9)
2. Render Starter 업그레이드 ($7)
```

### Phase 3: 성장 단계 (일 2,000-3,000명)
```bash
비용: $232-378/월

추가 업그레이드:
- Vercel Pro ($20) - 대역폭 확보
- Render Standard ($25) - 성능 향상
```

---

## 🚀 비용 최적화 전략

### 1️⃣ 캐싱 시스템 (40-50% 절감)
```javascript
// backend/utils/cache-manager.js (새 파일 생성)
const NodeCache = require('node-cache');
const cache = new NodeCache({ 
  stdTTL: 86400,  // 24시간
  checkperiod: 3600  // 1시간마다 만료 확인
});

function getCachedResult(key) {
  return cache.get(key);
}

function setCachedResult(key, value, ttl = 86400) {
  return cache.set(key, value, ttl);
}

// 사주 캐시 키 생성
function getSajuCacheKey(year, month, day, gender, category) {
  return `saju_${year}-${month}-${day}_${gender}_${category}`;
}

module.exports = { getCachedResult, setCachedResult, getSajuCacheKey };
```

### 2️⃣ 토큰 최적화
```javascript
// 프롬프트 최적화로 입력 토큰 20% 절감
// AS-IS: 650 tokens
// TO-BE: 520 tokens (-20%)

// 축약된 프롬프트 사용
// 불필요한 설명 제거
// 핵심 키워드만 전달
```

### 3️⃣ 배치 처리
```javascript
// 별자리 운세는 매일 아침 일괄 생성
// 12개 별자리 × 1회 = 12회만 API 호출
// 나머지는 캐시에서 제공
// 비용 절감: 90% 이상
```

---

## 💡 수익화로 비용 충당

### 광고 수익 (Google Adsense)
```
RPM (1,000 노출당): $1.5-2.5 (한국 평균)
일 3,000 PV × $2 RPM = $6/일
월 수익: $180/월

손익분기점: $124/월
필요 PV: 2,067 PV/일 (약 700명)
```

### 프리미엄 이용권
```
무료: 2개/일
유료: ₩1,000 = 10개 추가

전환율 2%: 1,000명 × 2% = 20명 결제
일 수익: 20명 × ₩1,000 = ₩20,000 ($15)
월 수익: $450/월

순이익: $450 - $124 = $326/월 ✅
```

### 쿠팡 파트너스 (이미 구현됨)
```
// frontend/utils/ticket-system.js
// 쿠팡 링크 클릭 시 이용권 2개 지급

클릭당 수익: ₩50-200 (상품에 따라)
일 100번 클릭: ₩5,000-20,000
월 수익: ₩150,000-600,000 ($115-460)

추가 순이익: $115-460/월
```

---

## 📝 최종 추천 (일 1,000명 기준)

### 🎯 지금 당장 할 일 (무료)
```bash
1. UptimeRobot 설정 (5분)
   → https://uptimerobot.com
   → Monitor: https://fortune-platform.onrender.com
   → Interval: 5분

2. 캐싱 시스템 구현 (1시간)
   → npm install node-cache
   → cache-manager.js 작성
   → server.js에 적용

3. MongoDB 모니터링 (5분)
   → MongoDB Atlas 대시보드 확인
   → 사용량 알림 설정 (400MB 도달 시)
```

### 📅 2개월 후
```bash
IF MongoDB > 400MB OR 사용자 불만 > 10건/주:
  → MongoDB M10 업그레이드 ($9/월)
  → Render Starter 업그레이드 ($7/월)
  
총 비용: $124/월
```

### 🎉 결론
```
✅ 첫 2개월: $108/월 (Claude만)
✅ 2개월 후: $124/월 (안정화)
✅ 캐싱으로 40% 비용 절감
✅ 광고+이용권으로 수익화 가능
✅ 순이익 예상: $300-700/월

**일 1,000명 기준 최적 요금제: $124/월** ⭐
```

---

## 🔥 중요 포인트

1. **Claude API가 90% 비용** - 캐싱이 가장 중요!
2. **MongoDB는 2개월 후 업그레이드 필수**
3. **Render Cold Start는 UptimeRobot으로 해결**
4. **Vercel은 일 3,000명까지 무료 플랜 가능**
5. **수익화 병행 시 흑자 전환 가능**

당장은 **완전 무료 + 캐싱**으로 시작하고, 2개월 후 실제 사용량 보고 업그레이드하세요!