<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íƒ€ë¡œ ì¹´ë“œ - ìš°ë¦¬ì˜ ìš´ì„¸</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Malgun Gothic', sans-serif;
      background: #ffffff;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container {
      max-width: 500px;
      width: 100%;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    .header h1 {
      font-size: 28px;
      color: #333;
      margin-bottom: 10px;
    }
    .header p {
      color: #666;
      font-size: 14px;
    }
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 8px 15px;
      background: #f0f0f0;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      text-decoration: none;
      color: #333;
    }
    .back-btn:hover {
      background: #e0e0e0;
    }
    .top-buttons {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .header-buttons {
      display: flex;
      gap: 8px;
    }
    .top-btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 8px 15px;
      background: white;
      border: 2px solid #ddd;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      color: #333;
    }
    .top-btn:hover {
      background: #f8f8f8;
      border-color: #667eea;
    }
    .user-info-display {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
      font-size: 14px;
      color: #666;
      border: 1px solid #dee2e6;
    }
    .category-section {
      margin-bottom: 30px;
    }
    .category-title {
      font-size: 16px;
      color: #333;
      margin-bottom: 15px;
      text-align: center;
      font-weight: bold;
    }
    .category-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      max-height: 400px;
      overflow-y: auto;
    }
    .category-btn {
      padding: 12px;
      background: white;
      border: 2px solid #dee2e6;
      border-radius: 12px;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s ease;
      font-size: 14px;
    }
    .category-btn:hover {
      background: #FFF5F0;
      border-color: #FFCBA4;
      transform: translateY(-2px);
    }
    .category-btn.active {
      background: #FF6B6B;
      color: white;
      border-color: #FF6B6B;
      font-weight: bold;
    }
    .card-selection-section {
      display: none;
      margin-bottom: 30px;
    }
    .card-selection-section.active {
      display: block;
    }
    .step-indicator {
      text-align: center;
      margin-bottom: 25px;
      background: #f8f9fa;
      padding: 15px;
      border-radius: 12px;
    }
    .step-title {
      font-size: 18px;
      color: #333;
      margin-bottom: 8px;
      font-weight: bold;
    }
    .step-subtitle {
      font-size: 14px;
      color: #666;
    }
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 20px;
      max-width: 450px;
      margin-left: auto;
      margin-right: auto;
    }
    
    /* 5ì¥ì¼ ë•Œ ì—­í”¼ë¼ë¯¸ë“œ ë°°ì¹˜ (3-2) */
    .cards-grid.five-cards {
      grid-template-columns: repeat(6, 1fr);
    }
    
    /* ìƒë‹¨ 3ì¥ì€ 2ì¹¸ì”© ì°¨ì§€ */
    .cards-grid.five-cards .tarot-card:nth-child(1) {
      grid-column: 1 / 3;
    }
    
    .cards-grid.five-cards .tarot-card:nth-child(2) {
      grid-column: 3 / 5;
    }
    
    .cards-grid.five-cards .tarot-card:nth-child(3) {
      grid-column: 5 / 7;
    }
    
    /* í•˜ë‹¨ 2ì¥ì€ ê°€ìš´ë° ì •ë ¬ (2ë²ˆì§¸ì™€ 5ë²ˆì§¸ ì¹¸ ì‹œì‘) */
    .cards-grid.five-cards .tarot-card:nth-child(4) {
      grid-column: 2 / 4;
    }
    
    .cards-grid.five-cards .tarot-card:nth-child(5) {
      grid-column: 4 / 6;
    }
    .tarot-card {
      background: #1a1a1a;
      border: 2px solid #dee2e6;
      border-radius: 12px;
      padding: 12px;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s ease;
      min-height: 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      transform-style: preserve-3d;
    }
    .tarot-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
      border-color: #FF6B6B;
      background: #2a2a2a;
    }
    
    /* hover ì‹œì—ë„ ì„ íƒëœ ì¹´ë“œëŠ” ì›ë˜ ìŠ¤íƒ€ì¼ ìœ ì§€ */
    .tarot-card.selected:hover {
      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
      border-color: #fdcb6e;
    }
    .tarot-card.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }
    .cards-grid.selecting {
      pointer-events: none;
    }
    .tarot-card.flipping {
      animation: flipCard 0.6s ease-in-out;
      pointer-events: none;
    }
    .tarot-card.selected {
      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
      color: #333;
      border-color: #fdcb6e;
      transform: scale(1.05);
      box-shadow: 0 4px 20px rgba(253, 203, 110, 0.4);
    }
    
    /* ì„ íƒëœ ì¹´ë“œì˜ í…ìŠ¤íŠ¸ëŠ” ê²€ì€ìƒ‰ */
    .tarot-card.selected .card-name {
      color: #333;
    }
    @keyframes flipCard {
      0% { transform: rotateY(0deg); }
      50% { transform: rotateY(90deg); }
      100% { transform: rotateY(0deg); }
    }
    .card-revealed {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .card-revealed.active {
      display: flex;
    }
    .tarot-card.reversed {
      transform: rotate(180deg);
    }
    .tarot-card.reversed:hover {
      transform: rotate(180deg) translateY(-10px) scale(1.05);
    }
    .card-back {
      width: 100%;
      height: 120px;
      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      color: white;
      margin-bottom: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .card-name {
      font-size: 13px;
      color: #ffffff;
      font-weight: bold;
    }
    .result-section {
      display: none;
      margin-top: 30px;
      animation: fadeIn 0.5s;
    }
    .result-section.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .result-title {
      font-size: 20px;
      color: #333;
      margin-bottom: 25px;
      text-align: center;
      font-weight: bold;
    }
    .selected-cards-display {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-bottom: 25px;
    }
    .selected-card {
      text-align: center;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 10px;
      border: 1px solid #dee2e6;
    }
    .selected-card-position {
      font-size: 11px;
      color: #666;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .selected-card-name {
      font-size: 13px;
      font-weight: bold;
      color: #333;
    }
    .selected-card-orientation {
      font-size: 11px;
      color: #999;
      margin-top: 5px;
    }
    .meanings-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .meaning-card {
      background: white;
      padding: 18px;
      border-radius: 12px;
      border: 2px solid #dee2e6;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .meaning-position {
      font-size: 15px;
      font-weight: bold;
      color: #FF6B6B;
      margin-bottom: 10px;
    }
    .meaning-text {
      font-size: 14px;
      color: #333;
      line-height: 1.6;
    }
    .action-btn {
      width: 100%;
      padding: 18px;
      background: #ff4757;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
      margin-top: 20px;
    }
    .action-btn:hover {
      background: #ff3838;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
    }
    .action-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal.show {
      display: flex;
    }
    .modal-content {
      background: white;
      border-radius: 15px;
      padding: 30px;
      width: 90%;
      max-width: 400px;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 28px;
      cursor: pointer;
      color: #999;
    }
    .modal-title {
      font-size: 18px;
      margin-bottom: 20px;
      color: #333;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-label {
      display: block;
      margin-bottom: 8px;
      color: #666;
      font-size: 14px;
    }
    .form-select {
      width: 100%;
      padding: 12px;
      border: 2px solid #f0f0f0;
      border-radius: 8px;
      font-size: 16px;
    }
    .date-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
    }
    .submit-btn {
      width: 100%;
      padding: 15px;
      background: #ff6b6b;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 20px;
    }
    .submit-btn:hover {
      background: #ff5252;
    }
    @media (max-width: 768px) {
      .container { 
        padding: 20px; 
        max-width: 100%;
      }
      .category-grid { 
        grid-template-columns: repeat(3, 1fr);
        max-height: 350px;
      }
      .cards-grid { 
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        max-width: 100%;
      }
      /* ëª¨ë°”ì¼ì—ì„œë„ 5ì¥ ì—­í”¼ë¼ë¯¸ë“œ ë°°ì¹˜ ìœ ì§€ */
      .cards-grid.five-cards {
        grid-template-columns: repeat(6, 1fr);
        gap: 8px;
      }
      
      .cards-grid.five-cards .tarot-card:nth-child(1) {
        grid-column: 1 / 3;
      }
      
      .cards-grid.five-cards .tarot-card:nth-child(2) {
        grid-column: 3 / 5;
      }
      
      .cards-grid.five-cards .tarot-card:nth-child(3) {
        grid-column: 5 / 7;
      }
      
      .cards-grid.five-cards .tarot-card:nth-child(4) {
        grid-column: 2 / 4;
      }
      
      .cards-grid.five-cards .tarot-card:nth-child(5) {
        grid-column: 4 / 6;
      }
      
      .tarot-card {
        min-height: 140px;
        padding: 10px;
      }
      .card-back {
        height: 100px;
      }
      .selected-cards-display { 
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
      }
      .selected-card {
        padding: 8px;
      }
      .selected-card-position {
        font-size: 10px;
      }
      .selected-card-name {
        font-size: 11px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="top-buttons">
      <a href="../index.html" class="back-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        ë’¤ë¡œê°€ê¸°
      </a>
      <div class="header-buttons">
        <button class="top-btn" onclick="openModal()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
          </svg>
          ì‚¬ì£¼ë³€ê²½
        </button>
        <button class="top-btn" onclick="shareContent()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="18" cy="5" r="3"/>
            <circle cx="6" cy="12" r="3"/>
            <circle cx="18" cy="19" r="3"/>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
          </svg>
          ê³µìœ í•˜ê¸°
        </button>
      </div>
    </div>

    <div class="header">
      <h1>íƒ€ë¡œ ì¹´ë“œ</h1>
      <p>ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ê³  5ì¥ì˜ ì¹´ë“œë¥¼ ê³¨ë¼ë³´ì„¸ìš”</p>
    </div>

    <!-- ì‚¬ìš©ì ì •ë³´ í‘œì‹œ -->
    <div class="user-info-display" id="userInfoDisplay">
      ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
    </div>

    <div class="category-section" id="categorySection">
      <div class="category-title">ğŸ¯ ì–´ë–¤ ìš´ì„¸ë¥¼ ë³´ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?</div>
      <div class="category-grid" id="categoryGrid"></div>
      <button class="action-btn" style="margin-top: 20px;" onclick="checkTicketAndStartTarot()" id="startBtn" disabled>
        íƒ€ë¡œ ë³´ëŸ¬ ê°€ê¸°
      </button>
    </div>

    <div class="card-selection-section" id="cardSelectionSection">
      <div class="step-indicator">
        <div class="step-title" id="stepTitle">1ë‹¨ê³„: í•µì‹¬ ì¹´ë“œ</div>
        <div class="step-subtitle" id="stepSubtitle">3ì¥ ì¤‘ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš”</div>
      </div>
      <div class="cards-grid" id="cardsGrid"></div>
    </div>

    <div class="result-section" id="resultSection">
      <div class="result-title">íƒ€ë¡œ ë¦¬ë”© ê²°ê³¼</div>
      <div class="selected-cards-display" id="selectedCardsDisplay"></div>
      <div class="meanings-list" id="meaningsList"></div>
      <button class="action-btn" onclick="resetTarot()">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
    </div>

    <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 10px; border-top: 2px solid #e9ecef;">
      <p style="font-size: 12px; color: #999; line-height: 1.8; margin-bottom: 10px;">
        âš ï¸ <strong>ë©´ì±…ì¡°í•­</strong>
      </p>
      <p style="font-size: 11px; color: #666; line-height: 1.8; text-align: justify;">
        ë³¸ ì„œë¹„ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ìš´ì„¸, ì‚¬ì£¼, ë³„ìë¦¬ ë“±ì˜ ì½˜í…ì¸ ëŠ” <strong>ì—”í„°í…Œì¸ë¨¼íŠ¸ ë° ì°¸ê³  ëª©ì </strong>ìœ¼ë¡œë§Œ ì œê³µë˜ë©°, 
        ì–´ë– í•œ ê³¼í•™ì Â·ì˜í•™ì Â·ë²•ì  ê·¼ê±°ë‚˜ ë³´ì¦ì„ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. 
        ë³¸ ì„œë¹„ìŠ¤ëŠ” ì¿ íŒ¡íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ ì¼ì •ì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ìŠµë‹ˆë‹¤. 
        ë³¸ ì„œë¹„ìŠ¤ì˜ ë‚´ìš©ì€ <strong>ê°œì¸ì˜ íŒë‹¨ì´ë‚˜ ì˜ì‚¬ê²°ì •ì˜ ìœ ì¼í•œ ê·¼ê±°ë¡œ ì‚¬ìš©ë˜ì–´ì„œëŠ” ì•ˆ ë˜ë©°</strong>, 
        ì¤‘ìš”í•œ ê²°ì •ì€ ë°˜ë“œì‹œ ì „ë¬¸ê°€ì™€ ìƒë‹´í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤. 
        ë³¸ ì„œë¹„ìŠ¤ ì´ìš©ìœ¼ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ì–´ë– í•œ ì§ì ‘ì Â·ê°„ì ‘ì  ì†í•´ì— ëŒ€í•´ì„œë„ 
        ë‹¹ì‚¬ëŠ” ë²•ì  ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </p>
      <p style="font-size: 10px; color: #999; margin-top: 10px; text-align: center;">
        Â© 2025 ìš°ë¦¬ì˜ ìš´ì„¸. All rights reserved.
      </p>
    </div>
  </div>

  <!-- ì‚¬ì£¼ ë³€ê²½ ëª¨ë‹¬ -->
  <div class="modal" id="sajuModal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal()">&times;</span>
      <h2 class="modal-title">ì‚¬ì£¼íŒ”ìë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ì„œëŠ”<br>ì•„ë˜ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤.</h2>

      <div class="form-group">
        <label class="form-label">ì„±ë³„</label>
        <select class="form-select" id="gender">
          <option value="ë‚¨ì„±">ë‚¨ì„±</option>
          <option value="ì—¬ì„±">ì—¬ì„±</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">ì–‘ë ¥/ìŒë ¥</label>
        <select class="form-select" id="calendarType">
          <option value="ì–‘ë ¥/ìŒë ¥">ì–‘ë ¥/ìŒë ¥</option>
          <option value="ìŒë ¥(í‰ë‹¬)">ìŒë ¥(í‰ë‹¬)</option>
          <option value="ìŒë ¥(ìœ¤ë‹¬)">ìŒë ¥(ìœ¤ë‹¬)</option>
          <option value="ì–‘ë ¥">ì–‘ë ¥</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">ìƒë…„ì›”ì¼</label>
        <div class="date-inputs">
          <select class="form-select" id="year"></select>
          <select class="form-select" id="month"></select>
          <select class="form-select" id="day"></select>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">íƒœì–´ë‚œ ì‹œê°„</label>
        <select class="form-select" id="birthTime">
          <option value="íƒœì–´ë‚œ ì‹œê°„">íƒœì–´ë‚œ ì‹œê°„</option>
          <option value="ì‹œê°„ ëª¨ë¦„">ì‹œê°„ ëª¨ë¦„</option>
          <option value="å­(00:00~01:30)">å­(00:00~01:30)</option>
          <option value="ä¸‘(01:31~03:30)">ä¸‘(01:31~03:30)</option>
          <option value="å¯…(03:31~05:30)">å¯…(03:31~05:30)</option>
          <option value="å¯(05:31~07:30)">å¯(05:31~07:30)</option>
          <option value="è¾°(07:31~09:30)">è¾°(07:31~09:30)</option>
          <option value="å·³(09:31~11:30)">å·³(09:31~11:30)</option>
          <option value="åˆ(11:31~13:30)">åˆ(11:31~13:30)</option>
          <option value="æœª(13:31~15:30)">æœª(13:31~15:30)</option>
          <option value="ç”³(15:31~17:30)">ç”³(15:31~17:30)</option>
          <option value="é…‰(17:31~19:30)">é…‰(17:31~19:30)</option>
          <option value="æˆŒ(19:31~21:30)">æˆŒ(19:31~21:30)</option>
          <option value="äº¥(21:31~23:30)">äº¥(21:31~23:30)</option>
          <option value="å­(23:31~23:59)">å­(23:31~23:59)</option>
        </select>
      </div>

      <button class="submit-btn" onclick="saveSaju()">ì €ì¥í•˜ê¸°</button>
    </div>
  </div>

  <!-- ë””ë°”ì´ìŠ¤ ID & API í—¬í¼ -->
  <script src="../utils/device-id.js"></script>
  <script src="../utils/ticket-system.js"></script>
  <script src="../utils/api-helper.js"></script>

  <script>
    // ticket-system.jsì—ì„œ ì´ë¯¸ isLocalhostì™€ API_BASE_URLì´ ì„ ì–¸ë˜ì–´ ìˆìŒ
    console.log('[Tarot] Environment:', isLocalhost ? 'Local' : 'Production');
    console.log('[Tarot] API URL:', API_BASE_URL);

    // íƒ€ë¡œ ì¹´ë“œ ì˜ë¯¸ ë°ì´í„° (3,276ê°œ í…Œë§ˆë³„ í•´ì„)
    let TAROT_MEANINGS = null;
    let MEANINGS_LOADED = false;
    
    // JSON íŒŒì¼ ë¡œë“œ
    async function loadTarotMeanings() {
      try {
        // ì„œë²„ë¥¼ í†µí•´ ë¡œë“œ (CORS ë¬¸ì œ í•´ê²°)
        const response = await fetch(API_BASE_URL + '/engines/data/tarot-cards-meanings.json');
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        TAROT_MEANINGS = await response.json();
        MEANINGS_LOADED = true;
        console.log('âœ… íƒ€ë¡œ ì˜ë¯¸ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', TAROT_MEANINGS.description);
        console.log('âœ… ì´ ì¹´ë“œ ìˆ˜:', Object.keys(TAROT_MEANINGS.meanings).length);
      } catch (error) {
        console.error('âŒ íƒ€ë¡œ ì˜ë¯¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        MEANINGS_LOADED = false;
      }
    }
    
    // í˜ì´ì§€ ë¡œë“œì‹œ ë°ì´í„° ë¡œë“œ
    loadTarotMeanings();
    
    // íƒ€ë¡œ ì¹´ë“œ ë°ì´í„° (22ì¥ ë©”ì´ì € ì•„ë¥´ì¹´ë‚˜)
    const TAROT_CARDS = [
      {id:"major_00",number:0,name:"The Fool",name_ko:"ë°”ë³´",keywords_upright:["ìƒˆë¡œìš´ ì‹œì‘","ìˆœìˆ˜í•¨","ììœ ","ëª¨í—˜"],keywords_reversed:["ë¬´ëª¨í•¨","ê²½ì†”í•¨","ì¤€ë¹„ ë¶€ì¡±"],meaning_upright:"ìƒˆë¡œìš´ ì—¬ì •ì˜ ì‹œì‘ì…ë‹ˆë‹¤. ë‘ë ¤ì›€ ì—†ì´ ì•ìœ¼ë¡œ ë‚˜ì•„ê°€ì„¸ìš”.",meaning_reversed:"ë¬´ëª¨í•œ ê²°ì •ì„ ì¡°ì‹¬í•˜ì„¸ìš”. ì¤€ë¹„ê°€ í•„ìš”í•©ë‹ˆë‹¤."},
      {id:"major_01",number:1,name:"The Magician",name_ko:"ë§ˆë²•ì‚¬",keywords_upright:["ì°½ì¡°ë ¥","ì˜ì§€ë ¥","ê¸°ìˆ ","ì‹¤í–‰ë ¥"],keywords_reversed:["ì¡°ì‘","ì†ì„ìˆ˜","ì¬ëŠ¥ ë‚­ë¹„"],meaning_upright:"ëª©í‘œë¥¼ ì´ë£° ëª¨ë“  ëŠ¥ë ¥ì´ ìˆìŠµë‹ˆë‹¤. ì°½ì¡°ì  ì—ë„ˆì§€ê°€ ë„˜ì¹©ë‹ˆë‹¤.",meaning_reversed:"ì¬ëŠ¥ì„ ë‚­ë¹„í•˜ê±°ë‚˜ ì˜ëª»ëœ ë°©í–¥ìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤."},
      {id:"major_02",number:2,name:"The High Priestess",name_ko:"ì—¬ì‚¬ì œ",keywords_upright:["ì§ê´€","ì ì¬ì˜ì‹","ì‹ ë¹„","ë‚´ë©´ì˜ ì§€í˜œ"],keywords_reversed:["ë¬´ì‹œëœ ì§ê´€","í‘œë©´ì  ì§€ì‹"],meaning_upright:"ë‚´ë©´ì˜ ëª©ì†Œë¦¬ì— ê·€ ê¸°ìš¸ì´ì„¸ìš”. ì§ê´€ì´ ë‹µì„ ì•Œê³  ìˆìŠµë‹ˆë‹¤.",meaning_reversed:"ì§ê´€ì„ ë¬´ì‹œí•˜ê³  ê²‰ìœ¼ë¡œ ë“œëŸ¬ë‚œ ê²ƒë§Œ ë³´ê³  ìˆìŠµë‹ˆë‹¤."},
      {id:"major_03",number:3,name:"The Empress",name_ko:"ì—¬í™©ì œ",keywords_upright:["í’ìš”","ì°½ì¡°ì„±","ì–‘ìœ¡","ìì—°","ë²ˆì˜"],keywords_reversed:["ê³¼ì‰ë³´í˜¸","ì˜ì¡´","ì°½ì¡°ì„± ì°¨ë‹¨"],meaning_upright:"í’ìš”ë¡­ê³  ì°½ì¡°ì ì¸ ì‹œê¸°ì…ë‹ˆë‹¤. ìì—°ìŠ¤ëŸ¬ìš´ ì„±ì¥ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.",meaning_reversed:"ê³¼ì‰ë³´í˜¸í•˜ê±°ë‚˜ ì˜ì¡´í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë…ë¦½ì„±ì´ í•„ìš”í•©ë‹ˆë‹¤."},
      {id:"major_04",number:4,name:"The Emperor",name_ko:"í™©ì œ",keywords_upright:["ê¶Œìœ„","êµ¬ì¡°","ì•ˆì •","ë¦¬ë”ì‹­","ì•„ë²„ì§€"],keywords_reversed:["ë…ì¬","ê²½ì§ì„±","í†µì œ ê³¼ì‰"],meaning_upright:"ì•ˆì •ê³¼ êµ¬ì¡°ë¥¼ ë§Œë“œëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ë¦¬ë”ì‹­ì„ ë°œíœ˜í•˜ì„¸ìš”.",meaning_reversed:"ì§€ë‚˜ì¹œ í†µì œë‚˜ ê²½ì§ëœ ì‚¬ê³ ë°©ì‹ì„ ì¡°ì‹¬í•˜ì„¸ìš”."},
      {id:"major_05",number:5,name:"The Hierophant",name_ko:"êµí™©",keywords_upright:["ì „í†µ","ì˜ì  ì§€í˜œ","êµìœ¡","ì˜ì‹","ì‹ ë…"],keywords_reversed:["ë…ë‹¨","í˜•ì‹ì£¼ì˜","ë°˜í•­"],meaning_upright:"ì „í†µê³¼ ì˜ì  ì§€í˜œë¥¼ ë°°ìš°ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ë©˜í† ì˜ ì¡°ì–¸ì„ êµ¬í•˜ì„¸ìš”.",meaning_reversed:"ë‚¡ì€ ê´€ìŠµì— ì–½ë§¤ì´ê±°ë‚˜ ë…ë‹¨ì ìœ¼ë¡œ í–‰ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤."},
      {id:"major_06",number:6,name:"The Lovers",name_ko:"ì—°ì¸",keywords_upright:["ì‚¬ë‘","ì¡°í™”","ì„ íƒ","ê´€ê³„","ê²°í•©"],keywords_reversed:["ë¶ˆí™”","ì˜ëª»ëœ ì„ íƒ","ë¶„ë¦¬"],meaning_upright:"ì§„ì •í•œ ì‚¬ë‘ê³¼ ì¡°í™”ë¥¼ ê²½í—˜í•©ë‹ˆë‹¤. ì¤‘ìš”í•œ ì„ íƒì˜ ì‹œê¸°ì…ë‹ˆë‹¤.",meaning_reversed:"ê´€ê³„ì— ë¶ˆí™”ê°€ ìˆê±°ë‚˜ ì˜ëª»ëœ ì„ íƒì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤."},
      {id:"major_07",number:7,name:"The Chariot",name_ko:"ì „ì°¨",keywords_upright:["ìŠ¹ë¦¬","ì˜ì§€","ê²°ë‹¨ë ¥","í†µì œ","ì„±ê³µ"],keywords_reversed:["í†µì œ ìƒì‹¤","ë°©í–¥ ìƒì‹¤","ê³µê²©ì„±"],meaning_upright:"ê°•í•œ ì˜ì§€ë ¥ìœ¼ë¡œ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ìŠ¹ë¦¬ê°€ ê°€ê¹Œì´ ìˆìŠµë‹ˆë‹¤.",meaning_reversed:"ë°©í–¥ì„ ìƒì—ˆê±°ë‚˜ ê³¼ë„í•œ ê³µê²©ì„±ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤."},
      {id:"major_08",number:8,name:"Strength",name_ko:"í˜",keywords_upright:["ìš©ê¸°","ë‚´ì  í˜","ì¸ë‚´","ìë¹„","ê·¹ë³µ"],keywords_reversed:["ìê¸° ì˜ì‹¬","ì•½í•¨","í†µì œ ë¶ˆëŠ¥"],meaning_upright:"ë¶€ë“œëŸ¬ìš´ í˜ìœ¼ë¡œ ì–´ë ¤ì›€ì„ ê·¹ë³µí•©ë‹ˆë‹¤. ìš©ê¸°ì™€ ì¸ë‚´ê°€ í•„ìš”í•©ë‹ˆë‹¤.",meaning_reversed:"ìì‹ ê°ì„ ìƒì—ˆê±°ë‚˜ ê°ì •ì„ í†µì œí•˜ì§€ ëª»í•˜ê³  ìˆìŠµë‹ˆë‹¤."},
      {id:"major_09",number:9,name:"The Hermit",name_ko:"ì€ë‘”ì",keywords_upright:["ê³ ë…","ì„±ì°°","ë‚´ì  íƒêµ¬","ì§€í˜œ","ì˜ì  ê¹¨ë‹¬ìŒ"],keywords_reversed:["ê³ ë¦½","ì™¸ë¡œì›€","ë‚´ì  ê³µí—ˆ"],meaning_upright:"í™€ë¡œ ìˆëŠ” ì‹œê°„ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‚´ë©´ì„ ì„±ì°°í•˜ê³  ì§€í˜œë¥¼ ì°¾ìœ¼ì„¸ìš”.",meaning_reversed:"ê³ ë¦½ë˜ì–´ ì™¸ë¡œì›€ì„ ëŠë¼ê³  ìˆìŠµë‹ˆë‹¤. íƒ€ì¸ê³¼ì˜ ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤."},
      {id:"major_10",number:10,name:"Wheel of Fortune",name_ko:"ìš´ëª…ì˜ ìˆ˜ë ˆë°”í€´",keywords_upright:["ìš´ëª…","ë³€í™”","í–‰ìš´","ìˆœí™˜","ì „í™˜ì "],keywords_reversed:["ë¶ˆìš´","ì €í•­","ì•…ìˆœí™˜"],meaning_upright:"ìš´ëª…ì˜ ë³€í™”ê°€ ì°¾ì•„ì˜µë‹ˆë‹¤. ê¸ì •ì ì¸ ì „í™˜ì ì…ë‹ˆë‹¤.",meaning_reversed:"ë³€í™”ì— ì €í•­í•˜ê³  ìˆê±°ë‚˜ ë¶ˆìš´ì˜ ì‹œê¸°ì…ë‹ˆë‹¤."},
      {id:"major_11",number:11,name:"Justice",name_ko:"ì •ì˜",keywords_upright:["ì •ì˜","ì§„ì‹¤","ê³µì •í•¨","ì±…ì„","ì¸ê³¼ì‘ë³´"],keywords_reversed:["ë¶ˆê³µì •","í¸ê²¬","ì±…ì„ íšŒí”¼"],meaning_upright:"ê³µì •í•œ íŒë‹¨ê³¼ ì •ì˜ê°€ ì‹¤í˜„ë©ë‹ˆë‹¤. ì§„ì‹¤ì´ ë°í˜€ì§‘ë‹ˆë‹¤.",meaning_reversed:"ë¶ˆê³µì •í•˜ê±°ë‚˜ í¸ê²¬ì— ì‚¬ë¡œì¡í˜€ ìˆìŠµë‹ˆë‹¤."},
      {id:"major_12",number:12,name:"The Hanged Man",name_ko:"ë§¤ë‹¬ë¦° ì‚¬ëŒ",keywords_upright:["í¬ìƒ","ìƒˆë¡œìš´ ê´€ì ","ì •ì§€","surrender","ê¹¨ë‹¬ìŒ"],keywords_reversed:["ì €í•­","ì§€ì—°","í—›ëœ í¬ìƒ"],meaning_upright:"ì ì‹œ ë©ˆì¶”ê³  ìƒˆë¡œìš´ ê´€ì ì—ì„œ ë³´ì„¸ìš”. ì˜ë¯¸ ìˆëŠ” í¬ìƒì…ë‹ˆë‹¤.",meaning_reversed:"ë¶ˆí•„ìš”í•œ í¬ìƒì´ê±°ë‚˜ ë³€í™”ë¥¼ ê±°ë¶€í•˜ê³  ìˆìŠµë‹ˆë‹¤."},
      {id:"major_13",number:13,name:"Death",name_ko:"ì£½ìŒ",keywords_upright:["ë³€í™”","ëê³¼ ì‹œì‘","ë³€í™˜","í•´ë°©","ì¬íƒ„ìƒ"],keywords_reversed:["ë³€í™” ì €í•­","ì •ì²´","ì§‘ì°©"],meaning_upright:"ë‚¡ì€ ê²ƒì´ ëë‚˜ê³  ìƒˆë¡œìš´ ê²ƒì´ ì‹œì‘ë©ë‹ˆë‹¤. ë³€í™”ë¥¼ ë°›ì•„ë“¤ì´ì„¸ìš”.",meaning_reversed:"ë³€í™”ë¥¼ ë‘ë ¤ì›Œí•˜ê³  ê³¼ê±°ì— ì§‘ì°©í•˜ê³  ìˆìŠµë‹ˆë‹¤."},
      {id:"major_14",number:14,name:"Temperance",name_ko:"ì ˆì œ",keywords_upright:["ê· í˜•","ì ˆì œ","ì¡°í™”","ì¸ë‚´","í†µí•©"],keywords_reversed:["ë¶ˆê· í˜•","ê³¼ì‰","ì¡°ê¸‰í•¨"],meaning_upright:"ê· í˜•ê³¼ ì¡°í™”ë¥¼ ì°¾ìœ¼ì„¸ìš”. ì ˆì œì™€ ì¸ë‚´ê°€ í•„ìš”í•©ë‹ˆë‹¤.",meaning_reversed:"ê· í˜•ì„ ìƒì—ˆê±°ë‚˜ ê³¼ì‰ì— ë¹ ì ¸ìˆìŠµë‹ˆë‹¤."},
      {id:"major_15",number:15,name:"The Devil",name_ko:"ì•…ë§ˆ",keywords_upright:["ì†ë°•","ì¤‘ë…","ë¬¼ì§ˆì£¼ì˜","ìœ í˜¹","ê·¸ë¦¼ì"],keywords_reversed:["í•´ë°©","ê·¹ë³µ","ììœ ","ê¹¨ë‹¬ìŒ"],meaning_upright:"ë¬´ì–¸ê°€ì— ì†ë°•ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì¤‘ë…ì´ë‚˜ ì§‘ì°©ì„ ì¡°ì‹¬í•˜ì„¸ìš”.",meaning_reversed:"ì†ë°•ì—ì„œ ë²—ì–´ë‚˜ ììœ ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤."},
      {id:"major_16",number:16,name:"The Tower",name_ko:"íƒ‘",keywords_upright:["íŒŒê´´","í˜¼ë€","ê°‘ì‘ìŠ¤ëŸ° ë³€í™”","ê¹¨ë‹¬ìŒ","í•´ì²´"],keywords_reversed:["ì¬ê±´","íšŒë³µ","ìœ„ê¸° íšŒí”¼"],meaning_upright:"ê°‘ì‘ìŠ¤ëŸ° ë³€í™”ì™€ í˜¼ë€ì´ ì˜µë‹ˆë‹¤. ë‚¡ì€ êµ¬ì¡°ê°€ ë¬´ë„ˆì§‘ë‹ˆë‹¤.",meaning_reversed:"ìµœì•…ì€ ì§€ë‚˜ê°”ìŠµë‹ˆë‹¤. ì¬ê±´ì˜ ì‹œê¸°ì…ë‹ˆë‹¤."},
      {id:"major_17",number:17,name:"The Star",name_ko:"ë³„",keywords_upright:["í¬ë§","ì˜ê°","í‰í™”","ì¹˜ìœ ","ë‚™ê´€"],keywords_reversed:["ì ˆë§","ì‹¤ë§","ìì‹ ê° ìƒì‹¤"],meaning_upright:"í¬ë§ê³¼ ì˜ê°ì´ ì°¾ì•„ì˜µë‹ˆë‹¤. ì¹˜ìœ ì™€ í‰í™”ì˜ ì‹œê¸°ì…ë‹ˆë‹¤.",meaning_reversed:"í¬ë§ì„ ìƒì—ˆê±°ë‚˜ ìì‹ ê°ì´ ì—†ìŠµë‹ˆë‹¤."},
      {id:"major_18",number:18,name:"The Moon",name_ko:"ë‹¬",keywords_upright:["í™˜ìƒ","ë¶ˆì•ˆ","ì§ê´€","ë¬´ì˜ì‹","í˜¼ë€"],keywords_reversed:["ëª…ë£Œí•¨","ì§„ì‹¤ ë“œëŸ¬ë‚¨","ë¶ˆì•ˆ í•´ì†Œ"],meaning_upright:"ë¶ˆí™•ì‹¤ì„±ê³¼ í™˜ìƒì´ ìˆìŠµë‹ˆë‹¤. ì§ê´€ì„ ë¯¿ë˜ ì‹ ì¤‘í•˜ì„¸ìš”.",meaning_reversed:"ì§„ì‹¤ì´ ë“œëŸ¬ë‚˜ê³  ë¶ˆì•ˆì´ í•´ì†Œë©ë‹ˆë‹¤."},
      {id:"major_19",number:19,name:"The Sun",name_ko:"íƒœì–‘",keywords_upright:["ì„±ê³µ","ê¸°ì¨","í™œë ¥","ëª…ë£Œí•¨","ê¸ì •"],keywords_reversed:["ì¼ì‹œì  ì‹¤ë§","ê³¼ë„í•œ ë‚™ê´€"],meaning_upright:"ì„±ê³µê³¼ ê¸°ì¨ì´ ê°€ê¹Œí•©ë‹ˆë‹¤. ëª¨ë“  ê²ƒì´ ë°ì•„ì§‘ë‹ˆë‹¤.",meaning_reversed:"ì¼ì‹œì ì¸ ì‹¤ë§ì´ ìˆì§€ë§Œ ê³§ íšŒë³µë©ë‹ˆë‹¤."},
      {id:"major_20",number:20,name:"Judgement",name_ko:"ì‹¬íŒ",keywords_upright:["ë¶€í™œ","ê°ì„±","íŒë‹¨","ìš©ì„œ","ê°±ì‹ "],keywords_reversed:["ìê¸° ë¹„íŒ","í›„íšŒ","ìš©ì„œ ëª»í•¨"],meaning_upright:"ìƒˆë¡œìš´ ê°ì„±ê³¼ ë¶€í™œì˜ ì‹œê¸°ì…ë‹ˆë‹¤. ê³¼ê±°ë¥¼ ìš©ì„œí•˜ì„¸ìš”.",meaning_reversed:"ìì‹ ì„ ì§€ë‚˜ì¹˜ê²Œ ë¹„íŒí•˜ê±°ë‚˜ ê³¼ê±°ë¥¼ ìš©ì„œí•˜ì§€ ëª»í•˜ê³  ìˆìŠµë‹ˆë‹¤."},
      {id:"major_21",number:21,name:"The World",name_ko:"ì„¸ê³„",keywords_upright:["ì™„ì„±","ì„±ì·¨","í†µí•©","ì—¬í–‰","ì¶©ë§Œ"],keywords_reversed:["ë¯¸ì™„ì„±","ì§€ì—°","ëª©í‘œ ë¯¸ë‹¬"],meaning_upright:"í•œ ì£¼ê¸°ê°€ ì™„ì„±ë©ë‹ˆë‹¤. í° ì„±ì·¨ì™€ ì¶©ë§Œí•¨ì„ ëŠë‚ë‹ˆë‹¤.",meaning_reversed:"ì•„ì§ ì™„ì„±ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ëª©í‘œì— ë¯¸ë‹¬í–ˆìŠµë‹ˆë‹¤."}
    ];

    const CATEGORIES = [
      { id: 'total', emoji: 'ğŸ“Š', name: 'ì´ìš´' },
      { id: 'personality', emoji: 'ğŸ˜Š', name: 'ì„±ê²©' },
      { id: 'daeun', emoji: 'ğŸŒŸ', name: 'ëŒ€ìš´' },
      { id: 'wealth', emoji: 'ğŸ’°', name: 'ì¬ë¬¼ìš´' },
      { id: 'love', emoji: 'ğŸ’•', name: 'ì• ì •ìš´' },
      { id: 'parents', emoji: 'ğŸ‘´', name: 'ë¶€ëª¨ìš´' },
      { id: 'siblings', emoji: 'ğŸ‘«', name: 'í˜•ì œìš´' },
      { id: 'children', emoji: 'ğŸ‘¶', name: 'ìë…€ìš´' },
      { id: 'spouse', emoji: 'ğŸ’‘', name: 'ë°°ìš°ììš´' },
      { id: 'social', emoji: 'ğŸ¤', name: 'ëŒ€ì¸ê´€ê³„' },
      { id: 'health', emoji: 'ğŸ¥', name: 'ê±´ê°•ìš´' },
      { id: 'career', emoji: 'ğŸ’¼', name: 'ì§ì—…ìš´' },
      { id: 'study', emoji: 'ğŸ“š', name: 'í•™ì—…ìš´' },
      { id: 'promotion', emoji: 'ğŸ“ˆ', name: 'ìŠ¹ì§„ìš´' },
      { id: 'aptitude', emoji: 'ğŸ¯', name: 'ì ì„±' },
      { id: 'job', emoji: 'ğŸ‘”', name: 'ì§ì—…ì¶”ì²œ' },
      { id: 'business', emoji: 'ğŸ¢', name: 'ì‚¬ì—…ìš´' },
      { id: 'move', emoji: 'ğŸšš', name: 'ì´ë™ìš´' },
      { id: 'travel', emoji: 'âœˆï¸', name: 'ì—¬í–‰ìš´' },
      { id: 'taekil', emoji: 'ğŸ“…', name: 'íƒì¼' },
      { id: 'sinsal', emoji: 'â­', name: 'ì‹ ì‚´' }
    ];

    let currentStep = 0;
    let selectedCategory = null;
    let selectedCards = [];
    let remainingDeck = [];
    let isSelecting = false; // â­ ì¤‘ë³µ í´ë¦­ ë°©ì§€ í”Œë˜ê·¸

    window.addEventListener('DOMContentLoaded', () => {
      renderCategories();
      loadUserInfo();
    });

    // ì‚¬ìš©ì ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadUserInfo() {
      const savedData = localStorage.getItem('fortuneUserData');
      const userInfoDisplay = document.getElementById('userInfoDisplay');
      
      if (savedData) {
        const data = JSON.parse(savedData);
        const display = `${data.gender} ${data.year}. ${data.month}. ${data.day} (${data.calendarType}) íƒœì–´ë‚œ ì‹œê°„ : ${data.birthTime}`;
        userInfoDisplay.textContent = display;
      } else {
        userInfoDisplay.innerHTML = `
          âš ï¸ ì–´ë–¤ ìš´ì„¸ë¥¼ ë³´ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?
        `;
      }
    }

    function renderCategories() {
      const grid = document.getElementById('categoryGrid');
      grid.innerHTML = CATEGORIES.map(cat => `
        <button class="category-btn" onclick="selectCategory('${cat.id}')">
          ${cat.emoji} ${cat.name}
        </button>
      `).join('');
    }

    function shuffleDeck() {
      const deck = [...TAROT_CARDS];
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      return deck;
    }

    function getRandomOrientation() {
      return Math.random() < 0.5 ? 'upright' : 'reversed';
    }

    function getRandomCards(count) {
      const cards = [];
      
      // ì¹´ë“œê°€ ë¶€ì¡±í•˜ë©´ ì´ë¯¸ ì„ íƒëœ ì¹´ë“œë¥¼ ì œì™¸í•˜ê³  ë±ì„ ë‹¤ì‹œ ë§Œë“¦
      while (cards.length < count) {
        if (remainingDeck.length === 0) {
          // ë±ì´ ë¹„ì—ˆìœ¼ë©´ ì„ íƒëœ ì¹´ë“œ ì œì™¸í•˜ê³  ë‹¤ì‹œ ì…”í”Œ
          const usedIds = selectedCards.map(c => c.id);
          const availableCards = TAROT_CARDS.filter(c => !usedIds.includes(c.id));
          
          if (availableCards.length === 0) {
            // ëª¨ë“  ì¹´ë“œë¥¼ ì´ë¯¸ ì‚¬ìš©í–ˆìœ¼ë©´ ì „ì²´ ë± ë‹¤ì‹œ ì…”í”Œ
            remainingDeck = shuffleDeck();
          } else {
            // ì‚¬ìš©í•˜ì§€ ì•Šì€ ì¹´ë“œë§Œ ì…”í”Œ
            remainingDeck = [...availableCards];
            for (let i = remainingDeck.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [remainingDeck[i], remainingDeck[j]] = [remainingDeck[j], remainingDeck[i]];
            }
          }
        }
        
        const card = remainingDeck.pop();
        const orientation = getRandomOrientation();
        cards.push({ ...card, orientation });
      }
      
      console.log(`âœ… ${count}ì¥ ì¹´ë“œ ìƒì„± ì™„ë£Œ, ë‚¨ì€ ë±: ${remainingDeck.length}ì¥`);
      return cards;
    }

    function selectCategory(categoryId) {
      selectedCategory = categoryId;
      
      // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // í´ë¦­í•œ ë²„íŠ¼ í™œì„±í™”
      event.target.closest('.category-btn').classList.add('active');
      
      // íƒ€ë¡œ ë³´ëŸ¬ ê°€ê¸° ë²„íŠ¼ í™œì„±í™”
      document.getElementById('startBtn').disabled = false;
    }

    function startTarotReading() {
      // ğŸ“Š ì´ìš©ê¶Œ ì‚¬ìš© ì¶”ì 
      if (typeof trackTicketUsage === 'function') {
        trackTicketUsage('íƒ€ë¡œ ì¹´ë“œ');
      }
      
      if (!selectedCategory) {
        alert('ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
      document.getElementById('categorySection').style.display = 'none';
      
      // ì¹´ë“œ ì„ íƒ ì‹œì‘
      currentStep = 1;
      selectedCards = [];
      remainingDeck = shuffleDeck();

      const currentCards = getRandomCards(3);
      document.getElementById('cardSelectionSection').classList.add('active');
      renderCards(currentCards, 3);
      updateStepIndicator(1, '3ì¥ ì¤‘ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš” (í•µì‹¬ ì¹´ë“œ)');
    }

    let currentDisplayCards = [];
    function renderCards(cards, count) {
      currentDisplayCards = cards;
      const grid = document.getElementById('cardsGrid');
      
      // 5ì¥ì¼ ë•Œ í´ë˜ìŠ¤ ì¶”ê°€
      if (count === 5) {
        grid.classList.add('five-cards');
      } else {
        grid.classList.remove('five-cards');
      }
      
      grid.innerHTML = cards.slice(0, count).map((card, index) => `
        <div class="tarot-card" id="card-${index}" onclick="selectCard(${index})">
          <div class="card-back-view">
            <img src="/images/tarot/CardBacks.png" 
                 alt="ì¹´ë“œ ë’·ë©´" 
                 style="width: 100%; height: 120px; object-fit: cover; border-radius: 10px; margin-bottom: 8px;">
            <div class="card-name">ì¹´ë“œ ${index + 1}</div>
          </div>
          <div class="card-revealed" id="revealed-${index}">
            <img src="" 
                 id="revealed-img-${index}"
                 alt="íƒ€ë¡œ ì¹´ë“œ" 
                 style="width: 100%; height: 120px; object-fit: cover; border-radius: 10px; margin-bottom: 8px;">
            <div class="card-name" id="revealed-name-${index}" style="font-weight: bold; font-size: 15px;"></div>
            <div class="card-orientation" id="revealed-orientation-${index}" style="color: #667eea; font-size: 13px;"></div>
          </div>
        </div>
      `).join('');
    }

    function updateStepIndicator(step, subtitle) {
      const titles = ['', '1ë‹¨ê³„: í•µì‹¬ ì¹´ë“œ', '2ë‹¨ê³„: ê³¼ê±° ì¹´ë“œ', '3ë‹¨ê³„: ë¯¸ë˜ ì¹´ë“œ', '4ë‹¨ê³„: ì¡°ì–¸ ì¹´ë“œ', '5ë‹¨ê³„: ê²°ê³¼ ì¹´ë“œ'];
      document.getElementById('stepTitle').textContent = titles[step];
      document.getElementById('stepSubtitle').textContent = subtitle;
    }

    async function selectCard(cardIndex) {
      // â­ ì¤‘ë³µ í´ë¦­ ë°©ì§€
      if (isSelecting) {
        console.log('âš ï¸ ì´ë¯¸ ì¹´ë“œ ì„ íƒ ì¤‘ì…ë‹ˆë‹¤...');
        return;
      }

      // â­ ì„ íƒ ì‹œì‘ í”Œë˜ê·¸ ì„¤ì •
      isSelecting = true;
      const cardsGrid = document.getElementById('cardsGrid');
      cardsGrid.classList.add('selecting');

      const selectedCard = currentDisplayCards[cardIndex];
      const cardElement = document.getElementById(`card-${cardIndex}`);
      
      // í´ë¦­ ë°©ì§€
      cardElement.style.pointerEvents = 'none';
      
      // ì¹´ë“œ ë’¤ì§‘ê¸° ì• ë‹ˆë©”ì´ì…˜
      cardElement.classList.add('flipping');
      
      // 0.3ì´ˆ í›„ (ì• ë‹ˆë©”ì´ì…˜ ì¤‘ê°„) ì¹´ë“œ ë‚´ìš© ë³€ê²½
      setTimeout(() => {
        // ë’·ë©´ ìˆ¨ê¸°ê¸°
        cardElement.querySelector('.card-back-view').style.display = 'none';
        
        // ì•ë©´ ë³´ì—¬ì£¼ê¸°
        const revealed = document.getElementById(`revealed-${cardIndex}`);
        const revealedImg = document.getElementById(`revealed-img-${cardIndex}`);
        const revealedName = document.getElementById(`revealed-name-${cardIndex}`);
        const revealedOrientation = document.getElementById(`revealed-orientation-${cardIndex}`);
        
        // ì´ë¯¸ì§€ ê²½ë¡œ ìƒì„± (ë‘ ê°€ì§€ í˜•ì‹ ì‹œë„)
        const cardNum = String(selectedCard.number).padStart(2, '0');
        
        // ë°©ë²• 1: ëŒ€ë¬¸ì í•˜ì´í”ˆ í˜•ì‹ (ì˜ˆ: 00-TheFool.png)
        const cardNameCamel = selectedCard.name.replace(/ /g, '');
        const imgPath1 = `/images/tarot/${cardNum}-${cardNameCamel}.png`;
        
        // ë°©ë²• 2: ì†Œë¬¸ì ì–¸ë”ìŠ¤ì½”ì–´ í˜•ì‹ (ì˜ˆ: 00_fool.png)
        const cardNameLower = selectedCard.name.toLowerCase().replace(/the /g, '').replace(/ /g, '');
        const imgPath2 = `/images/tarot/${cardNum}_${cardNameLower}.png`;
        
        console.log('ì¹´ë“œ ì •ë³´:', {
          ì´ë¦„: selectedCard.name,
          í•œê¸€ëª…: selectedCard.name_ko,
          ë²ˆí˜¸: cardNum,
          ê²½ë¡œ1: imgPath1,
          ê²½ë¡œ2: imgPath2
        });
        
        // ë¨¼ì € ë°©ë²• 1 ì‹œë„
        revealedImg.src = imgPath1;
        revealedImg.style.height = '120px';
        revealedImg.onerror = () => {
          console.log('ê²½ë¡œ1 ì‹¤íŒ¨, ê²½ë¡œ2 ì‹œë„:', imgPath2);
          revealedImg.src = imgPath2;
          revealedImg.onerror = () => {
            console.error('ëª¨ë“  ê²½ë¡œ ì‹¤íŒ¨, ì¹´ë“œ ë’·ë©´ í‘œì‹œ');
            revealedImg.src = '/images/tarot/CardBacks.png';
          };
        };
        
        // ì—­ë°©í–¥ì´ë©´ ì´ë¯¸ì§€ íšŒì „
        if (selectedCard.orientation === 'reversed') {
          revealedImg.style.transform = 'rotate(180deg)';
        }
        
        revealedName.textContent = selectedCard.name_ko;
        revealedOrientation.textContent = selectedCard.orientation === 'upright' ? 'ì •ë°©í–¥ â¬†ï¸' : 'ì—­ë°©í–¥ â¬‡ï¸';
        
        revealed.classList.add('active');
        cardElement.classList.add('selected');
      }, 300);
      
      // ì¹´ë“œ ì¶”ê°€
      selectedCards.push(selectedCard);
      
      // 2ì´ˆ í›„ ë‹¤ìŒ ë‹¨ê³„ë¡œ
      setTimeout(() => {
        currentStep++;

        if (currentStep > 5) {
          showFinalResult();
          return;
        }

        const currentCards = getRandomCards(5);
        renderCards(currentCards, 5);
        
        const subtitles = ['', '', '5ì¥ ì¤‘ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš” (ê³¼ê±°)', '5ì¥ ì¤‘ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš” (ë¯¸ë˜)', 
                          '5ì¥ ì¤‘ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš” (ì¡°ì–¸)', '5ì¥ ì¤‘ 1ì¥ì„ ì„ íƒí•˜ì„¸ìš” (ìµœì¢… ê²°ê³¼)'];
        updateStepIndicator(currentStep, subtitles[currentStep]);

        // â­ ì„ íƒ ì™„ë£Œ í”Œë˜ê·¸ í•´ì œ
        isSelecting = false;
        const cardsGrid = document.getElementById('cardsGrid');
        if (cardsGrid) {
          cardsGrid.classList.remove('selecting');
        }
      }, 2000);
    }

    async function showFinalResult() {
      console.log('ğŸ´ ìµœì¢… ê²°ê³¼ ìƒì„± ì¤‘...');
      console.log('ì„ íƒëœ ì¹´í…Œê³ ë¦¬:', selectedCategory);
      console.log('ì„ íƒëœ ì¹´ë“œ:', selectedCards);

      // ë¡œë”© í‘œì‹œ
      document.getElementById('cardSelectionSection').classList.remove('active');
      document.getElementById('resultSection').classList.add('active');
      
      const meaningsList = document.getElementById('meaningsList');
      meaningsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #999;">ğŸ”® AIê°€ íƒ€ë¡œë¥¼ í•´ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>';
      
      renderSelectedCards();

      try {
        // ë°±ì—”ë“œ API í˜¸ì¶œ - Claude AI í•´ì„ ìš”ì²­
        const response = await fetchWithDeviceId(API_BASE_URL + '/api/tarot', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json; charset=utf-8'
          },
          body: JSON.stringify({
            category: selectedCategory,
            selectedCards: selectedCards.map(card => {
              // ì¹´í…Œê³ ë¦¬ë³„ í•´ì„ ê°€ì ¸ì˜¤ê¸°
              let categoryMeaning = '';
              
              if (!MEANINGS_LOADED) {
                console.error('âŒ TAROT_MEANINGS ì•„ì§ ë¡œë“œ ì•ˆë¨!');
              } else if (!TAROT_MEANINGS) {
                console.error('âŒ TAROT_MEANINGSê°€ null!');
              } else if (!TAROT_MEANINGS.meanings) {
                console.error('âŒ TAROT_MEANINGS.meaningsê°€ ì—†ìŒ!');
              } else if (!TAROT_MEANINGS.meanings[card.id]) {
                console.error(`âŒ ${card.id} - meaningsì— ì—†ìŒ! ì‚¬ìš© ê°€ëŠ¥í•œ í‚¤:`, Object.keys(TAROT_MEANINGS.meanings).slice(0, 5));
              } else {
                const cardMeanings = TAROT_MEANINGS.meanings[card.id];
                const orientation = card.orientation === 'upright' ? 'upright' : 'reversed';
                
                if (!cardMeanings[orientation]) {
                  console.error(`âŒ ${card.id} - ${orientation} ë°©í–¥ ì—†ìŒ!`);
                } else if (!cardMeanings[orientation][selectedCategory]) {
                  console.error(`âŒ ${card.id} - ${selectedCategory} ì¹´í…Œê³ ë¦¬ ì—†ìŒ! ì‚¬ìš© ê°€ëŠ¥:`, Object.keys(cardMeanings[orientation]));
                } else {
                  categoryMeaning = cardMeanings[orientation][selectedCategory];
                  console.log(`âœ… ${card.name_ko} (${orientation}) - ${selectedCategory}:`, categoryMeaning.substring(0, 50) + '...');
                }
              }
              
              return {
                id: card.id,
                name: card.name,
                name_ko: card.name_ko,
                orientation: card.orientation,
                keywords_upright: card.keywords_upright,
                keywords_reversed: card.keywords_reversed,
                meaning_upright: card.meaning_upright,
                meaning_reversed: card.meaning_reversed,
                category_meaning: categoryMeaning  // â­ ì¹´í…Œê³ ë¦¬ë³„ í•´ì„ ì¶”ê°€!
              };
            })
          })
        });

        if (!response.ok) {
          throw new Error(`API ì˜¤ë¥˜: ${response.status}`);
        }

        const data = await response.json();
        console.log('AI í•´ì„ ì™„ë£Œ:', data);

        // ì´ìš©ê¶Œ ì •ë³´ ì—…ë°ì´íŠ¸ (localStorage ë™ê¸°í™”)
        if (data.remaining !== undefined) {
          const ticketData = getTicketData();
          ticketData.count = data.remaining;
          saveTicketData(ticketData);
          console.log('ì´ìš©ê¶Œ ì—…ë°ì´íŠ¸:', data.remaining);
        }

        // AI í•´ì„ ê²°ê³¼ í‘œì‹œ
        if (data.success && data.interpretation) {
          renderAIMeanings(data.interpretation);
        } else {
          throw new Error('AI í•´ì„ ì‹¤íŒ¨');
        }

      } catch (error) {
        console.error('API í˜¸ì¶œ ì‹¤íŒ¨:', error);
        // í´ë°±: ê¸°ë³¸ í•´ì„ í‘œì‹œ
        alert('AI í•´ì„ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ í•´ì„ì„ í‘œì‹œí•©ë‹ˆë‹¤.');
        renderMeanings();
      }
    }

    // ğŸ¤– AI í•´ì„ ê²°ê³¼ ë Œë”ë§
    function renderAIMeanings(interpretation) {
      const list = document.getElementById('meaningsList');
      const positions = ['í•µì‹¬', 'ê³¼ê±°', 'ë¯¸ë˜', 'ì¡°ì–¸', 'ê²°ê³¼'];
      
      // AI ì‘ë‹µ íŒŒì‹± - [í•µì‹¬] ... [ê³¼ê±°] ... [ì¢…í•©ë¶„ì„] í˜•ì‹
      const sections = {};
      
      // ì •ê·œì‹ìœ¼ë¡œ ê° ì„¹ì…˜ ì¶”ì¶œ
      const regex = /\[(\S+)\]\s*([^\[]+)/g;
      let match;
      
      while ((match = regex.exec(interpretation)) !== null) {
        const key = match[1].trim();
        const text = match[2].trim();
        sections[key] = text;
      }
      
      console.log('íŒŒì‹±ëœ ì„¹ì…˜:', sections);
      
      let html = selectedCards.map((card, i) => {
        const position = positions[i];
        const aiText = sections[position] || `${position}ì— ëŒ€í•œ í•´ì„ì´ ì—†ìŠµë‹ˆë‹¤.`;
        let keywords = card.orientation === 'upright' ? card.keywords_upright : card.keywords_reversed;
        
        return `
          <div class="meaning-card">
            <div class="meaning-position">${position}: ${card.name_ko} (${card.orientation === 'upright' ? 'ì •ë°©í–¥ â¬†ï¸' : 'ì—­ë°©í–¥ â¬‡ï¸'})</div>
            <div class="meaning-text">
              <strong>ğŸ¯ ${position} í•´ì„</strong><br>
              <em style="color: #999; font-size: 13px;">í‚¤ì›Œë“œ: ${keywords.join(', ')}</em><br><br>
              <div style="line-height: 1.8; color: #333;">
                ${aiText}
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      // ì¢…í•©ë¶„ì„ ì¶”ê°€
      if (sections['ì¢…í•©ë¶„ì„'] || sections['ì¢…í•©'] || sections['ì´í•©']) {
        const summary = sections['ì¢…í•©ë¶„ì„'] || sections['ì¢…í•©'] || sections['ì´í•©'];
        html += `
          <div class="meaning-card" style="margin-top: 20px; border: 3px solid #667eea;">
            <div class="meaning-position" style="color: #667eea; font-size: 17px; display: flex; align-items: center; gap: 8px;">
              âœ¨ ì¢…í•© ë¶„ì„
            </div>
            <div class="meaning-text">
              <div style="line-height: 2; color: #333; font-size: 15px; white-space: pre-line;">
                ${summary}
              </div>
            </div>
          </div>
        `;
      }
      
      list.innerHTML = html;
    }

    function renderSelectedCards() {
      const display = document.getElementById('selectedCardsDisplay');
      const positions = ['í•µì‹¬', 'ê³¼ê±°', 'ë¯¸ë˜', 'ì¡°ì–¸', 'ê²°ê³¼'];
      
      display.innerHTML = selectedCards.map((card, i) => {
        const cardNum = String(card.number).padStart(2, '0');
        
        // ë°©ë²• 1: ëŒ€ë¬¸ì í•˜ì´í”ˆ í˜•ì‹
        const cardNameCamel = card.name.replace(/ /g, '');
        const imgPath = `/images/tarot/${cardNum}-${cardNameCamel}.png`;
        
        // ë°©ë²• 2: ì†Œë¬¸ì ì–¸ë”ìŠ¤ì½”ì–´ í˜•ì‹ (ë°±ì—…)
        const cardNameLower = card.name.toLowerCase().replace(/the /g, '').replace(/ /g, '');
        const imgPathBackup = `/images/tarot/${cardNum}_${cardNameLower}.png`;
        
        console.log(`ê²°ê³¼ ì¹´ë“œ ${i+1}:`, card.name, 'ê²½ë¡œ:', imgPath);
        
        return `
          <div class="selected-card">
            <div class="selected-card-position">${positions[i]}</div>
            <img src="${imgPath}" 
                 alt="${card.name_ko}" 
                 style="width: 100%; max-width: 80px; height: auto; margin: 10px 0; border-radius: 5px; 
                        ${card.orientation === 'reversed' ? 'transform: rotate(180deg);' : ''}"
                 onerror="this.onerror=null; this.src='${imgPathBackup}'; this.onerror=()=>this.src='/images/tarot/CardBacks.png';">
            <div class="selected-card-name">${card.name_ko}</div>
            <div class="selected-card-orientation">${card.orientation === 'upright' ? 'ì •ë°©í–¥' : 'ì—­ë°©í–¥'}</div>
          </div>
        `;
      }).join('');
    }

    function renderMeanings() {
      const list = document.getElementById('meaningsList');
      const positions = ['í•µì‹¬', 'ê³¼ê±°', 'ë¯¸ë˜', 'ì¡°ì–¸', 'ê²°ê³¼'];
      const positionDescriptions = [
        'í˜„ì¬ ìƒí™©ì˜ í•µì‹¬',
        'ê³¼ê±°ì˜ ì˜í–¥',
        'ë¯¸ë˜ì˜ ê°€ëŠ¥ì„±',
        'í•„ìš”í•œ ì¡°ì–¸',
        'ìµœì¢… ê²°ê³¼'
      ];
      
      list.innerHTML = selectedCards.map((card, i) => {
        let meaning = '';
        let keywords = card.orientation === 'upright' ? card.keywords_upright : card.keywords_reversed;
        
        // âœ… í…Œë§ˆë³„ í•´ì„ ì‚¬ìš© (3,276ê°œ ì¤‘ì—ì„œ ì„ íƒ!)
        if (TAROT_MEANINGS && TAROT_MEANINGS.meanings[card.id]) {
          const cardMeanings = TAROT_MEANINGS.meanings[card.id];
          const orientation = card.orientation === 'upright' ? 'upright' : 'reversed';
          
          // ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ì˜ í•´ì„ ê°€ì ¸ì˜¤ê¸°
          meaning = cardMeanings[orientation]?.[selectedCategory] || 
                   cardMeanings[orientation]?.['total'] || 
                   'ì˜ë¯¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
          
          console.log(`${positions[i]} - ${card.name_ko} (${orientation}):`, {
            ì¹´í…Œê³ ë¦¬: selectedCategory,
            í•´ì„: meaning.substring(0, 50) + '...'
          });
        } else {
          // í´ë°±: ê¸°ë³¸ í•´ì„
          meaning = card.orientation === 'upright' ? card.meaning_upright : card.meaning_reversed;
          console.warn('âš ï¸ í…Œë§ˆë³„ í•´ì„ ì—†ìŒ, ê¸°ë³¸ í•´ì„ ì‚¬ìš©:', card.id);
        }
        
        return `
          <div class="meaning-card">
            <div class="meaning-position">${positions[i]}: ${card.name_ko} (${card.orientation === 'upright' ? 'ì •ë°©í–¥' : 'ì—­ë°©í–¥'})</div>
            <div class="meaning-text">
              <strong>${positionDescriptions[i]}</strong><br>
              <em>í‚¤ì›Œë“œ: ${keywords.join(', ')}</em><br><br>
              ${meaning}
            </div>
          </div>
        `;
      }).join('');
    }

    function resetTarot() {
      currentStep = 0;
      selectedCategory = null;
      selectedCards = [];
      remainingDeck = [];
      isSelecting = false;

      document.getElementById('categorySection').style.display = 'block';
      document.getElementById('cardSelectionSection').classList.remove('active');
      document.getElementById('resultSection').classList.remove('active');

      renderCategories();
    }

    function shareContent() {
      if (navigator.share) {
        navigator.share({
          title: 'ìš°ë¦¬ì˜ ìš´ì„¸ - íƒ€ë¡œ ì¹´ë“œ',
          text: 'íƒ€ë¡œ ì¹´ë“œë¡œ ë‚˜ì˜ ìš´ì„¸ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!',
          url: window.location.href
        }).catch(err => console.log('ê³µìœ  ì‹¤íŒ¨:', err));
      } else {
        const url = window.location.href;
        navigator.clipboard.writeText(url).then(() => {
          alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        });
      }
    }

    // ì‚¬ì£¼ ë³€ê²½ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜
    function openModal() {
      document.getElementById('sajuModal').classList.add('show');
      initializeDateSelects();
    }

    function closeModal() {
      document.getElementById('sajuModal').classList.remove('show');
    }

    function initializeDateSelects() {
      const yearSelect = document.getElementById('year');
      const monthSelect = document.getElementById('month');
      const daySelect = document.getElementById('day');

      // ë…„ë„ (1900 ~ í˜„ì¬ë…„ë„)
      const currentYear = new Date().getFullYear();
      for (let i = currentYear; i >= 1900; i--) {
        yearSelect.innerHTML += `<option value="${i}">${i}ë…„</option>`;
      }

      // ì›” (1 ~ 12)
      for (let i = 1; i <= 12; i++) {
        monthSelect.innerHTML += `<option value="${i}">${i}ì›”</option>`;
      }

      // ì¼ (1 ~ 31)
      for (let i = 1; i <= 31; i++) {
        daySelect.innerHTML += `<option value="${i}">${i}ì¼</option>`;
      }

      // localStorageì—ì„œ ê¸°ì¡´ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
      const savedData = localStorage.getItem('fortuneUserData');
      if (savedData) {
        const data = JSON.parse(savedData);
        document.getElementById('gender').value = data.gender || 'ë‚¨ì„±';
        document.getElementById('calendarType').value = data.calendarType || 'ì–‘ë ¥/ìŒë ¥';
        document.getElementById('year').value = data.year || '';
        document.getElementById('month').value = data.month || '';
        document.getElementById('day').value = data.day || '';
        document.getElementById('birthTime').value = data.birthTime || 'íƒœì–´ë‚œ ì‹œê°„';
      }
    }

    function saveSaju() {
      const gender = document.getElementById('gender').value;
      const calendarType = document.getElementById('calendarType').value;
      const year = document.getElementById('year').value;
      const month = document.getElementById('month').value;
      const day = document.getElementById('day').value;
      const birthTime = document.getElementById('birthTime').value;

      if (!year || !month || !day) {
        alert('ìƒë…„ì›”ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const birthData = {
        gender,
        calendarType,
        year,
        month,
        day,
        birthTime
      };

      localStorage.setItem('fortuneUserData', JSON.stringify(birthData));
      
      // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ ì—…ë°ì´íŠ¸
      loadUserInfo();
      
      alert('ì‚¬ì£¼ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      closeModal();
    }
  </script>

  <!-- ğŸ“Š ë°©ë¬¸ì ì¶”ì  ì‹œìŠ¤í…œ -->
  <script src="../utils/analytics-tracker.js"></script>

  <!-- ì´ìš©ê¶Œ ì‹œìŠ¤í…œ ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="../components/common/TicketModal.jsx"></script>
  <script src="../utils/ticket-wrapper.js"></script>

  <script>
    // ğŸ« í˜ì´ì§€ ë¡œë“œ ì‹œ ë§ˆìŠ¤í„° ëª¨ë“œ ì²´í¬
    checkMasterModeFromURL();

    // ğŸ« ì´ìš©ê¶Œ ì²´í¬ í›„ íƒ€ë¡œ ì‹œì‘
    async function checkTicketAndStartTarot() {
      checkTicketAndExecute(startTarotReading);
    }
  </script>

</body>
</html>
