<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê¶í•© ë³´ê¸° - ìš°ë¦¬ì˜ ìš´ì„¸</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Malgun Gothic', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      max-width: 600px;
      width: 100%;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 28px;
      color: #333;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
      font-size: 14px;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 8px 15px;
      background: #f0f0f0;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      text-decoration: none;
      color: #333;
      margin-bottom: 20px;
    }

    .back-btn:hover {
      background: #e0e0e0;
    }

    /* íƒ€ì… ì„ íƒ */
    .type-selector {
      margin-bottom: 30px;
    }

    .type-selector h3 {
      font-size: 16px;
      color: #333;
      margin-bottom: 15px;
      text-align: center;
    }

    .type-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .type-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 15px 10px;
      background: #f8f9fa;
      border: 2px solid transparent;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .type-btn:hover {
      background: #e9ecef;
      transform: translateY(-2px);
    }

    .type-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: #667eea;
      color: white;
    }

    .type-btn .icon {
      font-size: 28px;
    }

    .type-btn .label {
      font-size: 14px;
      font-weight: 500;
    }

    .type-btn.active .label {
      color: white;
    }

    /* ì…ë ¥ ì„¹ì…˜ */
    .input-section {
      margin-bottom: 25px;
    }

    .person-input {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 15px;
    }

    .person-input h4 {
      font-size: 16px;
      color: #333;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .date-input-group {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .date-input-group input {
      flex: 1;
      padding: 12px;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      font-size: 14px;
      text-align: center;
    }

    .date-input-group input:focus {
      outline: none;
      border-color: #667eea;
    }

    input[type="date"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      font-size: 14px;
    }

    input[type="date"]:focus {
      outline: none;
      border-color: #667eea;
    }

    .zodiac-display {
      margin-top: 10px;
      padding: 10px;
      background: white;
      border-radius: 8px;
      text-align: center;
      font-size: 14px;
      color: #667eea;
      font-weight: 500;
    }

    .vs-divider {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
      margin: 15px 0;
    }

    /* ì œì¶œ ë²„íŠ¼ */
    .submit-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 15px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }

    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    /* ë¡œë”© */
    .loading {
      display: none;
      text-align: center;
      padding: 40px;
    }

    .loading.active {
      display: block;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ê²°ê³¼ ì„¹ì…˜ */
    .result-section {
      display: none;
    }

    .result-section.active {
      display: block;
    }

    .score-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      margin-bottom: 20px;
    }

    .score-circle {
      display: inline-block;
      margin-bottom: 15px;
    }

    .score-number {
      font-size: 60px;
      font-weight: bold;
    }

    .score-max {
      font-size: 24px;
      opacity: 0.8;
    }

    .star-rating {
      font-size: 32px;
      margin-bottom: 10px;
    }

    .level-text {
      font-size: 24px;
      font-weight: 600;
    }

    /* ìƒì„¸ ì¹´ë“œ */
    .detail-card {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .detail-card h4 {
      font-size: 16px;
      color: #333;
      margin-bottom: 15px;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #dee2e6;
    }

    .detail-row:last-child {
      border-bottom: none;
    }

    .detail-row span:first-child {
      color: #666;
      font-size: 14px;
    }

    .detail-row span:last-child {
      color: #333;
      font-weight: 500;
      font-size: 14px;
    }

    /* í•´ì„ ì¹´ë“œ */
    .interpretation-card {
      background: #fff;
      border: 2px solid #667eea;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .interpretation-card h4 {
      font-size: 16px;
      color: #667eea;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .interpretation-text {
      color: #333;
      line-height: 1.8;
      font-size: 15px;
    }

    /* ì¡°ì–¸ ê·¸ë¦¬ë“œ */
    .advice-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .advice-card {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 15px;
    }

    .advice-card h5 {
      font-size: 14px;
      color: #667eea;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .advice-card p {
      font-size: 13px;
      color: #333;
      line-height: 1.6;
    }

    /* ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ */
    .retry-btn {
      width: 100%;
      padding: 15px;
      background: #f8f9fa;
      color: #333;
      border: 2px solid #dee2e6;
      border-radius: 15px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .retry-btn:hover {
      background: #e9ecef;
      border-color: #667eea;
      color: #667eea;
    }

    /* ë°˜ì‘í˜• */
    @media (max-width: 600px) {
      .type-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .advice-grid {
        grid-template-columns: 1fr;
      }

      .score-number {
        font-size: 48px;
      }

      .star-rating {
        font-size: 24px;
      }

      .level-text {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ë’¤ë¡œê°€ê¸° -->
    <a href="../index.html" class="back-btn">
      â† í™ˆìœ¼ë¡œ
    </a>

    <!-- í—¤ë” -->
    <div class="header">
      <h1>ğŸ”® ê¶í•© ë³´ê¸°</h1>
      <p>ë‘ ì‚¬ëŒì˜ ë ì™€ ì˜¤í–‰ìœ¼ë¡œ ê¶í•©ì„ ì•Œì•„ë³´ì„¸ìš”</p>
    </div>

    <!-- ì…ë ¥ í¼ -->
    <div id="input-form">
      <!-- íƒ€ì… ì„ íƒ -->
      <div class="type-selector">
        <h3>ì–´ë–¤ ê´€ê³„ì˜ ê¶í•©ì„ ë³´ì‹œë‚˜ìš”?</h3>
        <div class="type-grid">
          <button class="type-btn active" data-type="lover">
            <span class="icon">â¤ï¸</span>
            <span class="label">ì—°ì¸</span>
          </button>
          <button class="type-btn" data-type="marriage">
            <span class="icon">ğŸ’</span>
            <span class="label">ê²°í˜¼</span>
          </button>
          <button class="type-btn" data-type="family">
            <span class="icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
            <span class="label">ê°€ì¡±</span>
          </button>
          <button class="type-btn" data-type="friend">
            <span class="icon">ğŸ‘¯</span>
            <span class="label">ì¹œêµ¬</span>
          </button>
          <button class="type-btn" data-type="business">
            <span class="icon">ğŸ’¼</span>
            <span class="label">ë™ì—…</span>
          </button>
          <button class="type-btn" data-type="work">
            <span class="icon">ğŸ¢</span>
            <span class="label">ì§ì¥</span>
          </button>
        </div>
      </div>

      <!-- ì…ë ¥ ì„¹ì…˜ -->
      <div class="input-section">
        <div class="person-input">
          <h4>ğŸ™‹â€â™€ï¸ ë‚˜ì˜ ì •ë³´</h4>
          <input type="date" id="person1-date" max="2025-12-31" />
          <div class="zodiac-display" id="person1-zodiac">
            ë : -
          </div>
        </div>

        <div class="vs-divider">VS</div>

        <div class="person-input">
          <h4>ğŸ™‹â€â™‚ï¸ ìƒëŒ€ë°© ì •ë³´</h4>
          <input type="date" id="person2-date" max="2025-12-31" />
          <div class="zodiac-display" id="person2-zodiac">
            ë : -
          </div>
        </div>
      </div>

      <button class="submit-btn" onclick="calculateCompatibility()">
        ê¶í•© ë³´ê¸°
      </button>
    </div>

    <!-- ë¡œë”© -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Claude AIê°€ ê¶í•©ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
    </div>

    <!-- ê²°ê³¼ ì„¹ì…˜ -->
    <div class="result-section" id="result">
      <!-- ì ìˆ˜ ì¹´ë“œ -->
      <div class="score-card">
        <div class="score-circle">
          <span class="score-number" id="score-number">85</span>
          <span class="score-max">/100</span>
        </div>
        <div class="star-rating" id="star-rating">â­â­â­â­â˜†</div>
        <h3 class="level-text" id="level-text">ë§¤ìš° ì¢‹ì€ ê¶í•©!</h3>
      </div>

      <!-- ìƒì„¸ ë¶„ì„ -->
      <div class="detail-card">
        <h4>ğŸ“Š ìƒì„¸ ë¶„ì„</h4>
        <div class="detail-row">
          <span>ê¶í•© íƒ€ì…:</span>
          <span id="type-display">ì—°ì¸ ê¶í•©</span>
        </div>
        <div class="detail-row">
          <span>ë :</span>
          <span id="zodiac-display">ì¥ë  â™¥ ìš©ë </span>
        </div>
        <div class="detail-row">
          <span>ì˜¤í–‰:</span>
          <span id="element-display">ìˆ˜(æ°´) â™¥ í† (åœŸ)</span>
        </div>
        <div class="detail-row">
          <span>ì˜¤í–‰ ê´€ê³„:</span>
          <span id="element-relation">í”¼ê·¹ (ì œì•• ë°›ëŠ” ê´€ê³„)</span>
        </div>
        <div class="detail-row">
          <span>ë  ê´€ê³„:</span>
          <span id="zodiac-relation">ì²œìƒì—°ë¶„</span>
        </div>
      </div>

      <!-- Claude í•´ì„ -->
      <div class="interpretation-card">
        <h4>ğŸ’¬ ì „ë¬¸ê°€ í•´ì„</h4>
        <p id="claude-interpretation" class="interpretation-text">
          <!-- Claude API ê²°ê³¼ -->
        </p>
      </div>

      <!-- ì¡°ì–¸ ì¹´ë“œ -->
      <div class="advice-grid">
        <div class="advice-card">
          <h5>ğŸ’¡ í•µì‹¬ ì¡°ì–¸</h5>
          <p id="core-advice">-</p>
        </div>
        <div class="advice-card">
          <h5>âœ¨ ì¥ì </h5>
          <p id="strengths">-</p>
        </div>
        <div class="advice-card">
          <h5>âš ï¸ ì£¼ì˜ì‚¬í•­</h5>
          <p id="cautions">-</p>
        </div>
        <div class="advice-card">
          <h5>ğŸ¨ í–‰ìš´ì˜ ìƒ‰</h5>
          <p id="lucky-color">-</p>
        </div>
      </div>

      <!-- ì¶”ì²œ í™œë™ -->
      <div class="detail-card">
        <h4>ğŸ¯ ì¶”ì²œ í™œë™</h4>
        <p id="recommended-activity" style="color: #333; font-size: 14px; line-height: 1.6;">-</p>
      </div>

      <!-- ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ -->
      <button class="retry-btn" onclick="resetForm()">
        ë‹¤ì‹œ ê¶í•© ë³´ê¸°
      </button>
    </div>
  </div>

  <script>
    // í˜„ì¬ ì„ íƒëœ íƒ€ì…
    let selectedType = 'lover';

    // íƒ€ì… ì„ íƒ ë²„íŠ¼
    document.querySelectorAll('.type-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
        document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
        // í´ë¦­í•œ ë²„íŠ¼ í™œì„±í™”
        this.classList.add('active');
        selectedType = this.dataset.type;
      });
    });

    // ë  ê³„ì‚° í•¨ìˆ˜
    const zodiacAnimals = [
      'ì¥', 'ì†Œ', 'í˜¸ë‘ì´', 'í† ë¼', 
      'ìš©', 'ë±€', 'ë§', 'ì–‘', 
      'ì›ìˆ­ì´', 'ë‹­', 'ê°œ', 'ë¼ì§€'
    ];

    function getZodiacFromYear(year) {
      const index = (year - 4) % 12;
      return zodiacAnimals[index];
    }

    // ë‚ ì§œ ì…ë ¥ ì‹œ ë  í‘œì‹œ
    document.getElementById('person1-date').addEventListener('change', function(e) {
      const date = new Date(e.target.value);
      const year = date.getFullYear();
      const zodiac = getZodiacFromYear(year);
      document.getElementById('person1-zodiac').textContent = `ë : ${zodiac}ë `;
    });

    document.getElementById('person2-date').addEventListener('change', function(e) {
      const date = new Date(e.target.value);
      const year = date.getFullYear();
      const zodiac = getZodiacFromYear(year);
      document.getElementById('person2-zodiac').textContent = `ë : ${zodiac}ë `;
    });

    // ê¶í•© ê³„ì‚°
    async function calculateCompatibility() {
      const person1Date = document.getElementById('person1-date').value;
      const person2Date = document.getElementById('person2-date').value;

      // ì…ë ¥ ê²€ì¦
      if (!person1Date || !person2Date) {
        alert('ë‘ ì‚¬ëŒì˜ ìƒë…„ì›”ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”');
        return;
      }

      // ë‚ ì§œ íŒŒì‹±
      const date1 = new Date(person1Date);
      const date2 = new Date(person2Date);

      const person1 = {
        year: date1.getFullYear(),
        month: date1.getMonth() + 1,
        day: date1.getDate()
      };

      const person2 = {
        year: date2.getFullYear(),
        month: date2.getMonth() + 1,
        day: date2.getDate()
      };

      // UI ì „í™˜
      document.getElementById('input-form').style.display = 'none';
      document.getElementById('loading').classList.add('active');

      try {
        // API í˜¸ì¶œ
        const response = await fetch('http://localhost:3000/api/compatibility', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            type: selectedType,
            person1,
            person2
          })
        });

        const data = await response.json();

        if (!data.success) {
          throw new Error(data.message);
        }

        // ê²°ê³¼ í‘œì‹œ
        displayResult(data);

      } catch (error) {
        alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        resetForm();
      }
    }

    // ê²°ê³¼ í‘œì‹œ
    function displayResult(data) {
      // ì ìˆ˜ ì¹´ë“œ
      document.getElementById('score-number').textContent = data.score;
      document.getElementById('star-rating').textContent = data.stars;
      document.getElementById('level-text').textContent = data.level;

      // ìƒì„¸ ë¶„ì„
      document.getElementById('type-display').textContent = data.typeIcon + ' ' + data.typeName;
      document.getElementById('zodiac-display').textContent = 
        `${data.person1.zodiac}ë  â™¥ ${data.person2.zodiac}ë `;
      document.getElementById('element-display').textContent = 
        `${data.person1.element} â™¥ ${data.person2.element}`;
      document.getElementById('element-relation').textContent = data.elementRelation.type;
      document.getElementById('zodiac-relation').textContent = data.zodiacRelation.description;

      // Claude í•´ì„
      const interp = data.interpretation;
      document.getElementById('claude-interpretation').textContent = interp.ê¶í•©ë¶„ì„ || 'í•´ì„ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤';
      document.getElementById('core-advice').textContent = interp.í•µì‹¬ì¡°ì–¸ || '-';
      document.getElementById('strengths').textContent = interp.ì¥ì  || '-';
      document.getElementById('cautions').textContent = interp.ì£¼ì˜ì‚¬í•­ || '-';
      document.getElementById('lucky-color').textContent = interp.í–‰ìš´ì˜ìƒ‰ || '-';
      document.getElementById('recommended-activity').textContent = interp.ì¶”ì²œí™œë™ || '-';

      // UI ì „í™˜
      document.getElementById('loading').classList.remove('active');
      document.getElementById('result').classList.add('active');
    }

    // í¼ ë¦¬ì…‹
    function resetForm() {
      document.getElementById('input-form').style.display = 'block';
      document.getElementById('loading').classList.remove('active');
      document.getElementById('result').classList.remove('active');
      
      // ì…ë ¥ ì´ˆê¸°í™”
      document.getElementById('person1-date').value = '';
      document.getElementById('person2-date').value = '';
      document.getElementById('person1-zodiac').textContent = 'ë : -';
      document.getElementById('person2-zodiac').textContent = 'ë : -';
    }
  </script>
</body>
</html>
