<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>사주팔자 - 우리의 운세</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Malgun Gothic', sans-serif;
      background: #ffffff;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      max-width: 500px;
      width: 100%;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 28px;
      color: #333;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
      font-size: 14px;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 8px 15px;
      background: #f0f0f0;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      text-decoration: none;
      color: #333;
    }

    .back-btn:hover {
      background: #e0e0e0;
    }

    .top-buttons {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .header-buttons {
      display: flex;
      gap: 8px;
    }

    .top-btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 8px 15px;
      background: white;
      border: 2px solid #ddd;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      color: #333;
    }

    .top-btn:hover {
      background: #f8f8f8;
      border-color: #667eea;
    }

    .user-info-display {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
      font-size: 14px;
      color: #666;
    }

    .generate-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 30px;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .generate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .loading {
      text-align: center;
      padding: 40px;
      display: none;
    }

    .loading.show {
      display: block;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .result-container {
      display: none;
      animation: fadeIn 0.5s;
    }

    .result-container.show {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .saju-card {
      background: linear-gradient(135deg, #fff9e6 0%, #ffe8b3 100%);
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 25px;
      border: 2px solid #ffd700;
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
    }

    .saju-card h3 {
      color: #f39c12;
      margin-bottom: 18px;
      font-size: 20px;
      text-align: center;
      padding-bottom: 12px;
      border-bottom: 2px solid #ffd700;
    }

    .saju-pillars {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
    }

    .pillar {
      text-align: center;
    }

    .pillar-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }

    .pillar-value {
      font-size: 24px;
      font-weight: bold;
      color: #2d3436;
    }

    .elements-chart {
      margin: 20px 0;
    }

    .element-bar {
      margin-bottom: 12px;
    }

    .element-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .bar {
      height: 20px;
      background: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
    }

    .bar-fill {
      height: 100%;
      transition: width 0.5s;
    }

    .element-목 { background: #00b894; }
    .element-화 { background: #d63031; }
    .element-토 { background: #fdcb6e; }
    .element-금 { background: #b2bec3; }
    .element-수 { background: #0984e3; }

    .fortune-card {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      transition: all 0.3s;
    }

    .fortune-card:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
    }

    .fortune-card h3 {
      color: #667eea;
      font-size: 18px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .fortune-card p {
      color: #555;
      line-height: 1.8;
      font-size: 15px;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .action-btn {
      flex: 1;
      padding: 14px;
      border: 2px solid #667eea;
      background: white;
      color: #667eea;
      border-radius: 10px;
      font-size: 15px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    .action-btn:hover {
      background: #667eea;
      color: white;
    }

    .error {
      text-align: center;
      padding: 40px;
      color: #e74c3c;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- 상단 버튼 -->
    <div class="top-buttons">
      <a href="../index.html" class="back-btn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        뒤로가기
      </a>
      
      <div class="header-buttons">
        <button class="top-btn" onclick="openModal()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
          </svg>
          사주변경
        </button>
        
        <button class="top-btn" onclick="shareSaju()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="18" cy="5" r="3"/>
            <circle cx="6" cy="12" r="3"/>
            <circle cx="18" cy="19" r="3"/>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
          </svg>
          공유하기
        </button>
      </div>
    </div>

    <!-- 헤더 -->
    <div class="header">
      <h1>🔮 사주팔자</h1>
      <p>당신의 운명을 깊이 들여다봅니다</p>
    </div>

    <!-- 사용자 정보 표시 -->
    <div class="user-info-display" id="userInfo">
      사주 정보를 불러오는 중...
    </div>

    <!-- 사주 보기 버튼 -->
    <button class="generate-btn" onclick="calculateSaju()">
      사주 보기
    </button>

    <!-- 로딩 -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>사주를 계산하고 있습니다...</p>
      <p style="font-size: 12px; color: #999; margin-top: 10px;">잠시만 기다려주세요</p>
    </div>

    <!-- 결과 -->
    <div class="result-container" id="resultContainer">
      <!-- JavaScript로 채워짐 -->
    </div>

    <!-- 면책조항 -->
    <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 10px; border-top: 2px solid #e0e0e0;">
      <p style="font-size: 12px; color: #999; line-height: 1.8; margin-bottom: 10px;">
        ⚠️ <strong>면책조항</strong>
      </p>
      <p style="font-size: 11px; color: #666; line-height: 1.8; text-align: justify;">
        사주팔자, 운세, 꿈해몽 등 본 서비스에서 제공하는 모든 콘텐츠는 <strong>참고용 정보일 뿐이며</strong>,
        어떠한 과학적·의학적·법적 근거나 보증을 제공하지 않습니다.
        본 서비스의 내용은 <strong>개인의 판단이나 의사결정의 유일한 근거로 사용되어서는 안 되며</strong>,
        중요한 결정은 반드시 전문가와 상담하시기 바랍니다.
        본 서비스 이용으로 인해 발생하는 어떠한 직접적·간접적 손해에 대해서도
        당사는 법적 책임을 지지 않습니다.
      </p>
    </div>
  </div>

  <script>
    // localStorage에서 사용자 정보 가져오기
    let savedData = JSON.parse(localStorage.getItem('fortuneUserData')) || {
      gender: '남성',
      calendarType: '음력(평달)',
      year: '1984',
      month: '7',
      day: '7',
      birthTime: '未(13:31~15:30)'
    };

    // 사용자 정보 표시
    function loadUserInfo() {
      const userInfoText = `${savedData.gender} ${savedData.year}. ${savedData.month}. ${savedData.day} (${savedData.calendarType}) ${savedData.birthTime}`;
      document.getElementById('userInfo').textContent = userInfoText;
    }

    // 사주변경 모달 열기 (index.html의 모달 사용)
    function openModal() {
      window.location.href = '../index.html#open-modal';
    }

    // 공유하기
    function shareSaju() {
      const shareText = `${savedData.gender} ${savedData.year}년 ${savedData.month}월 ${savedData.day}일생 사주팔자 보기`;
      
      if (navigator.share) {
        navigator.share({
          title: '사주팔자',
          text: shareText,
          url: window.location.href
        }).catch(() => {});
      } else {
        const tempInput = document.createElement('input');
        tempInput.value = window.location.href;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        alert('링크가 복사되었습니다!');
      }
    }

    // 오행 데이터
    const elements = {
      천간: {'갑':'목','을':'목','병':'화','정':'화','무':'토','기':'토','경':'금','신':'금','임':'수','계':'수'},
      지지: {'자':'수','축':'토','인':'목','묘':'목','진':'토','사':'화','오':'화','미':'토','신':'금','유':'금','술':'토','해':'수'}
    };

    // 사주 계산 (Mock)
    function calculateSaju() {
      // 로딩 표시
      document.getElementById('loading').classList.add('show');
      document.getElementById('resultContainer').classList.remove('show');

      // Mock 계산 (0.8초 대기)
      setTimeout(() => {
        const sajuResult = getMockSajuResult();
        displayResult(sajuResult);
        
        document.getElementById('loading').classList.remove('show');
        document.getElementById('resultContainer').classList.add('show');
      }, 800);
    }

    // Mock 사주 결과
    function getMockSajuResult() {
      const year = parseInt(savedData.year);
      const month = parseInt(savedData.month);
      const day = parseInt(savedData.day);
      
      // 간단한 계산
      const yearGanzi = {cheongan: '갑', jiji: '자', hanja: '갑자'};
      const monthGanzi = {cheongan: '경', jiji: getMonthJiji(month), hanja: `경${getMonthJiji(month)}`};
      const dayGanzi = {cheongan: '신', jiji: '묘', hanja: '신묘'};
      const hourJiji = extractHourJiji(savedData.birthTime);
      const hourGanzi = {cheongan: '신', jiji: hourJiji, hanja: `신${hourJiji}`};

      const elementsCount = calculateElements(yearGanzi, monthGanzi, dayGanzi, hourGanzi);
      const ilgan = dayGanzi.cheongan;
      const strength = calculateStrength(elementsCount, ilgan);
      const yongsin = findYongsin(strength, elementsCount);

      return {
        saju: {year: yearGanzi, month: monthGanzi, day: dayGanzi, hour: hourGanzi, ilgan: ilgan},
        elements: elementsCount,
        strength: strength,
        yongsin: yongsin,
        interpretations: generateInterpretations(ilgan, elementsCount, strength, yongsin)
      };
    }

    // 월 지지 가져오기
    function getMonthJiji(month) {
      const monthJiji = ['인','묘','진','사','오','미','신','유','술','해','자','축'];
      return monthJiji[month - 1];
    }

    // 시간에서 지지 추출
    function extractHourJiji(birthTime) {
      const match = birthTime.match(/^(.)/);
      return match ? match[1] : '미';
    }

    // 오행 계산
    function calculateElements(year, month, day, hour) {
      const count = {목: 0, 화: 0, 토: 0, 금: 0, 수: 0};
      [year, month, day, hour].forEach(ganzi => {
        const chEl = elements.천간[ganzi.cheongan];
        const jiEl = elements.지지[ganzi.jiji];
        if (chEl) count[chEl]++;
        if (jiEl) count[jiEl]++;
      });
      return count;
    }

    // 신강/신약 판정
    function calculateStrength(elementsCount, ilgan) {
      const ilganEl = elements.천간[ilgan];
      const same = elementsCount[ilganEl];
      return same >= 3 ? '신강' : '신약';
    }

    // 용신 찾기
    function findYongsin(strength, elementsCount) {
      const min = Object.keys(elementsCount).reduce((a, b) => 
        elementsCount[a] < elementsCount[b] ? a : b
      );
      return min;
    }

    // 해석 생성
    function generateInterpretations(ilgan, elementsCount, strength, yongsin) {
      const gender = savedData.gender;
      return {
        총운: `일간이 ${ilgan}인 사람은 특별한 성격을 가지고 있습니다. ${strength} 사주로서, 자신만의 확고한 가치관을 지니고 있습니다. 오행 분포는 목${elementsCount.목}개, 화${elementsCount.화}개, 토${elementsCount.토}개, 금${elementsCount.금}개, 수${elementsCount.수}개로 나타나며, 이는 당신의 인생에서 균형과 조화를 의미합니다. 용신인 ${yongsin} 오행을 활용하면 더욱 풍요로운 삶을 살 수 있습니다. 자연과 가까이하고, 따뜻한 마음을 유지하는 것이 중요합니다.`,
        
        재물운: `재성의 배치를 보면 ${strength === '신강' ? '적극적인 투자보다는 안정적인 저축이 유리' : '꾸준한 노력으로 재물을 모을 수 있음'}합니다. 용신 ${yongsin}과 관련된 사업이나 투자를 고려해보세요. 무리한 투자는 피하고, 장기적인 관점에서 재테크를 하는 것이 좋습니다. 특히 ${yongsin} 기운이 강한 분야에서 재물운이 좋습니다.`,
        
        애정운: gender === '여성' 
          ? `관성(남편)의 배치를 보면 ${strength === '신강' ? '강한 성격으로 배우자와 조화를 이루려 노력이 필요' : '부드러운 성격으로 좋은 배우자운'}합니다. 용신 ${yongsin} 오행이 강한 상대를 만나면 좋은 인연이 될 수 있습니다. 결혼 후에는 상대방의 의견을 존중하고, 소통을 중시하면 행복한 가정을 꾸릴 수 있습니다.`
          : `재성(아내)의 배치를 보면 안정적인 가정을 꾸릴 수 있습니다. ${strength} 사주는 배우자에게 ${strength === '신강' ? '리더십을 발휘' : '배려심을 보이며'}하게 됩니다. 가정을 소중히 여기고, 배우자와의 대화를 중요하게 생각하면 원만한 부부 관계를 유지할 수 있습니다.`,
        
        건강운: `오행 분포를 보면 균형을 맞추기 위해 ${yongsin} 기운을 보충하는 것이 좋습니다. ${yongsin}에 해당하는 음식(${getElementFood(yongsin)})과 색상(${getElementColor(yongsin)})을 활용하면 건강에 도움이 됩니다. 규칙적인 생활과 충분한 휴식이 중요하며, 특히 ${getWeakOrgan(yongsin)} 부위를 주의해야 합니다.`
      };
    }

    // 오행별 음식
    function getElementFood(element) {
      const foods = {
        목: '푸른 채소, 신맛 음식',
        화: '붉은 과일, 쓴맛 음식',
        토: '곡물, 단맛 음식',
        금: '견과류, 매운맛 음식',
        수: '해산물, 짠맛 음식'
      };
      return foods[element];
    }

    // 오행별 색상
    function getElementColor(element) {
      const colors = {
        목: '녹색, 청색',
        화: '적색, 주황색',
        토: '황색, 갈색',
        금: '백색, 금색',
        수: '흑색, 남색'
      };
      return colors[element];
    }

    // 오행별 주의 장기
    function getWeakOrgan(element) {
      const organs = {
        목: '간, 담',
        화: '심장, 소장',
        토: '비장, 위',
        금: '폐, 대장',
        수: '신장, 방광'
      };
      return organs[element];
    }

    // 결과 표시
    function displayResult(data) {
      const resultDiv = document.getElementById('resultContainer');
      
      // 사주 8글자
      const pillarsHTML = `
        <div class="pillar">
          <div class="pillar-label">년주</div>
          <div class="pillar-value">${data.saju.year.hanja}</div>
        </div>
        <div class="pillar">
          <div class="pillar-label">월주</div>
          <div class="pillar-value">${data.saju.month.hanja}</div>
        </div>
        <div class="pillar">
          <div class="pillar-label">일주</div>
          <div class="pillar-value">${data.saju.day.hanja}</div>
        </div>
        <div class="pillar">
          <div class="pillar-label">시주</div>
          <div class="pillar-value">${data.saju.hour.hanja}</div>
        </div>
      `;

      // 오행 차트
      const total = Object.values(data.elements).reduce((a, b) => a + b, 0);
      const elementsHTML = Object.entries(data.elements).map(([name, count]) => {
        const percentage = (count / total) * 100;
        const hanja = {목:'木',화:'火',토:'土',금:'金',수:'水'}[name];
        return `
          <div class="element-bar">
            <div class="element-label">
              <span>${name}(${hanja})</span>
              <span>${count}개</span>
            </div>
            <div class="bar">
              <div class="bar-fill element-${name}" style="width: ${percentage}%"></div>
            </div>
          </div>
        `;
      }).join('');

      // HTML 생성
      resultDiv.innerHTML = `
        <div class="saju-card">
          <h3>📅 사주 8글자</h3>
          <div class="saju-pillars">${pillarsHTML}</div>
          <p style="text-align: center; margin-top: 15px;">
            일간: <strong style="color: #f39c12; font-size: 18px;">${data.saju.ilgan}</strong>
          </p>
        </div>

        <div class="saju-card">
          <h3>🌈 오행 분포</h3>
          <div class="elements-chart">${elementsHTML}</div>
          <p style="text-align: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid #ffd700;">
            신강/신약: <strong style="color: #e74c3c;">${data.strength}</strong> &nbsp;|&nbsp; 
            용신: <strong style="color: #3498db;">${data.yongsin}</strong>
          </p>
        </div>

        <div class="fortune-card">
          <h3>📖 총운</h3>
          <p>${data.interpretations.총운}</p>
        </div>

        <div class="fortune-card">
          <h3>💰 재물운</h3>
          <p>${data.interpretations.재물운}</p>
        </div>

        <div class="fortune-card">
          <h3>💕 애정운</h3>
          <p>${data.interpretations.애정운}</p>
        </div>

        <div class="fortune-card">
          <h3>🏥 건강운</h3>
          <p>${data.interpretations.건강운}</p>
        </div>

        <div class="action-buttons">
          <button class="action-btn" onclick="location.reload()">다시 보기</button>
          <button class="action-btn" onclick="copySaju()">사주 복사</button>
        </div>
      `;
    }

    // 사주 복사
    function copySaju() {
      const sajuText = document.getElementById('resultContainer').innerText;
      navigator.clipboard.writeText(sajuText).then(() => {
        alert('사주 내용이 복사되었습니다!');
      }).catch(() => {
        alert('복사 실패');
      });
    }

    // 페이지 로드 시
    window.onload = function() {
      loadUserInfo();
    }
    
    // 페이지가 다시 보일 때마다 (뒤로가기 포함) localStorage에서 최신 정보 가져오기
    window.addEventListener('pageshow', function(event) {
      const latestData = localStorage.getItem('fortuneUserData');
      if (latestData) {
        savedData = JSON.parse(latestData);
        loadUserInfo();
      }
    });

    // focus 이벤트로도 확인 (탭 전환 시)
    window.addEventListener('focus', function() {
      const latestData = localStorage.getItem('fortuneUserData');
      if (latestData) {
        savedData = JSON.parse(latestData);
        loadUserInfo();
      }
    });
  </script>
</body>
</html>
