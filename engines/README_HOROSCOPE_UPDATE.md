# 별자리 운세 - 절기 계산 기반 정밀 판정 시스템

## 개요

2025-01-05 업데이트: 24절기 계산을 기반으로 별자리 경계일을 정밀하게 판정하는 기능을 추가했습니다.

## 문제점 (수정 전)

기존 시스템은 **고정된 날짜**만 사용:
- 양자리: 3/21 시작 (고정)
- 게자리: 6/22 시작 (고정)
- 천칭자리: 9/24 시작 (고정)
- 염소자리: 12/25 시작 (고정)

**경계일 문제:**
- 3월 20일 오후 6시 이후 출생 → 실제는 양자리, 시스템은 물고기자리로 잘못 판정
- 6월 21일 오전 출생 → 실제는 쌍둥이자리, 시스템은 게자리로 잘못 판정

## 해결 방법

### 1. 절기 데이터 추가
- 파일: `engines/data/solar-terms.json`
- 내용: 2020-2030년 춘분/하지/추분/동지 정확한 시각
- 출처: 한국천문연구원, 위키백과

### 2. 별자리 경계 계산 유틸리티
- 파일: `engines/utils/zodiac-calculator.js`
- 기능:
  - 절기 데이터 기반 12별자리 경계 계산
  - 황경 0도(춘분) = 양자리 시작
  - 30도 간격으로 12개 별자리 구분

### 3. 엔진 개선
- 파일: `engines/core/horoscope-engine.js`
- 추가 함수: `getHoroscopeByDatePrecise(year, month, day, hour, minute)`
- 기능: 시간 단위까지 고려한 정밀 판정

## 사용법

### 기본 사용 (하위 호환)
```javascript
const { getHoroscopeFortune } = require('./engines/core/horoscope-engine');

// 연도 없이 사용 (현재 연도 자동 적용)
const result = getHoroscopeFortune(3, 20);
```

### 정밀 판정 (권장)
```javascript
// 생년월일시 모두 제공
const result = getHoroscopeFortune(3, 20, 2025, 18, 0);
// 2025년 3월 20일 18:00 → 양자리 (춘분 17:56 이후)

const result2 = getHoroscopeFortune(3, 20, 2025, 17, 55);
// 2025년 3월 20일 17:55 → 물고기자리 (춘분 1분 전)
```

## 테스트

### 경계일 정밀 테스트 실행
```bash
node test-horoscope-boundary.js
```

### 테스트 결과 (2025년)
- 춘분 경계 (3/20 17:56): 6개 전부 통과 ✓
- 하지 경계 (6/21 11:48): 5개 전부 통과 ✓
- 추분 경계 (9/23 03:35): 6개 전부 통과 ✓
- 동지 경계 (12/22 00:04): 6개 전부 통과 ✓

**총 23개 케이스 전부 통과!**

## 기술 상세

### 별자리와 황경
- 춘분점 (황경 0도): 양자리 시작
- 황경 30도: 황소자리 시작
- 황경 60도: 쌍둥이자리 시작
- 황경 90도 (하지): 게자리 시작
- 황경 120도: 사자자리 시작
- 황경 150도: 처녀자리 시작
- 황경 180도 (추분): 천칭자리 시작
- 황경 210도: 전갈자리 시작
- 황경 240도: 사수자리 시작
- 황경 270도 (동지): 염소자리 시작
- 황경 300도: 물병자리 시작
- 황경 330도: 물고기자리 시작

### 정확도 향상
- **수정 전**: 날짜만 비교 (일 단위)
- **수정 후**: 시간까지 비교 (분 단위)
- **경계일 오차**: 최대 1-2일 → 최대 1분

## 주의사항

1. **연도 범위**: 2020-2030년 데이터 제공
   - 범위 밖 연도는 기본 고정 날짜 사용
   
2. **시간 미입력 시**: 정오(12:00) 기본값
   - 경계일은 시간 입력 권장

3. **하위 호환성**: 기존 API 그대로 동작
   - `getHoroscopeFortune(month, day)` 계속 사용 가능

## 참고 자료
- 한국천문연구원: https://www.kasi.re.kr
- 위키백과 - 24절기: https://ko.wikipedia.org/wiki/절기
- 위키백과 - 점성술의 별자리: https://ko.wikipedia.org/wiki/점성술의_별자리

## 업데이트 이력
- 2025-01-05: 절기 계산 기반 정밀 판정 시스템 추가
