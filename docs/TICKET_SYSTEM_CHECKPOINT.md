# 🎫 이용권 시스템 구현 체크포인트

**📅 작성일**: 2025-01-06  
**🎯 작업**: 이용권(티켓) 시스템 구현  
**👤 마스터 코드**: `cooal`

---

## 📋 **프로젝트 개요**

**프로젝트명**: 종합 운세 플랫폼 (오늘의 운세 / 어른들의 운세)  
**프로젝트 루트**: `C:\xampp\htdocs\mysite\운세플랫폼\`  
**현재 상황**: Phase 1 완료 (8개 기능 모두 구현 완료)

---

## ✅ **현재 완성된 기능 (Phase 1)**

1. ✅ 로또 번호 생성기
2. ✅ 사주 8글자 시스템
3. ✅ 오늘의 운세
4. ✅ 별자리 운세
5. ✅ 꿈해몽 (2,195개 DB)
6. ✅ 궁합 테스트
7. ✅ 토정비결
8. ✅ 타로 카드

**모든 기능은 현재 Mock 데이터로 작동 중입니다.**

---

## 🎯 **다음 작업: 이용권 시스템 구현**

### **이용권 시스템이란?**
- 사용자가 8개 기능을 사용하려면 **이용권**이 필요
- 이용권을 얻으려면 **쿠팡 파트너스 링크**를 방문해야 함
- 하루 최대 2번만 사용 가능 (수익 모델)

---

## 📜 **이용권 시스템 규칙 (중요!)**

### **⚠️ 핵심 규칙 (절대 틀리지 말것!)**

```
1. 쿠팡 방문: 하루 1회만 가능
2. 이용권 충전: 하루 1회만 가능 (2개 충전)
3. 기능 사용: 이용권 1개 소모
4. 하루 최대: 2번만 사용 가능
5. 자정 지나면: 이용권 초기화 (0개)
6. 마스터 코드: cooal (무제한 사용)
```

### **❌ 잘못된 이해 (하지 말것!)**
- ~~이용권 없으면 다시 쿠팡 방문~~ ← **틀림!**
- 하루 1회만 충전 가능!
- 2개 다 쓰면 **내일까지 사용 불가**

---

## 💬 **메시지 3가지 유형**

### **1. 이용권 있을 때**
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   이용권 1장을 소모하시겠습니까?
   
   현재 남은 이용권: 2개
   
   [ 확인 ]  [ 취소 ]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### **2. 이용권 없을 때 (아직 충전 안 함)**
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   😊 쿠팡 방문하고 이용권 2개 얻기
   
   무료로 운세를 보려면 쿠팡 파트너스
   링크를 한 번 방문해주세요!
   
   [ 예 ]  [ 아니요 ]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### **3. 이용권 없을 때 (이미 2개 다 사용함)**
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
   😴 내일 다시 오세요!
   
   오늘은 이미 2번 사용하셨어요.
   
   ⏰ 자정까지: 5시간 23분
   
   [ 확인 ]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 🔄 **작동 흐름**

### **시나리오 1: 처음 방문 (이용권 0개)**
```
1. 메인 페이지 로드
   └── 우측 상단: 🎫 이용권: 0개

2. "사주보기" 버튼 클릭
   └── 이용권 체크 → 0개
   └── 모달 표시: "쿠팡 방문하고 이용권 2개 얻기"

3. "예" 클릭
   └── coupang-gate.html 이동
   └── 5초 대기 후 쿠팡 링크 자동 이동
   
4. 쿠팡 방문 후 돌아옴
   └── 이용권 2개 충전
   └── 모달 표시: "이용권 1장을 소모하시겠습니까?"
   
5. "확인" 클릭
   └── 이용권 1개 소모 (남은: 1개)
   └── 사주 페이지 이동
```

### **시나리오 2: 이용권 있음 (1개)**
```
1. "타로보기" 버튼 클릭
   └── 이용권 체크 → 1개
   └── 모달 표시: "이용권 1장을 소모하시겠습니까?"

2. "확인" 클릭
   └── 이용권 1개 소모 (남은: 0개)
   └── 타로 페이지 이동
```

### **시나리오 3: 이용권 없음 (이미 사용)**
```
1. "토정비결" 버튼 클릭
   └── 이용권 체크 → 0개
   └── 충전 이력 확인 → 오늘 이미 충전함
   └── 모달 표시: "내일 다시 오세요!"

2. "확인" 클릭
   └── 모달 닫기
   └── 메인 페이지 유지
```

### **시나리오 4: 마스터 모드 (cooal)**
```
1. URL 접속: ?unlock=cooal
   └── 마스터 모드 활성화
   └── 우측 상단: 🔓 Master Mode

2. 모든 버튼 클릭
   └── 이용권 체크 무시
   └── 바로 해당 페이지 이동
   └── 무제한 사용!
```

---

## 📁 **구현할 파일 목록**

### **1. 핵심 로직 (JavaScript)**
```
C:\xampp\htdocs\mysite\운세플랫폼\frontend\utils\ticket-system.js
```
- `isMasterMode()` - 마스터 모드 체크
- `getTicketData()` - 이용권 데이터 가져오기
- `canUseFortune()` - 기능 사용 가능 여부
- `useTicket()` - 이용권 소모
- `chargeTickets()` - 이용권 충전
- `getRemainingTickets()` - 남은 이용권 개수

### **2. UI 컴포넌트 (React/JSX 또는 HTML)**
```
C:\xampp\htdocs\mysite\운세플랫폼\frontend\components\common\
├── TicketModal.jsx          # 이용권 관련 모달 3가지
├── TicketBadge.jsx          # 우측 상단 이용권 표시
└── MasterBadge.jsx          # 마스터 모드 배지
```

### **3. 쿠팡 게이트 페이지**
```
C:\xampp\htdocs\mysite\운세플랫폼\frontend\pages\coupang-gate.html
```
- 5초 대기 화면
- 쿠팡 링크로 자동 이동
- "바로가기" 버튼

### **4. 메인 페이지 수정**
```
C:\xampp\htdocs\mysite\운세플랫폼\frontend\pages\index.html
```
- 8개 버튼에 이용권 체크 로직 추가
- 우측 상단에 이용권 배지 추가
- 마스터 배지 추가

### **5. 스타일 (CSS)**
```
C:\xampp\htdocs\mysite\운세플랫폼\frontend\styles\ticket-system.css
```

---

## 💻 **localStorage 구조**

```javascript
// localStorage 저장 형태
{
  "master_mode": "false",           // 마스터 모드 (true/false)
  "fortune_tickets": {
    "date": "2025-01-06",          // 마지막 충전 날짜
    "count": 2,                    // 남은 이용권 개수
    "charged": true,               // 오늘 충전 여부
    "last_use": "2025-01-06T10:30:00"  // 마지막 사용 시각
  }
}
```

---

## 🔐 **마스터 모드**

### **마스터 코드**: `cooal`

### **활성화 방법 1: URL**
```
https://yoursite.com?unlock=cooal
```

### **활성화 방법 2: 키보드 단축키**
```
Ctrl + Shift + M (3번 연속)
→ 코드 입력 프롬프트: cooal
```

### **해제 방법**
```
https://yoursite.com?unlock=off
```

### **마스터 모드 효과**
- 이용권 체크 완전 무시
- 모든 기능 무제한 사용
- 우측 상단에 🔓 Master Mode 배지 표시

---

## 🔗 **쿠팡 링크 (나중에 제공)**

```javascript
// coupang-gate.html에서 사용할 링크
const COUPANG_LINK = "사용자가 직접 제공 예정";
```

**현재는 임시 링크로 개발:**
```javascript
const COUPANG_LINK = "https://www.coupang.com/?src=temp";
```

---

## 🧪 **테스트 시나리오**

### **테스트 1: 일반 사용자 (정상 흐름)**
```
1. 페이지 로드 → 이용권: 0개 확인
2. 버튼 클릭 → "쿠팡 방문" 모달 확인
3. 예 클릭 → 쿠팡 게이트 이동 확인
4. 돌아오기 → 이용권 2개 충전 확인
5. 버튼 클릭 → "1장 소모" 모달 확인
6. 확인 클릭 → 이용권 1개 소모 (남은: 1개) 확인
7. 다시 버튼 클릭 → 이용권 1개 소모 (남은: 0개) 확인
8. 또 버튼 클릭 → "내일 다시 오세요" 모달 확인
```

### **테스트 2: 마스터 모드**
```
1. ?unlock=cooal 접속
2. 마스터 모드 활성화 확인
3. 🔓 Master Mode 배지 확인
4. 모든 버튼 클릭 → 바로 이동 (모달 없음) 확인
5. 이용권 표시: ∞ 확인
```

### **테스트 3: 날짜 변경**
```
1. localStorage에서 date 변경 (어제 날짜로)
2. 페이지 새로고침
3. 이용권 0개로 초기화 확인
4. charged: false 확인
```

---

## 🚀 **새로운 Claude 창에 복붙할 명령어**

```
다음 3개 문서를 읽고 이용권 시스템을 구현해주세요:

1. C:\xampp\htdocs\mysite\docs\운세_플랫폼_폴더구조.md
2. C:\xampp\htdocs\mysite\운세플랫폼\docs\CHECKPOINT_현재상황.md
3. C:\xampp\htdocs\mysite\운세플랫폼\docs\TICKET_SYSTEM_CHECKPOINT.md (이 문서)

[작업 요청]
이용권(티켓) 시스템을 구현해주세요.
- 하루 쿠팡 방문 1회, 이용권 2개 충전
- 기능 사용 시 이용권 1개 소모
- 마스터 코드 'cooal'은 무제한
- 3가지 모달 메시지 정확히 구현

파일 생성 순서:
1. frontend/utils/ticket-system.js (핵심 로직)
2. frontend/components/common/TicketModal.jsx (3가지 모달)
3. frontend/pages/coupang-gate.html (쿠팡 게이트)
4. 메인 페이지 수정 (8개 버튼)
5. 테스트

바로 시작해주세요!
```

---

## 📝 **체크리스트**

### **구현 완료 체크**
- [ ] ticket-system.js 생성
- [ ] TicketModal.jsx 생성 (3가지 유형)
- [ ] TicketBadge.jsx 생성
- [ ] MasterBadge.jsx 생성
- [ ] coupang-gate.html 생성
- [ ] index.html 수정 (8개 버튼)
- [ ] 마스터 모드 (?unlock=cooal)
- [ ] 테스트 완료

### **테스트 완료 체크**
- [ ] 일반 사용자 정상 흐름
- [ ] 이용권 소모 확인
- [ ] "내일 다시 오세요" 확인
- [ ] 마스터 모드 무제한 확인
- [ ] 날짜 변경 시 초기화 확인

---

**📅 작성일**: 2025-01-06  
**👤 작성자**: Claude  
**🎯 목표**: 이용권 시스템 완전 구현
