/**
 * 궁합 Claude API 프롬프트 생성기
 * 
 * 타입별 맞춤 프롬프트:
 * - lover: 연인 궁합
 * - marriage: 결혼 궁합
 * - family: 가족 궁합
 * - friend: 친구 궁합
 * - business: 동업 궁합
 * - work: 직장 궁합
 */

/**
 * 타입별 특화 프롬프트
 */
const typeSpecificPrompts = {
  lover: `
# 연인 궁합 해석 포인트
1. 사랑의 시작과 발전 과정
   - "두 분은 처음 만났을 때부터 ~한 느낌이 들 거예요"
   - "시간이 지날수록 ~하게 발전합니다"

2. 서로의 연애 스타일과 조화
   - "연애할 때 ~한 스타일입니다"
   - "서로 ~한 점이 잘 맞아요"

3. 감정 표현 방식의 차이와 이해
   - "감정 표현은 ~하게 하세요"
   - "상대방이 ~할 때 이해해주세요"

4. 갈등 발생 시 해결 방법
   - "다툼이 생기면 ~하세요"
   - "~하면 금방 화해할 수 있어요"

5. 장기적인 관계 유지 비결
   - "오래 사귀려면 ~이 중요합니다"
   - "서로 ~하면 평생 함께할 수 있어요"

# 어조
- 따뜻하고 설레는 느낌
- "두 분은 서로에게 ~한 존재입니다"
- "연애할 때 ~하면 더 좋아요"
`,

  marriage: `
# 결혼 궁합 해석 포인트
1. 평생 해로 가능성
   - "두 분의 결혼은 ~합니다"
   - "평생 함께 ~할 수 있어요"

2. 결혼 후 재물운과 자식운
   - "재물운은 ~합니다"
   - "자녀는 ~할 가능성이 높아요"

3. 양가 부모님과의 관계
   - "시댁/처가와의 관계는 ~할 거예요"
   - "부모님들은 ~하실 겁니다"

4. 가정 경제 운영 방식
   - "돈 관리는 ~하시면 좋아요"
   - "~가 주도하면 안정적입니다"

5. 노후 생활 전망
   - "나이 들어서도 ~하실 거예요"
   - "노후는 ~하게 보내실 겁니다"

# 어조
- 안정적이고 따뜻한 느낌
- "결혼 생활은 ~할 겁니다"
- "두 분은 ~한 가정을 꾸리실 거예요"
`,

  family: `
# 가족 궁합 해석 포인트
1. 세대 차이 이해하기
   - "세대가 다르니 ~할 수 있어요"
   - "서로 ~한 점을 이해해주세요"

2. 서로의 성격과 가치관 존중
   - "성격이 ~하게 다릅니다"
   - "가치관은 ~하지만 존중하세요"

3. 갈등이 생기는 이유
   - "자주 ~때문에 다툴 수 있어요"
   - "~할 때 갈등이 생깁니다"

4. 화목한 가정을 위한 조언
   - "화목하려면 ~하세요"
   - "가족이니까 ~하면 됩니다"

5. 서로에게 배울 점
   - "부모님께 ~을 배우세요"
   - "자녀에게 ~을 인정하세요"

# 어조
- 이해하고 포용하는 느낌
- "가족이니까 ~"
- "서로 ~한 점을 존중하세요"
`,

  friend: `
# 친구 궁합 해석 포인트
1. 친구로서의 케미
   - "두 분은 ~한 친구 사이예요"
   - "케미가 ~해서 잘 맞아요"

2. 함께 즐길 수 있는 것들
   - "함께 ~하면 더 즐거워요"
   - "~할 때 가장 재미있을 거예요"

3. 서로에게 도움이 되는 방법
   - "~할 때 서로 도와주세요"
   - "~하면 더 좋은 친구가 됩니다"

4. 우정을 오래 유지하는 비결
   - "오래 친구하려면 ~하세요"
   - "~하면 평생 친구입니다"

5. 갈등 시 해결법
   - "다투면 ~하세요"
   - "~하면 금방 풀립니다"

# 어조
- 편안하고 즐거운 느낌
- "좋은 친구예요"
- "평생 의지할 수 있어요"
`,

  business: `
# 동업 궁합 해석 포인트
1. 사업 성공 가능성
   - "사업적으로 ~한 관계입니다"
   - "성공 가능성은 ~합니다"

2. 역할 분담 (아이디어/실행)
   - "~를 맡으시고"
   - "~를 담당하세요"

3. 금전 관계 주의사항
   - "돈 문제는 ~하세요"
   - "~하면 문제없습니다"

4. 의사결정 방식
   - "결정은 ~하게 하세요"
   - "~가 주도하면 좋아요"

5. 장기 협력 전망
   - "오래 동업하려면 ~"
   - "~하면 계속 함께할 수 있어요"

# 어조
- 현실적이고 실용적인 느낌
- "사업은 ~"
- "돈은 ~하세요"
`,

  work: `
# 직장 궁합 해석 포인트
1. 업무 스타일 차이
   - "업무 스타일이 ~합니다"
   - "~하게 일하시는 편이에요"

2. 커뮤니케이션 방법
   - "대화할 때 ~하세요"
   - "~하면 소통이 잘 됩니다"

3. 협업 시너지
   - "함께 일하면 ~해요"
   - "~할 때 시너지가 납니다"

4. 갈등 예방법
   - "갈등을 막으려면 ~"
   - "~하지 않도록 주의하세요"

5. 서로 배울 점
   - "~를 배우세요"
   - "서로 ~한 점을 인정하세요"

# 어조
- 전문적이고 건설적인 느낌
- "업무상 ~"
- "협업할 때 ~"
`
};

/**
 * 궁합 프롬프트 생성
 * @param {object} data - 궁합 계산 결과
 * @returns {string} Claude API용 프롬프트
 */
function generateCompatibilityPrompt(data) {
  const { 
    type, 
    typeName,
    score, 
    level, 
    person1, 
    person2, 
    ilganRelation,
    zodiacRelation,
    zodiacElementRelation
  } = data;
  
  const specificPrompt = typeSpecificPrompts[type] || typeSpecificPrompts.lover;
  
  const prompt = `당신은 30년 경력의 사주명리 전문가입니다.
55-65세 여성 고객에게 따뜻하고 공감하는 어조로 조언합니다.

# 궁합 정보
- 궁합 타입: ${typeName}

## 첫 번째 분
- 띠: ${person1.zodiac}띠 (${person1.zodiacElement})
- 일주: ${person1.dayPillar} (일간: ${person1.ilgan}, 일지: ${person1.ilji})
- 배우자궁 오행: ${person1.ilganElement}

## 두 번째 분
- 띠: ${person2.zodiac}띠 (${person2.zodiacElement})
- 일주: ${person2.dayPillar} (일간: ${person2.ilgan}, 일지: ${person2.ilji})
- 배우자궁 오행: ${person2.ilganElement}

## 궁합 분석
- **배우자궁 관계**: ${ilganRelation.type}
  → ${ilganRelation.description}
- **띠 관계**: ${zodiacRelation.description}
- **띠 오행 관계**: ${zodiacElementRelation.type}
  → ${zodiacElementRelation.description}
- **궁합 점수**: ${score}점 / 100점
- **궁합 등급**: ${level}

${specificPrompt}

# 작성 지침
⭐ 반드시 400-600자로 충분히 디테일하게 작성
⭐ 일주(배우자궁)를 중심으로 해석 (가장 중요!)
⭐ 따뜻하고 공감하는 어조 유지
⭐ 구체적인 조언과 예시 포함
⭐ 긍정적이고 희망적인 마무리
⭐ 점수가 낮아도 희망을 주는 조언 포함

# 주의사항
❌ 너무 부정적이거나 불안하게 만들지 마세요
❌ 점수가 낮다고 "헤어지세요", "포기하세요" 같은 말 금지
✅ 점수가 낮아도 "노력하면 ~", "이해하면 ~" 긍정적 조언
✅ 구체적인 상황을 상상하며 쓰세요
✅ 읽고 나면 "아, 이렇게 하면 되겠구나" 느낌!

# 요청사항
다음 JSON 형식으로 작성해주세요:

{
  "궁합분석": "400-600자의 상세한 궁합 해석. ${typeName} 관점에서 일주(배우자궁)를 중심으로 스토리텔링 형식으로 풍부하게 작성.",
  "핵심조언": "한 줄로 핵심만 요약한 조언",
  "장점": "이 관계의 장점 3가지를 쉼표로 구분 (예: 신뢰감, 안정감, 성장)",
  "주의사항": "주의할 점 또는 개선 방법 1-2가지",
  "행운의색": "두 분께 어울리는 색상 (예: 하늘색, 베이지)",
  "추천활동": "${typeName}에 어울리는 함께 할 활동 (예: 여행, 대화, 운동)"
}

⭐⭐⭐ 중요: 궁합분석 텍스트는 반드시 400자 이상 600자 이하로 작성하세요! ⭐⭐⭐`;

  return prompt;
}

module.exports = {
  generateCompatibilityPrompt
};
