<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>사주팔자 - 우리의 운세</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Malgun Gothic', sans-serif;
      background: #ffffff;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      max-width: 600px;
      width: 100%;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 28px;
      color: #333;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
      font-size: 14px;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 8px 15px;
      background: #f0f0f0;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      text-decoration: none;
      color: #333;
      margin-bottom: 20px;
    }

    .back-btn:hover {
      background: #e0e0e0;
    }

    .user-info-display {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      text-align: center;
      font-size: 14px;
      color: #666;
    }

    .generate-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 30px;
      transition: all 0.3s;
    }

    .generate-btn:hover {
      transform: translateY(-2px);
    }

    .loading {
      text-align: center;
      padding: 40px;
      display: none;
    }

    .loading.show {
      display: block;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .category-menu {
      overflow-x: auto;
      white-space: nowrap;
      margin-bottom: 30px;
      padding: 10px 0;
      border-bottom: 2px solid #f0f0f0;
      -webkit-overflow-scrolling: touch;
    }

    .category-menu::-webkit-scrollbar {
      height: 6px;
    }

    .category-menu::-webkit-scrollbar-thumb {
      background: #ddd;
      border-radius: 3px;
    }

    .category-btn {
      display: inline-block;
      padding: 10px 20px;
      margin-right: 10px;
      background: #f8f9fa;
      border: 2px solid #e0e0e0;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      color: #666;
      transition: all 0.3s;
    }

    .category-btn:hover {
      background: #e8e9ea;
      border-color: #667eea;
    }

    .category-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: #667eea;
      color: white;
      font-weight: bold;
    }

    .saju-card {
      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(253, 203, 110, 0.3);
    }

    .saju-card h3 {
      font-size: 20px;
      margin-bottom: 20px;
      color: #2d3436;
    }

    .saju-pillars {
      display: flex;
      justify-content: space-around;
      gap: 10px;
    }

    .pillar {
      background: white;
      border-radius: 12px;
      padding: 15px 10px;
      text-align: center;
      flex: 1;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .pillar-label {
      font-size: 12px;
      color: #636e72;
      margin-bottom: 10px;
      font-weight: bold;
    }

    .pillar-char {
      font-size: 24px;
      font-weight: bold;
      color: #2d3436;
    }

    .pillar-star {
      font-size: 11px;
      color: #6c5ce7;
      margin-top: 5px;
      font-weight: bold;
    }

    .elements-chart {
      background: white;
      border-radius: 10px;
      padding: 15px;
    }

    .element-bar {
      margin-bottom: 12px;
    }

    .element-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      font-size: 14px;
      color: #636e72;
    }

    .bar {
      height: 20px;
      background: #f0f0f0;
      border-radius: 10px;
      overflow: hidden;
    }

    .bar-fill {
      height: 100%;
      border-radius: 10px;
      transition: width 0.5s;
    }

    .element-목 { background: linear-gradient(90deg, #55efc4, #00b894); }
    .element-화 { background: linear-gradient(90deg, #ff7675, #d63031); }
    .element-토 { background: linear-gradient(90deg, #fdcb6e, #e17055); }
    .element-금 { background: linear-gradient(90deg, #dfe6e9, #b2bec3); }
    .element-수 { background: linear-gradient(90deg, #74b9ff, #0984e3); }

    .fortune-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    .fortune-card h3 {
      font-size: 20px;
      margin-bottom: 15px;
      color: #2d3436;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 10px;
    }

    .fortune-card p {
      line-height: 1.8;
      color: #636e72;
      font-size: 15px;
    }

    .ten-stars-summary {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
      border: 2px solid #e8daef;
    }

    .ten-stars-summary h4 {
      font-size: 14px;
      color: #6c5ce7;
      margin-bottom: 10px;
    }

    .ten-stars-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      font-size: 12px;
    }

    .ten-star-item {
      text-align: center;
      padding: 8px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .ten-star-item.has-star {
      background: #e8daef;
      color: #6c5ce7;
      font-weight: bold;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 30px;
    }

    .action-btn {
      flex: 1;
      padding: 15px;
      background: white;
      border: 2px solid #ddd;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      color: #333;
      transition: all 0.3s;
    }

    .action-btn:hover {
      background: #f8f8f8;
      border-color: #667eea;
    }

    #resultContainer {
      display: none;
    }

    #resultContainer.show {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="../index.html" class="back-btn">← 돌아가기</a>
    
    <div class="header">
      <h1>사주팔자</h1>
      <p>당신의 사주를 상세하게 분석해드립니다</p>
    </div>

    <div class="user-info-display" id="userInfoDisplay">
      사주 정보를 불러오는 중...
    </div>

    <button class="generate-btn" onclick="generateSaju()">사주 보기</button>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>사주를 분석하고 있습니다...</p>
    </div>

    <div id="resultContainer">
      <div class="category-menu" id="categoryMenu">
        <button class="category-btn active" onclick="showCategory('total')">총운</button>
        <button class="category-btn" onclick="showCategory('personality')">성격/장단점</button>
        <button class="category-btn" onclick="showCategory('daeun')">대운</button>
        <button class="category-btn" onclick="showCategory('wealth')">재물운</button>
        <button class="category-btn" onclick="showCategory('love')">애정운</button>
        <button class="category-btn" onclick="showCategory('health')">건강운</button>
        <button class="category-btn" onclick="showCategory('career')">직업운</button>
        <button class="category-btn" onclick="showCategory('study')">학업운</button>
        <button class="category-btn" onclick="showCategory('promotion')">승진운</button>
        <button class="category-btn" onclick="showCategory('move')">이동운</button>
        <button class="category-btn" onclick="showCategory('travel')">여행운</button>
        <button class="category-btn" onclick="showCategory('parents')">부모운</button>
        <button class="category-btn" onclick="showCategory('siblings')">형제운</button>
        <button class="category-btn" onclick="showCategory('children')">자녀운</button>
        <button class="category-btn" onclick="showCategory('spouse')">배우자운</button>
        <button class="category-btn" onclick="showCategory('social')">대인관계운</button>
        <button class="category-btn" onclick="showCategory('aptitude')">직업 적성</button>
        <button class="category-btn" onclick="showCategory('job')">어울리는 직업</button>
        <button class="category-btn" onclick="showCategory('business')">사업 성공</button>
        <button class="category-btn" onclick="showCategory('sinsal')">신살</button>
        <button class="category-btn" onclick="showCategory('taekil')">택일</button>
      </div>

      <div id="sajuBasicInfo"></div>
      <div id="categoryResult"></div>

      <div class="action-buttons">
        <button class="action-btn" onclick="location.reload()">다시 보기</button>
        <button class="action-btn" onclick="copySaju()">내용 복사</button>
      </div>
    </div>
  </div>

  <script>
    let savedData = null;
    let currentSajuData = null;
    let currentCategory = 'total';

    // 십성 계산기
    const TenStarsCalculator = {
      cheonganElements: {
        '갑': '목', '을': '목', '병': '화', '정': '화',
        '무': '토', '기': '토', '경': '금', '신': '금',
        '임': '수', '계': '수'
      },
      cheonganYinYang: {
        '갑': '양', '을': '음', '병': '양', '정': '음',
        '무': '양', '기': '음', '경': '양', '신': '음',
        '임': '양', '계': '음'
      },
      jijiElements: {
        '자': '수', '축': '토', '인': '목', '묘': '목',
        '진': '토', '사': '화', '오': '화', '미': '토',
        '신': '금', '유': '금', '술': '토', '해': '수'
      },
      elementRelations: {
        '목': { 생: '화', 극: '토', 생받음: '수', 극받음: '금' },
        '화': { 생: '토', 극: '금', 생받음: '목', 극받음: '수' },
        '토': { 생: '금', 극: '수', 생받음: '화', 극받음: '목' },
        '금': { 생: '수', 극: '목', 생받음: '토', 극받음: '화' },
        '수': { 생: '목', 극: '화', 생받음: '금', 극받음: '토' }
      },
      
      getTenStar(ilganElement, ilganYinYang, targetElement, targetYinYang) {
        const relation = this.elementRelations[ilganElement];
        const sameYinYang = ilganYinYang === targetYinYang;
        
        if (ilganElement === targetElement) {
          return sameYinYang ? '비견' : '겁재';
        }
        if (relation.생 === targetElement) {
          return sameYinYang ? '식신' : '상관';
        }
        if (relation.극 === targetElement) {
          return sameYinYang ? '편재' : '정재';
        }
        if (relation.극받음 === targetElement) {
          return sameYinYang ? '편관' : '정관';
        }
        if (relation.생받음 === targetElement) {
          return sameYinYang ? '편인' : '정인';
        }
        return '미상';
      },

      calculate(saju, ilgan) {
        const ilganElement = this.cheonganElements[ilgan];
        const ilganYinYang = this.cheonganYinYang[ilgan];

        const result = {
          year: { cheongan: saju.year.cheongan, jiji: saju.year.jiji, cheonganStar: null, jijiStar: null },
          month: { cheongan: saju.month.cheongan, jiji: saju.month.jiji, cheonganStar: null, jijiStar: null },
          day: { cheongan: ilgan, jiji: saju.day.jiji, cheonganStar: '일간', jijiStar: null },
          hour: { cheongan: saju.hour.cheongan, jiji: saju.hour.jiji, cheonganStar: null, jijiStar: null }
        };

        ['year', 'month', 'hour'].forEach(pillar => {
          const cheonganElement = this.cheonganElements[result[pillar].cheongan];
          const cheonganYinYang = this.cheonganYinYang[result[pillar].cheongan];
          result[pillar].cheonganStar = this.getTenStar(ilganElement, ilganYinYang, cheonganElement, cheonganYinYang);
        });

        ['year', 'month', 'day', 'hour'].forEach(pillar => {
          const jijiElement = this.jijiElements[result[pillar].jiji];
          result[pillar].jijiStar = this.getTenStar(ilganElement, ilganYinYang, jijiElement, ilganYinYang);
        });

        return result;
      },

      countStars(tenStars) {
        const count = { 비견: 0, 겁재: 0, 식신: 0, 상관: 0, 편재: 0, 정재: 0, 편관: 0, 정관: 0, 편인: 0, 정인: 0 };
        ['year', 'month', 'day', 'hour'].forEach(pillar => {
          const cheonganStar = tenStars[pillar].cheonganStar;
          const jijiStar = tenStars[pillar].jijiStar;
          if (cheonganStar && cheonganStar !== '일간' && count[cheonganStar] !== undefined) {
            count[cheonganStar]++;
          }
          if (jijiStar && count[jijiStar] !== undefined) {
            count[jijiStar]++;
          }
        });
        return count;
      }
    };

    // 일간별 특성 템플릿
    const IlganTemplates = {
      '갑': {
        name: '갑목(甲木)',
        traits: '큰 나무처럼 굳건하고 정직한',
        description: '갑목 일간은 큰 나무처럼 굳건하고 정직한 성격입니다. 리더십이 강하고 책임감이 있으며, 추진력이 뛰어납니다.',
        personality: '정직하고 강직한 성격으로 원칙을 중시합니다. 장점은 리더십과 추진력이 강하며, 정의감이 있다는 것입니다. 단점으로는 때로 고집이 세고 융통성이 부족할 수 있습니다.',
        career: '리더십 분야, 경영직, 공직, 정치, 교육 등이 적합합니다.',
        jobs: '임원, 사업가, 정치인, 교사, 공무원, 법조인, 언론인',
        strength_good: '신강하면 리더십이 더욱 강해지고 성취도가 높습니다.',
        strength_weak: '신약하면 협력을 통한 발전이 필요하며 참모 역할이 좋습니다.'
      },
      '을': {
        name: '을목(乙木)',
        traits: '작은 풀과 같이 유연하고 섬세한',
        description: '을목 일간은 작은 풀처럼 유연하고 섬세한 성격입니다. 적응력이 뛰어나고 창의적이며, 예술적 감각이 있습니다.',
        personality: '유연하고 섬세한 성격으로 적응력이 뛰어납니다. 장점은 창의적이고 예술적 감각이 뛰어나며, 대인관계가 좋다는 것입니다. 단점으로는 때로 우유부단하고 결단력이 부족할 수 있습니다.',
        career: '창작, 예술, 디자인, 상담, 교육 등이 적합합니다.',
        jobs: '예술가, 디자이너, 작가, 상담사, 교사, 마케터, 방송인',
        strength_good: '신강하면 창의력이 더욱 발휘되고 예술적 재능이 빛납니다.',
        strength_weak: '신약하면 타인의 지원을 통해 재능을 발휘하는 것이 좋습니다.'
      },
      '병': {
        name: '병화(丙火)',
        traits: '태양처럼 밝고 열정적인',
        description: '병화 일간은 태양처럼 밝고 열정적인 성격입니다. 카리스마가 있고 대인관계가 좋으며, 활동적입니다.',
        personality: '밝고 열정적인 성격으로 긍정적입니다. 장점은 카리스마가 있고 리더십이 강하며, 사교성이 좋다는 것입니다. 단점으로는 때로 충동적이고 인내심이 부족할 수 있습니다.',
        career: '대외활동, 영업, 방송, 연예, 정치 등이 적합합니다.',
        jobs: '연예인, 방송인, 영업사원, 정치인, 사업가, 마케터',
        strength_good: '신강하면 리더십과 카리스마가 더욱 강해집니다.',
        strength_weak: '신약하면 체력 관리가 중요하며 과한 활동을 자제해야 합니다.'
      },
      '정': {
        name: '정화(丁火)',
        traits: '촛불처럼 따뜻하고 섬세한',
        description: '정화 일간은 촛불처럼 따뜻하고 섬세한 성격입니다. 배려심이 깊고 예술적 감각이 뛰어나며, 집중력이 좋습니다.',
        personality: '따뜻하고 섬세한 성격으로 배려심이 깊습니다. 장점은 예술적 감각이 뛰어나고 집중력이 좋으며, 인간미가 있다는 것입니다. 단점으로는 때로 지나치게 예민하고 감정적일 수 있습니다.',
        career: '예술, 요리, 의료, 상담, 교육 등이 적합합니다.',
        jobs: '예술가, 요리사, 의사, 간호사, 상담사, 교사, 작가',
        strength_good: '신강하면 예술적 재능이 더욱 발휘되고 창조성이 높아집니다.',
        strength_weak: '신약하면 건강 관리가 중요하며 안정적인 환경이 필요합니다.'
      },
      '무': {
        name: '무토(戊土)',
        traits: '큰 산처럼 안정적이고 신뢰감 있는',
        description: '무토 일간은 큰 산처럼 안정적이고 신뢰감 있는 성격입니다. 포용력이 크고 현실적이며, 책임감이 강합니다.',
        personality: '안정적이고 신뢰감 있는 성격으로 포용력이 큽니다. 장점은 현실적이고 책임감이 강하며, 인내심이 뛰어나다는 것입니다. 단점으로는 때로 보수적이고 변화에 느릴 수 있습니다.',
        career: '부동산, 건설, 금융, 공직, 경영 등이 적합합니다.',
        jobs: '부동산 중개인, 건설업자, 은행원, 공무원, 경영인, 회계사',
        strength_good: '신강하면 안정성과 신뢰도가 더욱 높아집니다.',
        strength_weak: '신약하면 꾸준한 노력이 필요하며 조급하지 않은 것이 좋습니다.'
      },
      '기': {
        name: '기토(己土)',
        traits: '밭처럼 포용력 있고 실용적인',
        description: '기토 일간은 밭처럼 포용력이 크고 실용적인 성격입니다. 현실적이고 꼼꼼하며, 배려심이 깊습니다.',
        personality: '포용력이 크고 실용적인 성격으로 꼼꼼합니다. 장점은 배려심이 깊고 현실적이며, 분석력이 뛰어나다는 것입니다. 단점으로는 때로 지나치게 신중하고 결단이 느릴 수 있습니다.',
        career: '농업, 요리, 의료, 복지, 교육 등이 적합합니다.',
        jobs: '농업인, 요리사, 영양사, 의료인, 사회복지사, 교사',
        strength_good: '신강하면 실용성과 안정성이 더욱 높아집니다.',
        strength_weak: '신약하면 체력 관리가 중요하며 무리하지 않는 것이 좋습니다.'
      },
      '경': {
        name: '경금(庚金)',
        traits: '쇠처럼 강하고 결단력 있는',
        description: '경금 일간은 쇠처럼 강하고 결단력 있는 성격입니다. 용기가 있고 정의감이 강하며, 추진력이 뛰어납니다.',
        personality: '강하고 결단력 있는 성격으로 용기가 있습니다. 장점은 정의감이 강하고 추진력이 뛰어나며, 리더십이 있다는 것입니다. 단점으로는 때로 지나치게 직설적이고 융통성이 부족할 수 있습니다.',
        career: '군인, 경찰, 운동선수, 기술직, 제조업 등이 적합합니다.',
        jobs: '군인, 경찰, 운동선수, 엔지니어, 제조업자, 건설업자',
        strength_good: '신강하면 추진력과 결단력이 더욱 강해집니다.',
        strength_weak: '신약하면 협력이 중요하며 과한 경쟁을 피하는 것이 좋습니다.'
      },
      '신': {
        name: '신금(辛金)',
        traits: '보석처럼 아름답고 섬세한',
        description: '신금 일간은 보석처럼 아름답고 섬세한 성격입니다. 예술적 감각이 뛰어나고 완벽주의적이며, 품격이 있습니다.',
        personality: '아름답고 섬세한 성격으로 예술적 감각이 뛰어납니다. 장점은 완벽주의적이고 품격이 있으며, 심미안이 뛰어나다는 것입니다. 단점으로는 때로 지나치게 까다롭고 예민할 수 있습니다.',
        career: '예술, 디자인, 보석, 패션, 금융 등이 적합합니다.',
        jobs: '예술가, 디자이너, 보석상, 패션 디자이너, 금융전문가',
        strength_good: '신강하면 예술적 재능과 완벽함이 더욱 빛납니다.',
        strength_weak: '신약하면 건강 관리가 중요하며 스트레스 관리가 필요합니다.'
      },
      '임': {
        name: '임수(壬水)',
        traits: '큰 바다처럼 포용력 있고 지혜로운',
        description: '임수 일간은 큰 바다처럼 포용력이 크고 지혜로운 성격입니다. 통찰력이 뛰어나고 적응력이 좋으며, 활동적입니다.',
        personality: '포용력이 크고 지혜로운 성격으로 통찰력이 뛰어납니다. 장점은 적응력이 좋고 활동적이며, 리더십이 있다는 것입니다. 단점으로는 때로 지나치게 자유분방하고 변덕스러울 수 있습니다.',
        career: '무역, 해운, 여행, 물류, 언론 등이 적합합니다.',
        jobs: '무역업자, 해운업자, 여행가이드, 물류 전문가, 언론인',
        strength_good: '신강하면 활동력과 포용력이 더욱 커집니다.',
        strength_weak: '신약하면 과한 활동을 자제하고 안정을 추구하는 것이 좋습니다.'
      },
      '계': {
        name: '계수(癸水)',
        traits: '이슬처럼 부드럽고 융통성 있는',
        description: '계수 일간은 이슬처럼 부드럽고 융통성 있는 성격입니다. 적응력이 뛰어나고 창의적이며, 배려심이 깊습니다.',
        personality: '부드럽고 융통성 있는 성격으로 적응력이 뛰어납니다. 장점은 창의적이고 배려심이 깊으며, 직관이 뛰어나다는 것입니다. 단점으로는 때로 우유부단하고 자신감이 부족할 수 있습니다.',
        career: '교육, 상담, 예술, 의료, 서비스업 등이 적합합니다.',
        jobs: '교사, 상담사, 예술가, 의료인, 서비스 종사자, 작가',
        strength_good: '신강하면 창의력과 직관력이 더욱 발휘됩니다.',
        strength_weak: '신약하면 타인의 지원이 중요하며 협력이 필요합니다.'
      }
    };

    function loadUserInfo() {
      const data = localStorage.getItem('fortuneUserData');
      if (data) {
        savedData = JSON.parse(data);
        const display = document.getElementById('userInfoDisplay');
        const birthDate = savedData.isLunar ? savedData.birthDate + ' (음력)' : savedData.birthDate;
        display.innerHTML = `<strong>${savedData.name || '사용자'}</strong>님<br>생년월일: ${birthDate}<br>생시: ${savedData.birthTime}`;
      } else {
        alert('사용자 정보가 없습니다.');
        location.href = '../index.html';
      }
    }

    async function generateSaju() {
      if (!savedData) {
        alert('사용자 정보가 없습니다.');
        return;
      }
      document.getElementById('loading').classList.add('show');
      setTimeout(() => {
        currentSajuData = getMockSajuResult();
        displaySajuBasic(currentSajuData);
        showCategory('total');
        document.getElementById('loading').classList.remove('show');
        document.getElementById('resultContainer').classList.add('show');
      }, 500);
    }

    function getMockSajuResult() {
      // 랜덤 일간 선택 (테스트용)
      const ilganList = ['갑', '을', '병', '정', '무', '기', '경', '신', '임', '계'];
      const randomIlgan = ilganList[Math.floor(Math.random() * ilganList.length)];
      
      const saju = {
        year: { cheongan: '경', jiji: '오', hanja: '경오' },
        month: { cheongan: '무', jiji: '오', hanja: '무오' },
        day: { cheongan: randomIlgan, jiji: '축', hanja: `${randomIlgan}축` },
        hour: { cheongan: '갑', jiji: '인', hanja: '갑인' },
        ilgan: randomIlgan
      };

      // 십성 계산
      const tenStars = TenStarsCalculator.calculate(saju, randomIlgan);
      const tenStarsCount = TenStarsCalculator.countStars(tenStars);

      // 일간별 특성 가져오기
      const ilganTemplate = IlganTemplates[randomIlgan];

      // 오행 계산 (간단화)
      const elements = { 목: 1, 화: 2, 토: 2, 금: 1, 수: 2 };
      
      // 신강/신약 판정
      const ilganElement = TenStarsCalculator.cheonganElements[randomIlgan];
      const strength = elements[ilganElement] >= 3 ? '신강' : '신약';
      
      // 용신 찾기 (가장 부족한 오행)
      const minElement = Object.keys(elements).reduce((a, b) => 
        elements[a] < elements[b] ? a : b
      );
      const yongsinMap = { 목: '목(木)', 화: '화(火)', 토: '토(土)', 금: '금(金)', 수: '수(水)' };
      const yongsin = yongsinMap[minElement];

      // 일간별 맞춤 해석
      const strengthDesc = strength === '신강' 
        ? ilganTemplate.strength_good 
        : ilganTemplate.strength_weak;

      return {
        saju: {
          year: saju.year,
          month: saju.month,
          day: saju.day,
          hour: saju.hour,
          ilgan: ilganTemplate.name
        },
        elements: elements,
        strength: strength,
        yongsin: yongsin,
        tenStars: tenStars,
        tenStarsCount: tenStarsCount,
        interpretations: {
          total: `당신은 ${ilganTemplate.name} 일간으로 태어나 ${ilganTemplate.traits} 성격을 가지고 있습니다. ${ilganTemplate.description} 오행 분석 결과 ${strength} 사주로 ${strengthDesc} 용신은 ${yongsin}으로, 이를 활용하면 인생의 균형을 잡을 수 있습니다.`,
          personality: ilganTemplate.personality,
          daeun: '현재 3-13세 대운 시기에는 기초를 다지는 시기입니다. 13-23세에는 학업과 기초 능력 발전의 시기, 23-33세는 본격적인 사회 진출과 독립의 시기입니다. 33-43세는 사회적 성취의 시기, 43-53세는 안정과 성숙의 시기입니다.',
          wealth: `재물운은 ${strength === '신강' ? '좋은' : '중간'} 편입니다. ${yongsin} 용신을 활용하여 ${strength === '신강' ? '적극적인 투자' : '안정적인 저축'}를 추천합니다. ${ilganTemplate.name} 특성상 ${strength === '신강' ? '리더십을 활용한 사업' : '협력을 통한 재테크'}이 유리합니다.`,
          love: `애정운은 ${ilganTemplate.traits} 성격으로 ${strength === '신강' ? '주도적인 관계' : '배려심 깊은 관계'}를 유지합니다. 상대방을 존중하는 마음이 깊어 오랜 관계를 유지할 수 있습니다. ${strength === '신약' ? '자신의 감정을 솔직하게 표현하는 연습이 필요합니다.' : '상대방의 의견도 경청하는 자세가 필요합니다.'}`,
          health: `${ilganElement}에 해당하는 장기를 주의해야 합니다. ${strength === '신약' ? '체력 관리가 특히 중요하며' : '과한 활동을 자제하고'} 규칙적인 생활과 적당한 운동으로 건강을 유지하세요. ${yongsin}에 해당하는 음식을 섭취하는 것이 도움이 됩니다.`,
          career: ilganTemplate.career + ` ${strength === '신강' ? '리더십을 발휘하는 위치' : '협력이 중요한 팀 환경'}에서 능력을 발휘할 수 있습니다.`,
          study: `학습 능력이 ${strength === '신강' ? '우수하며 자기주도적' : '뛰어나며 협력학습'} 학습이 잘 맞습니다. ${ilganTemplate.name} 특성상 ${strength === '신강' ? '창의적이고 독창적인' : '꾸준하고 체계적인'} 학습법이 효과적입니다.`,
          promotion: `승진운은 ${strength === '신강' ? '좋은' : '중간'} 편입니다. ${strength === '신강' ? '적극적인 업무 추진' : '성실한 업무 처리'}과 ${strength === '신강' ? '리더십 발휘' : '타인과의 협력'}로 좋은 평가를 받을 수 있습니다.`,
          move: `이동운은 ${strength === '신강' ? '활발한' : '안정적인'} 편입니다. 새로운 환경에 ${strength === '신강' ? '빠르게 적응하며' : '신중하게 대처하며'} 이사나 이직 시 ${strength === '신강' ? '적극적으로' : '신중하게'} 결정하면 좋은 결과를 얻을 수 있습니다.`,
          travel: `여행운은 좋은 편입니다. ${yongsin}에 해당하는 방향의 여행이 특히 좋으며, ${strength === '신강' ? '모험적인 여행' : '안정적인 여행'}을 추천합니다. 가족이나 친구와 함께하는 여행이 좋습니다.`,
          parents: '부모님과의 인연은 깊습니다. 효도의 마음이 강하며 부모님의 건강을 항상 체크하는 것이 중요합니다. 부모님과의 소통을 자주 하는 것이 좋습니다.',
          siblings: `형제자매와의 관계는 ${strength === '신강' ? '주도적이며' : '협력적이며'} 우애가 깊습니다. 서로 도움을 주고받는 관계를 유지하며, 가족 행사 시 ${strength === '신강' ? '중심' : '조력자'} 역할을 합니다.`,
          children: `자녀와의 인연은 깊으며 자녀가 ${strength === '신강' ? '독립적이고 리더십이' : '효성이 깊고 순종적으로'} 있습니다. 자녀 교육에 관심이 많으며 좋은 교육 결과를 기대할 수 있습니다.`,
          spouse: `배우자와의 궁합은 ${strength === '신강' ? '주도적이고 적극적인' : '배려심 깊고 안정적인'} 관계입니다. 서로를 존중하고 배려하는 관계로 행복한 결혼 생활을 영위할 수 있습니다.`,
          social: `대인관계운은 ${strength === '신강' ? '적극적이고 리더십이 있어' : '부드럽고 배려심이 있어'} 좋습니다. ${strength === '신강' ? '많은' : '진정성 있는'} 사람들과 좋은 관계를 유지합니다. ${strength === '신강' ? '리더십을 발휘하되 경청도 중요합니다.' : '자신의 의견도 표현하는 연습이 필요합니다.'}`,
          aptitude: ilganTemplate.career + ` ${strength === '신강' ? '리더 역할' : '전문가 역할'}에 강점이 있습니다.`,
          job: `추천 직업: ${ilganTemplate.jobs}. 특히 ${strength === '신강' ? '리더십과 추진력을 발휘할 수 있는' : '협력과 전문성을 살릴 수 있는'} 분야가 잘 어울립니다.`,
          business: `사업 성공 가능성은 ${strength === '신강' ? '높은' : '중간'} 수준입니다. ${strength === '신강' ? '독립 창업' : '공동 창업이나 파트너십 사업'}이 유리하며, ${ilganTemplate.career.split(',')[0]} 관련 사업을 추천합니다.`,
          sinsal: `${strength === '신강' ? '리더십을 상징하는 천을귀인' : '보호를 상징하는 천덕귀인'}이 있어 위기 시 도움을 받을 수 있습니다. ${tenStarsCount.편재 + tenStarsCount.정재 > 2 ? '재성이 많아 재물운이 좋으며' : ''} ${tenStarsCount.편관 + tenStarsCount.정관 > 2 ? '관성이 많아 명예운이 좋습니다.' : '안정적인 운세입니다.'}`,
          taekil: `2025년 10월 길일: 5일(대길일, 95점), 10일(길일, 90점), 15일(길일, 85점)이 추천됩니다. 특히 ${yongsin}에 해당하는 날은 모든 일에 좋으며, ${strength === '신강' ? '적극적인 활동' : '중요한 결정'}에 적합합니다.`
        }
      };
    }

    function displaySajuBasic(data) {
      const pillarsHTML = [
        { label: '년주', ganzi: data.saju.year, tenStar: data.tenStars.year },
        { label: '월주', ganzi: data.saju.month, tenStar: data.tenStars.month },
        { label: '일주', ganzi: data.saju.day, tenStar: data.tenStars.day },
        { label: '시주', ganzi: data.saju.hour, tenStar: data.tenStars.hour }
      ].map(p => `
        <div class="pillar">
          <div class="pillar-label">${p.label}</div>
          <div class="pillar-char">${p.ganzi.hanja}</div>
          <div class="pillar-star">${p.tenStar.cheonganStar || ''}</div>
          <div class="pillar-star">${p.tenStar.jijiStar || ''}</div>
        </div>
      `).join('');

      const total = Object.values(data.elements).reduce((a, b) => a + b, 0);
      const elementsHTML = Object.entries(data.elements).map(([name, count]) => {
        const percentage = (count / total) * 100;
        const hanja = {목:'木',화:'火',토:'土',금:'金',수:'水'}[name];
        return `
          <div class="element-bar">
            <div class="element-label">
              <span>${name}(${hanja})</span>
              <span>${count}개</span>
            </div>
            <div class="bar">
              <div class="bar-fill element-${name}" style="width: ${percentage}%"></div>
            </div>
          </div>
        `;
      }).join('');

      const tenStarsList = ['비견', '겁재', '식신', '상관', '편재', '정재', '편관', '정관', '편인', '정인'];
      const tenStarsHTML = tenStarsList.map(star => {
        const count = data.tenStarsCount[star];
        return `
          <div class="ten-star-item ${count > 0 ? 'has-star' : ''}">
            ${star}<br>${count}
          </div>
        `;
      }).join('');

      document.getElementById('sajuBasicInfo').innerHTML = `
        <div class="saju-card">
          <h3>사주 8글자</h3>
          <div class="saju-pillars">${pillarsHTML}</div>
          <p style="text-align: center; margin-top: 15px;">
            일간: <strong style="color: #f39c12; font-size: 18px;">${data.saju.ilgan}</strong>
          </p>
          <div class="ten-stars-summary">
            <h4>⭐ 십성 분포</h4>
            <div class="ten-stars-grid">${tenStarsHTML}</div>
          </div>
        </div>

        <div class="saju-card">
          <h3>오행 분포</h3>
          <div class="elements-chart">${elementsHTML}</div>
          <p style="text-align: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid #ffd700;">
            신강/신약: <strong style="color: #e74c3c;">${data.strength}</strong> &nbsp;|&nbsp; 
            용신: <strong style="color: #3498db;">${data.yongsin}</strong>
          </p>
        </div>
      `;
    }

    function showCategory(category) {
      currentCategory = category;
      
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      const titles = {
        total: '총운',
        personality: '성격/장단점',
        daeun: '대운',
        wealth: '재물운',
        love: '애정운',
        health: '건강운',
        career: '직업운',
        study: '학업운',
        promotion: '승진운',
        move: '이동운',
        travel: '여행운',
        parents: '부모운',
        siblings: '형제운',
        children: '자녀운',
        spouse: '배우자운',
        social: '대인관계운',
        aptitude: '직업 적성',
        job: '어울리는 직업',
        business: '사업 성공',
        sinsal: '신살',
        taekil: '택일'
      };

      const interpretation = currentSajuData.interpretations[category] || '해당 카테고리의 해석을 준비 중입니다.';

      document.getElementById('categoryResult').innerHTML = `
        <div class="fortune-card">
          <h3>${titles[category]}</h3>
          <p>${interpretation}</p>
        </div>
      `;
    }

    function copySaju() {
      const text = document.getElementById('resultContainer').innerText;
      navigator.clipboard.writeText(text).then(() => {
        alert('내용이 복사되었습니다!');
      }).catch(() => {
        alert('복사 실패');
      });
    }

    window.onload = function() {
      loadUserInfo();
    };
  </script>
</body>
</html>
