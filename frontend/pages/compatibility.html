<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>궁합 보기 - 우리의 운세</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Malgun Gothic', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      max-width: 600px;
      width: 100%;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 28px;
      color: #333;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
      font-size: 14px;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 8px 15px;
      background: #f0f0f0;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      text-decoration: none;
      color: #333;
      margin-bottom: 20px;
    }

    .back-btn:hover {
      background: #e0e0e0;
    }

    /* 타입 선택 */
    .type-selector {
      margin-bottom: 30px;
    }

    .type-selector h3 {
      font-size: 16px;
      color: #333;
      margin-bottom: 15px;
      text-align: center;
    }

    .type-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .type-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 15px 10px;
      background: #f8f9fa;
      border: 2px solid transparent;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .type-btn:hover {
      background: #e9ecef;
      transform: translateY(-2px);
    }

    .type-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: #667eea;
      color: white;
    }

    .type-btn .icon {
      font-size: 28px;
    }

    .type-btn .label {
      font-size: 14px;
      font-weight: 500;
    }

    .type-btn.active .label {
      color: white;
    }

    /* 입력 섹션 */
    .input-section {
      margin-bottom: 25px;
    }

    .person-input {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 15px;
    }

    .person-input h4 {
      font-size: 16px;
      color: #333;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .date-input-group {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .date-input-group input {
      flex: 1;
      padding: 12px;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      font-size: 14px;
      text-align: center;
    }

    .date-input-group input:focus {
      outline: none;
      border-color: #667eea;
    }

    input[type="date"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      font-size: 14px;
    }

    input[type="date"]:focus {
      outline: none;
      border-color: #667eea;
    }

    .zodiac-display {
      margin-top: 10px;
      padding: 10px;
      background: white;
      border-radius: 8px;
      text-align: center;
      font-size: 14px;
      color: #667eea;
      font-weight: 500;
    }

    .vs-divider {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
      margin: 15px 0;
    }

    /* 제출 버튼 */
    .submit-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 15px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }

    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    /* 로딩 */
    .loading {
      display: none;
      text-align: center;
      padding: 40px;
    }

    .loading.active {
      display: block;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* 결과 섹션 */
    .result-section {
      display: none;
    }

    .result-section.active {
      display: block;
    }

    .score-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      margin-bottom: 20px;
    }

    .score-circle {
      display: inline-block;
      margin-bottom: 15px;
    }

    .score-number {
      font-size: 60px;
      font-weight: bold;
    }

    .score-max {
      font-size: 24px;
      opacity: 0.8;
    }

    .star-rating {
      font-size: 32px;
      margin-bottom: 10px;
    }

    .level-text {
      font-size: 24px;
      font-weight: 600;
    }

    /* 상세 카드 */
    .detail-card {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .detail-card h4 {
      font-size: 16px;
      color: #333;
      margin-bottom: 15px;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #dee2e6;
    }

    .detail-row:last-child {
      border-bottom: none;
    }

    .detail-row span:first-child {
      color: #666;
      font-size: 14px;
    }

    .detail-row span:last-child {
      color: #333;
      font-weight: 500;
      font-size: 14px;
    }

    /* 해석 카드 */
    .interpretation-card {
      background: #fff;
      border: 2px solid #667eea;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .interpretation-card h4 {
      font-size: 16px;
      color: #667eea;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .interpretation-text {
      color: #333;
      line-height: 1.8;
      font-size: 15px;
    }

    /* 조언 그리드 */
    .advice-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .advice-card {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 15px;
    }

    .advice-card h5 {
      font-size: 14px;
      color: #667eea;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .advice-card p {
      font-size: 13px;
      color: #333;
      line-height: 1.6;
    }

    /* 다시하기 버튼 */
    .retry-btn {
      width: 100%;
      padding: 15px;
      background: #f8f9fa;
      color: #333;
      border: 2px solid #dee2e6;
      border-radius: 15px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .retry-btn:hover {
      background: #e9ecef;
      border-color: #667eea;
      color: #667eea;
    }

    /* 반응형 */
    @media (max-width: 600px) {
      .type-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .advice-grid {
        grid-template-columns: 1fr;
      }

      .score-number {
        font-size: 48px;
      }

      .star-rating {
        font-size: 24px;
      }

      .level-text {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- 뒤로가기 -->
    <a href="../index.html" class="back-btn">
      ← 홈으로
    </a>

    <!-- 헤더 -->
    <div class="header">
      <h1>🔮 궁합 보기</h1>
      <p>두 사람의 띠와 오행으로 궁합을 알아보세요</p>
    </div>

    <!-- 입력 폼 -->
    <div id="input-form">
      <!-- 타입 선택 -->
      <div class="type-selector">
        <h3>어떤 관계의 궁합을 보시나요?</h3>
        <div class="type-grid">
          <button class="type-btn active" data-type="lover">
            <span class="icon">❤️</span>
            <span class="label">연인</span>
          </button>
          <button class="type-btn" data-type="marriage">
            <span class="icon">💍</span>
            <span class="label">결혼</span>
          </button>
          <button class="type-btn" data-type="family">
            <span class="icon">👨‍👩‍👧‍👦</span>
            <span class="label">가족</span>
          </button>
          <button class="type-btn" data-type="friend">
            <span class="icon">👯</span>
            <span class="label">친구</span>
          </button>
          <button class="type-btn" data-type="business">
            <span class="icon">💼</span>
            <span class="label">동업</span>
          </button>
          <button class="type-btn" data-type="work">
            <span class="icon">🏢</span>
            <span class="label">직장</span>
          </button>
        </div>
      </div>

      <!-- 입력 섹션 -->
      <div class="input-section">
        <div class="person-input">
          <h4>🙋‍♀️ 나의 정보</h4>
          <input type="date" id="person1-date" max="2025-12-31" />
          <div class="zodiac-display" id="person1-zodiac">
            띠: -
          </div>
        </div>

        <div class="vs-divider">VS</div>

        <div class="person-input">
          <h4>🙋‍♂️ 상대방 정보</h4>
          <input type="date" id="person2-date" max="2025-12-31" />
          <div class="zodiac-display" id="person2-zodiac">
            띠: -
          </div>
        </div>
      </div>

      <button class="submit-btn" onclick="calculateCompatibility()">
        궁합 보기
      </button>
    </div>

    <!-- 로딩 -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p>Claude AI가 궁합을 분석하고 있습니다...</p>
    </div>

    <!-- 결과 섹션 -->
    <div class="result-section" id="result">
      <!-- 점수 카드 -->
      <div class="score-card">
        <div class="score-circle">
          <span class="score-number" id="score-number">85</span>
          <span class="score-max">/100</span>
        </div>
        <div class="star-rating" id="star-rating">⭐⭐⭐⭐☆</div>
        <h3 class="level-text" id="level-text">매우 좋은 궁합!</h3>
      </div>

      <!-- 상세 분석 -->
      <div class="detail-card">
        <h4>📊 상세 분석</h4>
        <div class="detail-row">
          <span>궁합 타입:</span>
          <span id="type-display">연인 궁합</span>
        </div>
        <div class="detail-row">
          <span>띠:</span>
          <span id="zodiac-display">쥐띠 ♥ 용띠</span>
        </div>
        <div class="detail-row">
          <span>오행:</span>
          <span id="element-display">수(水) ♥ 토(土)</span>
        </div>
        <div class="detail-row">
          <span>오행 관계:</span>
          <span id="element-relation">피극 (제압 받는 관계)</span>
        </div>
        <div class="detail-row">
          <span>띠 관계:</span>
          <span id="zodiac-relation">천생연분</span>
        </div>
      </div>

      <!-- Claude 해석 -->
      <div class="interpretation-card">
        <h4>💬 전문가 해석</h4>
        <p id="claude-interpretation" class="interpretation-text">
          <!-- Claude API 결과 -->
        </p>
      </div>

      <!-- 조언 카드 -->
      <div class="advice-grid">
        <div class="advice-card">
          <h5>💡 핵심 조언</h5>
          <p id="core-advice">-</p>
        </div>
        <div class="advice-card">
          <h5>✨ 장점</h5>
          <p id="strengths">-</p>
        </div>
        <div class="advice-card">
          <h5>⚠️ 주의사항</h5>
          <p id="cautions">-</p>
        </div>
        <div class="advice-card">
          <h5>🎨 행운의 색</h5>
          <p id="lucky-color">-</p>
        </div>
      </div>

      <!-- 추천 활동 -->
      <div class="detail-card">
        <h4>🎯 추천 활동</h4>
        <p id="recommended-activity" style="color: #333; font-size: 14px; line-height: 1.6;">-</p>
      </div>

      <!-- 다시하기 버튼 -->
      <button class="retry-btn" onclick="resetForm()">
        다시 궁합 보기
      </button>
    </div>
  </div>

  <script>
    // 현재 선택된 타입
    let selectedType = 'lover';

    // 타입 선택 버튼
    document.querySelectorAll('.type-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        // 모든 버튼 비활성화
        document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('active'));
        // 클릭한 버튼 활성화
        this.classList.add('active');
        selectedType = this.dataset.type;
      });
    });

    // 띠 계산 함수
    const zodiacAnimals = [
      '쥐', '소', '호랑이', '토끼', 
      '용', '뱀', '말', '양', 
      '원숭이', '닭', '개', '돼지'
    ];

    function getZodiacFromYear(year) {
      const index = (year - 4) % 12;
      return zodiacAnimals[index];
    }

    // 날짜 입력 시 띠 표시
    document.getElementById('person1-date').addEventListener('change', function(e) {
      const date = new Date(e.target.value);
      const year = date.getFullYear();
      const zodiac = getZodiacFromYear(year);
      document.getElementById('person1-zodiac').textContent = `띠: ${zodiac}띠`;
    });

    document.getElementById('person2-date').addEventListener('change', function(e) {
      const date = new Date(e.target.value);
      const year = date.getFullYear();
      const zodiac = getZodiacFromYear(year);
      document.getElementById('person2-zodiac').textContent = `띠: ${zodiac}띠`;
    });

    // 궁합 계산
    async function calculateCompatibility() {
      const person1Date = document.getElementById('person1-date').value;
      const person2Date = document.getElementById('person2-date').value;

      // 입력 검증
      if (!person1Date || !person2Date) {
        alert('두 사람의 생년월일을 모두 입력해주세요');
        return;
      }

      // 날짜 파싱
      const date1 = new Date(person1Date);
      const date2 = new Date(person2Date);

      const person1 = {
        year: date1.getFullYear(),
        month: date1.getMonth() + 1,
        day: date1.getDate()
      };

      const person2 = {
        year: date2.getFullYear(),
        month: date2.getMonth() + 1,
        day: date2.getDate()
      };

      // UI 전환
      document.getElementById('input-form').style.display = 'none';
      document.getElementById('loading').classList.add('active');

      try {
        // API 호출
        const response = await fetch('http://localhost:3000/api/compatibility', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            type: selectedType,
            person1,
            person2
          })
        });

        const data = await response.json();

        if (!data.success) {
          throw new Error(data.message);
        }

        // 결과 표시
        displayResult(data);

      } catch (error) {
        alert('오류가 발생했습니다: ' + error.message);
        resetForm();
      }
    }

    // 결과 표시
    function displayResult(data) {
      // 점수 카드
      document.getElementById('score-number').textContent = data.score;
      document.getElementById('star-rating').textContent = data.stars;
      document.getElementById('level-text').textContent = data.level;

      // 상세 분석
      document.getElementById('type-display').textContent = data.typeIcon + ' ' + data.typeName;
      document.getElementById('zodiac-display').textContent = 
        `${data.person1.zodiac}띠 ♥ ${data.person2.zodiac}띠`;
      document.getElementById('element-display').textContent = 
        `${data.person1.element} ♥ ${data.person2.element}`;
      document.getElementById('element-relation').textContent = data.elementRelation.type;
      document.getElementById('zodiac-relation').textContent = data.zodiacRelation.description;

      // Claude 해석
      const interp = data.interpretation;
      document.getElementById('claude-interpretation').textContent = interp.궁합분석 || '해석 정보가 없습니다';
      document.getElementById('core-advice').textContent = interp.핵심조언 || '-';
      document.getElementById('strengths').textContent = interp.장점 || '-';
      document.getElementById('cautions').textContent = interp.주의사항 || '-';
      document.getElementById('lucky-color').textContent = interp.행운의색 || '-';
      document.getElementById('recommended-activity').textContent = interp.추천활동 || '-';

      // UI 전환
      document.getElementById('loading').classList.remove('active');
      document.getElementById('result').classList.add('active');
    }

    // 폼 리셋
    function resetForm() {
      document.getElementById('input-form').style.display = 'block';
      document.getElementById('loading').classList.remove('active');
      document.getElementById('result').classList.remove('active');
      
      // 입력 초기화
      document.getElementById('person1-date').value = '';
      document.getElementById('person2-date').value = '';
      document.getElementById('person1-zodiac').textContent = '띠: -';
      document.getElementById('person2-zodiac').textContent = '띠: -';
    }
  </script>
</body>
</html>
