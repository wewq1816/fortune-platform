# 궁합 시스템 설계서

**프로젝트명**: 종합 운세 플랫폼 - 궁합 시스템  
**작성일**: 2025-10-03  
**버전**: 1.0  
**난이도**: ⭐⭐ (가장 쉬움!)  
**예상 작업 시간**: 3-4시간

---

## 🎯 프로젝트 개요

### 핵심 컨셉
- **기존 코드 70% 재사용!** (오행 상생상극 로직)
- **6가지 궁합 타입** 지원으로 차별화
- **타입별 맞춤 해석**으로 정확도 향상
- **Claude AI 스토리텔링**으로 공감대 형성

### 타겟 사용자
- **연인**: 소개팅, 썸, 연애 중인 커플
- **부모**: 자녀 결혼 상대 확인
- **직장인**: 상사/동료와의 관계 이해
- **사업가**: 동업자 선택 참고

---

## 📊 시장 조사 결과

### 궁합 유형별 수요
```
연인 궁합:  ████████████████████████████████████ 80%
결혼 궁합:  ████████                              15%
가족 궁합:  ██                                     3%
친구 궁합:  █                                      1%
동업 궁합:  █                                      1%
직장 궁합:  ░                                    <1%
```

### 경쟁 서비스 분석

#### 리얼미 앱 (인기 1위)
- ✅ 연인, 친구, 가족, 그룹 궁합 지원
- ✅ 세계 최초 그룹 궁합 (3명 이상)
- ✅ 관계 설정별 다른 해석
- ✅ 트러블메이커 찾기 기능

#### 케미 앱
- ✅ 남녀/이성/동성 차별 없음
- ✅ 전문가 직접 작성 해설
- ✅ 이미지로 궁합 표시

#### 네이버/다음 운세
- ✅ 기본적인 띠 궁합만 제공
- ❌ 타입 구분 없음
- ❌ 간단한 텍스트만 제공

### 우리의 차별화 포인트
```
✅ 6가지 관계 타입별 맞춤 해석
✅ Claude AI 스토리텔링 (400-600자)
✅ 오행 상생상극 기반 정확한 계산
✅ 55-65세 여성 타겟 맞춤 조언
✅ 실용적인 관계 조언 제공
```

---

## 🎨 궁합 타입 6종

### 1️⃣ 연인 궁합 (Lover Compatibility)
**목적**: 연애 관계의 지속 가능성 분석

**세부 상황**:
- 소개팅/첫만남 → 첫인상 중심 해석
- 연애 중 → 장기 관계 조언
- 재회 고민 → 다시 만날까?

**해석 포인트**:
- 감정 조화도
- 연애 스타일 매칭
- 갈등 해결 방법
- 사랑의 지속성

**예시 멘트**:
```
"쥐띠와 용띠의 만남은 하늘이 정한 인연입니다.
서로의 부족함을 채워주며 함께 성장하는 관계예요."
```

---

### 2️⃣ 결혼 궁합 (Marriage Compatibility)
**목적**: 평생 해로 가능성 예측

**세부 상황**:
- 결혼 예정 → 결혼 후 생활 예측
- 자녀 결혼 상대 → 부모 입장 조언
- 재혼 → 신중한 분석

**해석 포인트**:
- 금전운 (재산 형성)
- 자식운 (출산, 양육)
- 시댁/처가 관계
- 평생 해로 가능성

**예시 멘트**:
```
"두 분의 만남은 재물운이 매우 좋습니다.
함께 노력하면 부유한 가정을 꾸릴 수 있어요."
```

---

### 3️⃣ 가족 궁합 (Family Compatibility)
**목적**: 가족 간 갈등 이해 및 해결

**세부 상황**:
- 부모-자식 → 세대차이 이해
- 형제자매 → 성격 차이 해결
- 고부관계 → 갈등 완화 조언

**해석 포인트**:
- 세대 차이 극복법
- 성격 이해
- 갈등 해결 방법
- 화목한 가정 만들기

**예시 멘트**:
```
"어머니는 소띠, 아드님은 호랑이띠시군요.
서로 고집이 셀 수 있으니 대화로 풀어가세요."
```

---

### 4️⃣ 친구 궁합 (Friend Compatibility)
**목적**: 우정의 지속성 분석

**세부 상황**:
- 새로운 친구 → 관계 발전 가능성
- 오랜 친구 → 우정 유지 조언
- 그룹 모임 → 케미 확인

**해석 포인트**:
- 친구로서의 케미
- 신뢰 형성 가능성
- 함께 즐길 수 있는 활동
- 갈등 예방법

**예시 멘트**:
```
"두 분은 취미와 관심사가 잘 맞는 친구입니다.
평생 의지할 수 있는 좋은 친구가 될 거예요."
```

---

### 5️⃣ 동업 궁합 (Business Partnership)
**목적**: 사업 성공 가능성 예측

**세부 상황**:
- 사업 시작 → 성공 가능성
- 동업자 선택 → 신뢰도 분석
- 금전 관계 → 돈 문제 예측

**해석 포인트**:
- 사업 시너지
- 역할 분담
- 금전 관계
- 장기 협력 가능성

**예시 멘트**:
```
"두 분의 띠는 상생 관계입니다.
한 분은 아이디어를, 한 분은 실행력을 담당하면 성공합니다."
```

---

### 6️⃣ 직장 궁합 (Workplace Compatibility)
**목적**: 직장 내 관계 이해 및 협업 향상

**세부 상황**:
- 상사-부하 → 업무 스타일 이해
- 동료 → 협업 시너지
- 고객 → 소통 방법

**해석 포인트**:
- 업무 스타일 매칭
- 커뮤니케이션 방법
- 갈등 예방
- 협업 효율성

**예시 멘트**:
```
"상사 분은 꼼꼼한 스타일, 부하 직원은 창의적입니다.
서로의 장점을 인정하면 좋은 팀이 됩니다."
```

---

## 🧮 계산 로직

### Phase 1: 띠 계산 (기존 코드 재사용)
```javascript
// daily-engine.js에서 가져옴
function getZodiacFromDate(year, month, day) {
  const zodiacAnimals = [
    '쥐', '소', '호랑이', '토끼', 
    '용', '뱀', '말', '양', 
    '원숭이', '닭', '개', '돼지'
  ];
  
  // 양력 기준 띠 계산
  const index = (year - 4) % 12;
  return zodiacAnimals[index];
}
```

### Phase 2: 오행 매핑 (기존 코드 재사용)
```javascript
// element-calculator.js에서 가져옴
const zodiacElements = {
  '쥐': '수(水)',
  '소': '토(土)',
  '호랑이': '목(木)',
  '토끼': '목(木)',
  '용': '토(土)',
  '뱀': '화(火)',
  '말': '화(火)',
  '양': '토(土)',
  '원숭이': '금(金)',
  '닭': '금(金)',
  '개': '토(土)',
  '돼지': '수(水)'
};
```

### Phase 3: 오행 상생상극 점수 (기존 코드 재사용)
```javascript
// element-calculator.js에서 가져옴
function calculateElementScore(element1, element2) {
  const relationships = {
    '상생': 95,  // 木生火, 火生土, 土生金, 金生水, 水生木
    '피생': 85,  // 역상생
    '비화': 70,  // 같은 오행
    '상극': 60,  // 木克土, 土克水, 水克火, 火克金, 金克木
    '피극': 50   // 역상극
  };
  
  // 상생상극 판단 로직
  // ... (이미 구현됨)
  
  return score;
}
```

### Phase 4: 궁합 점수 계산 (새로 추가)
```javascript
function calculateCompatibilityScore(person1, person2, type) {
  // 1. 띠 계산
  const zodiac1 = getZodiacFromDate(person1.year, person1.month, person1.day);
  const zodiac2 = getZodiacFromDate(person2.year, person2.month, person2.day);
  
  // 2. 오행 매핑
  const element1 = zodiacElements[zodiac1];
  const element2 = zodiacElements[zodiac2];
  
  // 3. 오행 점수 계산
  const elementScore = calculateElementScore(element1, element2);
  
  // 4. 타입별 가중치 적용
  const typeWeight = {
    'lover': { element: 0.6, zodiac: 0.4 },      // 연인: 오행 60%, 띠 40%
    'marriage': { element: 0.7, zodiac: 0.3 },   // 결혼: 오행 70%, 띠 30%
    'family': { element: 0.5, zodiac: 0.5 },     // 가족: 오행 50%, 띠 50%
    'friend': { element: 0.4, zodiac: 0.6 },     // 친구: 오행 40%, 띠 60%
    'business': { element: 0.8, zodiac: 0.2 },   // 동업: 오행 80%, 띠 20%
    'work': { element: 0.6, zodiac: 0.4 }        // 직장: 오행 60%, 띠 40%
  };
  
  // 5. 최종 점수
  const finalScore = 
    elementScore * typeWeight[type].element + 
    zodiacScore * typeWeight[type].zodiac;
  
  return {
    score: Math.round(finalScore),
    level: getCompatibilityLevel(finalScore),
    zodiac1, zodiac2,
    element1, element2,
    relationship: getElementRelationship(element1, element2)
  };
}
```

### Phase 5: 레벨 판정
```javascript
function getCompatibilityLevel(score) {
  if (score >= 90) return '최고의 궁합';
  if (score >= 80) return '매우 좋은 궁합';
  if (score >= 70) return '좋은 궁합';
  if (score >= 60) return '무난한 궁합';
  if (score >= 50) return '노력이 필요한 궁합';
  return '주의가 필요한 궁합';
}
```

---

## 💬 Claude 프롬프트 설계

### 기본 프롬프트 구조
```javascript
function generateCompatibilityPrompt(data) {
  const { type, person1, person2, score, level, relationship } = data;
  
  const basePrompt = `당신은 30년 경력의 사주명리 전문가입니다.
55-65세 여성 고객에게 따뜻하고 공감하는 어조로 조언합니다.

# 궁합 정보
- 궁합 타입: ${typeKorean[type]}
- 첫 번째 분: ${person1.zodiac} (${person1.element})
- 두 번째 분: ${person2.zodiac} (${person2.element})
- 오행 관계: ${relationship}
- 궁합 점수: ${score}점 / 100점
- 궁합 등급: ${level}

${getTypeSpecificPrompt(type)}

# 작성 지침
⭐ 반드시 400-600자로 충분히 디테일하게 작성
⭐ 따뜻하고 공감하는 어조 유지
⭐ 구체적인 조언과 예시 포함
⭐ 긍정적이고 희망적인 마무리

# 요청사항
다음 JSON 형식으로 작성해주세요:

{
  "궁합분석": "400-600자의 상세한 궁합 해석",
  "핵심조언": "한 줄 핵심 조언",
  "장점": "이 관계의 장점 3가지",
  "주의사항": "주의할 점 또는 개선 방법",
  "행운의색": "두 분께 어울리는 색상",
  "추천활동": "함께 하면 좋은 활동"
}`;

  return basePrompt;
}
```

### 타입별 상세 프롬프트

#### 연인 궁합
```javascript
const loverPrompt = `
# 연인 궁합 해석 포인트
1. 사랑의 시작과 발전 과정
2. 서로의 연애 스타일과 조화
3. 감정 표현 방식의 차이와 이해
4. 갈등 발생 시 해결 방법
5. 장기적인 관계 유지 비결

# 어조
- "두 분은 서로에게 ~한 존재입니다"
- "연애할 때 ~하면 더 좋아요"
- "가끔은 ~할 수 있지만, ~하면 극복됩니다"
`;
```

#### 결혼 궁합
```javascript
const marriagePrompt = `
# 결혼 궁합 해석 포인트
1. 평생 해로 가능성
2. 결혼 후 재물운과 자식운
3. 양가 부모님과의 관계
4. 가정 경제 운영 방식
5. 노후 생활 전망

# 어조
- "두 분의 결혼은 ~합니다"
- "시댁/처가와의 관계는 ~할 거예요"
- "자녀는 ~할 가능성이 높습니다"
`;
```

#### 가족 궁합
```javascript
const familyPrompt = `
# 가족 궁합 해석 포인트
1. 세대 차이 이해하기
2. 서로의 성격과 가치관 존중
3. 갈등이 생기는 이유
4. 화목한 가정을 위한 조언
5. 서로에게 배울 점

# 어조
- "부모님 세대와 자녀 세대는 ~"
- "서로 ~한 점을 이해해주세요"
- "가족이니까 ~하면 됩니다"
`;
```

#### 친구 궁합
```javascript
const friendPrompt = `
# 친구 궁합 해석 포인트
1. 친구로서의 케미
2. 함께 즐길 수 있는 것들
3. 서로에게 도움이 되는 방법
4. 우정을 오래 유지하는 비결
5. 갈등 시 해결법

# 어조
- "두 분은 ~한 친구 사이예요"
- "함께 ~하면 더 즐거울 거예요"
- "평생 의지할 수 있는 관계입니다"
`;
```

#### 동업 궁합
```javascript
const businessPrompt = `
# 동업 궁합 해석 포인트
1. 사업 성공 가능성
2. 역할 분담 (아이디어/실행)
3. 금전 관계 주의사항
4. 의사결정 방식
5. 장기 협력 전망

# 어조
- "사업적으로 ~한 관계입니다"
- "~를 맡고, ~를 담당하세요"
- "돈 문제는 ~하면 해결됩니다"
`;
```

#### 직장 궁합
```javascript
const workPrompt = `
# 직장 궁합 해석 포인트
1. 업무 스타일 차이
2. 커뮤니케이션 방법
3. 협업 시너지
4. 갈등 예방법
5. 서로 배울 점

# 어조
- "업무 스타일이 ~합니다"
- "~하면 더 좋은 팀워크가 됩니다"
- "서로 ~한 점을 인정하세요"
`;
```

---

## 🎨 프론트엔드 UI 설계

### 페이지 구조
```
compatibility.html
├── Header (뒤로가기, 제목)
├── Type Selector (6개 버튼)
├── Input Section
│   ├── Person 1 (나)
│   │   ├── 생년월일
│   │   └── 띠 자동 표시
│   └── Person 2 (상대방)
│       ├── 생년월일
│       └── 띠 자동 표시
├── Submit Button
└── Result Section
    ├── Score Card
    ├── Detail Analysis
    └── Advice Cards
```

### Step 1: 타입 선택 UI
```html
<div class="type-selector">
  <h3>어떤 관계의 궁합을 보시나요?</h3>
  <div class="type-grid">
    <button class="type-btn active" data-type="lover">
      <span class="icon">❤️</span>
      <span class="label">연인</span>
    </button>
    <button class="type-btn" data-type="marriage">
      <span class="icon">💍</span>
      <span class="label">결혼</span>
    </button>
    <button class="type-btn" data-type="family">
      <span class="icon">👨‍👩‍👧‍👦</span>
      <span class="label">가족</span>
    </button>
    <button class="type-btn" data-type="friend">
      <span class="icon">👯</span>
      <span class="label">친구</span>
    </button>
    <button class="type-btn" data-type="business">
      <span class="icon">💼</span>
      <span class="label">동업</span>
    </button>
    <button class="type-btn" data-type="work">
      <span class="icon">🏢</span>
      <span class="label">직장</span>
    </button>
  </div>
</div>
```

### Step 2: 입력 폼
```html
<div class="input-section">
  <div class="person-input">
    <h4>🙋‍♀️ 나의 정보</h4>
    <input type="date" id="person1-date" />
    <div class="zodiac-display">
      <span id="person1-zodiac">띠: -</span>
    </div>
  </div>
  
  <div class="vs-divider">VS</div>
  
  <div class="person-input">
    <h4>🙋‍♂️ 상대방 정보</h4>
    <input type="date" id="person2-date" />
    <div class="zodiac-display">
      <span id="person2-zodiac">띠: -</span>
    </div>
  </div>
</div>

<button class="submit-btn" onclick="calculateCompatibility()">
  궁합 보기
</button>
```

### Step 3: 결과 화면
```html
<div class="result-section" id="result" style="display:none;">
  <!-- 점수 카드 -->
  <div class="score-card">
    <div class="score-circle">
      <span class="score-number">85</span>
      <span class="score-max">/100</span>
    </div>
    <div class="star-rating">⭐⭐⭐⭐☆</div>
    <h3 class="level-text">매우 좋은 궁합!</h3>
  </div>
  
  <!-- 상세 분석 -->
  <div class="detail-card">
    <h4>📊 상세 분석</h4>
    <div class="detail-row">
      <span>띠 궁합:</span>
      <span>쥐띠 ♥ 용띠 (90점)</span>
    </div>
    <div class="detail-row">
      <span>오행 관계:</span>
      <span>수생목 (상생)</span>
    </div>
    <div class="detail-row">
      <span>관계 유형:</span>
      <span id="type-display">연인</span>
    </div>
  </div>
  
  <!-- Claude 해석 -->
  <div class="interpretation-card">
    <h4>💬 전문가 해석</h4>
    <p id="claude-interpretation" class="interpretation-text">
      <!-- Claude API 결과 -->
    </p>
  </div>
  
  <!-- 조언 카드 -->
  <div class="advice-grid">
    <div class="advice-card">
      <h5>💡 핵심 조언</h5>
      <p id="core-advice"></p>
    </div>
    <div class="advice-card">
      <h5>✨ 장점</h5>
      <p id="strengths"></p>
    </div>
    <div class="advice-card">
      <h5>⚠️ 주의사항</h5>
      <p id="cautions"></p>
    </div>
    <div class="advice-card">
      <h5>🎨 행운의 색</h5>
      <p id="lucky-color"></p>
    </div>
  </div>
  
  <!-- 다시하기 버튼 -->
  <button class="retry-btn" onclick="resetForm()">
    다시 궁합 보기
  </button>
</div>
```

---

## 📁 파일 구조

```
운세플랫폼/
├── frontend/
│   └── pages/
│       └── compatibility.html          # 궁합 페이지 ⭐ 새로 생성
│
├── engines/
│   ├── core/
│   │   └── compatibility-engine.js     # 궁합 엔진 ⭐ 수정 필요
│   └── prompts/
│       └── compatibility-prompt.js     # 프롬프트 ⭐ 새로 생성
│
└── server.js                           # API 추가 ⭐ 수정 필요
```

---

## 🔧 구현 단계

### Phase 1: 백엔드 엔진 (1시간)
```
✅ compatibility-engine.js 작성
   - 띠 계산 (기존 코드 재사용)
   - 오행 매핑 (기존 코드 재사용)
   - 점수 계산 (타입별 가중치)
   - 레벨 판정

✅ compatibility-prompt.js 작성
   - 타입별 프롬프트 6개
   - Claude API 호출 로직
```

### Phase 2: 백엔드 API (30분)
```
✅ server.js에 API 추가
   POST /api/compatibility
   - 요청: type, person1, person2
   - 응답: score, level, claude해석
```

### Phase 3: 프론트엔드 UI (2시간)
```
✅ compatibility.html 작성
   - 타입 선택 버튼
   - 생년월일 입력 폼
   - 결과 표시 화면
   - 로딩 애니메이션
```

### Phase 4: 테스트 (30분)
```
✅ 6가지 타입 모두 테스트
✅ 다양한 띠 조합 테스트
✅ Claude 해석 품질 확인
✅ UI/UX 개선
```

---

## 💰 비용 예측

### Claude API 사용
- **모델**: Claude 3 Sonnet (정확한 해석 필요)
- **토큰 수**: 약 1,500 토큰 (입력 500 + 출력 1,000)
- **비용**: 약 $0.005 per request

### 월간 예상 비용
```
일간 100회 궁합 = $0.50
월간 3,000회 = $15.00
연간 36,000회 = $180.00

✅ 여전히 저렴함!
```

---

## 📊 성공 지표 (KPI)

### 사용자 참여
- **목표**: 일 100회 이상 사용
- **재방문율**: 30% 이상
- **공유율**: 10% 이상

### 만족도
- **정확도 만족**: 80% 이상
- **UI/UX 만족**: 85% 이상
- **재사용 의향**: 70% 이상

---

## 🎯 다음 단계

### 기본 버전 (3시간)
```
✅ 연인 궁합만 구현
✅ 빠른 출시
✅ 시장 반응 테스트
```

### 풀 버전 (4시간) - 추천!
```
✅ 6가지 타입 모두 구현
✅ 차별화된 서비스
✅ 높은 만족도
```

### 프리미엄 버전 (6시간)
```
✅ 그룹 궁합 추가 (3명 이상)
✅ 트러블메이커 찾기
✅ 조합별 분석
```

---

## 📝 체크리스트

### 백엔드
- [ ] compatibility-engine.js 작성
- [ ] compatibility-prompt.js 작성
- [ ] server.js API 추가
- [ ] 6가지 타입 테스트

### 프론트엔드
- [ ] compatibility.html 작성
- [ ] CSS 스타일링
- [ ] JavaScript 로직
- [ ] 반응형 디자인

### 품질 보증
- [ ] Claude 해석 품질 확인
- [ ] 다양한 띠 조합 테스트
- [ ] 모바일 최적화
- [ ] 로딩 속도 최적화

### 배포
- [ ] 메인 페이지 링크 추가
- [ ] 메타 태그 추가 (SEO)
- [ ] 쿠팡 파트너스 링크
- [ ] 면책조항 추가

---

## 🎊 예상 결과

### 완성 시 제공 기능
```
✅ 6가지 관계 유형별 궁합 분석
✅ 0-100점 정밀 점수
✅ 오행 상생상극 기반 정확한 계산
✅ Claude AI 400-600자 스토리텔링
✅ 타입별 맞춤 조언
✅ 행운의 색, 추천 활동 등
✅ 깔끔한 UI/UX
```

### 경쟁 우위
```
🏆 시중 서비스보다 정확함 (오행 기반)
🏆 타입별 맞춤 해석
🏆 AI 스토리텔링으로 공감대 형성
🏆 55-65세 여성 타겟 맞춤
```

---

**📌 이 문서는 궁합 시스템 구현의 마스터 가이드입니다!**  
**변경 사항이 있을 때마다 반드시 업데이트하세요!**
